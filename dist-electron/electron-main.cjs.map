{"version":3,"sources":["../src/main/database.ts","../src/main/features/secretary-service.ts","../src/main/features/scheduler.ts","../electron-main.ts","../src/main/ipc-handlers.ts","../src/main/ai-service.ts","../src/main/features/Hunter-engine.ts","../src/main/scraper-service.ts","../src/main/features/doc-generator.ts","../src/main/features/application-submitter.ts"],"sourcesContent":["import path from 'path';\nimport { app } from 'electron';\nimport fs from 'fs';\n\nlet dbData: any = (global as any).dbData || null;\n\nconst getDbPath = () => {\n  const dataDir = path.join(app.getPath('userData'), 'data');\n  if (!fs.existsSync(dataDir)) fs.mkdirSync(dataDir, { recursive: true });\n  return path.join(dataDir, 'db.json');\n};\n\nexport function getDatabase(): any {\n  if (!dbData) {\n    const dbPath = getDbPath();\n    if (fs.existsSync(dbPath)) {\n      try { dbData = JSON.parse(fs.readFileSync(dbPath, 'utf8')); } \n      catch (e) { dbData = getDefaultData(); }\n    } else { dbData = getDefaultData(); }\n    (global as any).dbData = dbData;\n  }\n  const tables = ['user_profile', 'email_config', 'job_preferences', 'ai_models', 'job_websites', 'company_monitoring', 'job_listings', 'applications', 'action_logs', 'email_alerts', 'documents', 'search_profiles', 'settings', 'questions'];\n  tables.forEach(t => { if (!dbData[t]) dbData[t] = []; });\n  return dbData;\n}\n\nconst getDefaultData = () => ({\n  user_profile: [], email_config: [], job_preferences: [], ai_models: [],\n  job_websites: [], company_monitoring: [], job_listings: [],\n  applications: [], action_logs: [], email_alerts: [],\n  documents: [], search_profiles: [], settings: [], questions: []\n});\n\nconst saveDb = () => {\n  try {\n    fs.writeFileSync(getDbPath(), JSON.stringify(dbData, null, 2));\n    console.log('DB: Saved to disk');\n  } catch (e) {\n    console.error('DB: Save failed', e);\n  }\n};\n\nexport async function initializeDatabase(): Promise<void> { getDatabase(); }\n\nconst toSnakeCase = (str: string) => str.replace(/[A-Z]/g, letter => `_${letter.toLowerCase()}`);\n\nconst mapToSnakeCase = (obj: any) => {\n  const newObj: any = {};\n  for (const key in obj) { \n    newObj[toSnakeCase(key)] = obj[key]; \n  }\n  return newObj;\n};\n\nexport async function runQuery(sql: string, params: any = []): Promise<any> {\n  const db = getDatabase();\n  \n  // Parse SQL to get operation and table\n  const sqlUpper = sql.toUpperCase();\n  const sqlParts = sql.trim().split(/\\s+/);\n  \n  let table = '';\n  if (sqlUpper.includes('INSERT INTO')) {\n    table = sqlParts[2];\n  } else if (sqlUpper.includes('UPDATE')) {\n    table = sqlParts[1];\n  } else if (sqlUpper.includes('DELETE FROM')) {\n    table = sqlParts[2];\n  }\n  table = table.replace(/[`\"']/g, '');\n  \n  console.log(`DB: ${sqlUpper.split(' ')[0]} on \"${table}\"`);\n  \n  if (!db[table]) {\n    console.log(`DB: Table \"${table}\" not found!`);\n    return { success: false, error: 'Table not found' };\n  }\n  \n  // Get data from params\n  const newData = Array.isArray(params) ? params[0] : params;\n  \n  // INSERT\n  if (sqlUpper.includes('INSERT')) {\n    const mapped = mapToSnakeCase(newData);\n    \n    // USE THE PROVIDED ID if it exists, otherwise generate one\n    const recordId = mapped.id || newData.id || Date.now();\n    \n    const record = { \n      ...mapped, \n      id: recordId,\n      is_active: mapped.is_active ?? 1, \n      timestamp: new Date().toISOString() \n    };\n    \n    db[table].push(record);\n    saveDb();\n    \n    console.log(`DB: Inserted into ${table} with id=${recordId}`);\n    return { id: recordId, success: true };\n  } \n  \n  // UPDATE\n  else if (sqlUpper.includes('UPDATE')) {\n    const mapped = mapToSnakeCase(newData);\n    const updateId = mapped.id || newData.id;\n    \n    console.log(`DB: Looking for id=${updateId} in ${table} (${db[table].length} records)`);\n    \n    // Find by ID\n    let index = -1;\n    if (updateId !== undefined) {\n      index = db[table].findIndex((item: any) => {\n        // Compare as numbers and strings\n        return item.id === updateId || \n               item.id === Number(updateId) || \n               String(item.id) === String(updateId);\n      });\n    }\n    \n    // Special case for single-record tables\n    if (index === -1 && ['user_profile', 'settings', 'job_preferences', 'email_config'].includes(table)) {\n      if (db[table].length > 0) {\n        index = 0;\n      } else {\n        // Create new record for single-record tables\n        const record = { ...mapped, id: updateId || Date.now(), timestamp: new Date().toISOString() };\n        db[table].push(record);\n        saveDb();\n        console.log(`DB: Created new ${table} record`);\n        return { id: record.id, success: true };\n      }\n    }\n    \n    if (index !== -1) {\n      // Merge existing data with new data\n      db[table][index] = { \n        ...db[table][index], \n        ...mapped,\n        id: db[table][index].id // Keep original ID\n      };\n      saveDb();\n      console.log(`DB: Updated ${table}[${index}] with id=${db[table][index].id}`);\n      return { success: true, id: db[table][index].id };\n    } else {\n      console.log(`DB: ‚ùå Record not found for update! id=${updateId}`);\n      console.log(`DB: Available IDs in ${table}:`, db[table].map((r: any) => r.id));\n      return { success: false, error: 'Record not found' };\n    }\n  } \n  \n  // DELETE\n  else if (sqlUpper.includes('DELETE')) {\n    const deleteId = typeof newData === 'object' ? (newData.id) : newData;\n    const beforeCount = db[table].length;\n    \n    db[table] = db[table].filter((item: any) => {\n      return item.id !== deleteId && \n             item.id !== Number(deleteId) && \n             String(item.id) !== String(deleteId);\n    });\n    \n    const deleted = beforeCount - db[table].length;\n    saveDb();\n    console.log(`DB: Deleted ${deleted} record(s) from ${table} where id=${deleteId}`);\n    return { success: true, deleted };\n  }\n  \n  return { success: false, error: 'Unknown operation' };\n}\n\nexport async function getAllQuery(sql: string): Promise<any[]> {\n  const db = getDatabase();\n  const parts = sql.trim().split(/\\s+/);\n  \n  // Handle \"SELECT * FROM table\"\n  let table = '';\n  const fromIndex = parts.findIndex(p => p.toUpperCase() === 'FROM');\n  if (fromIndex !== -1 && parts[fromIndex + 1]) {\n    table = parts[fromIndex + 1].replace(/[`\"']/g, '');\n  }\n  \n  const result = db[table] || [];\n  console.log(`DB: SELECT from ${table} returned ${result.length} records`);\n  return result;\n}\n\nexport async function logAction(userId: number, type: string, desc: string, status: string, success?: boolean) {\n  const db = getDatabase();\n  const logEntry = { \n    id: Date.now(),\n    user_id: userId, \n    action_type: type, \n    action_description: desc, \n    status: status, \n    success: success,\n    timestamp: new Date().toISOString()\n  };\n  \n  db.action_logs.push(logEntry);\n  \n  // Keep only last 200 logs\n  if (db.action_logs.length > 200) {\n    db.action_logs = db.action_logs.slice(-200);\n  }\n  \n  saveDb();\n}","import Imap from 'imap';\nimport { simpleParser } from 'mailparser';\nimport { getAllQuery, logAction, runQuery } from '../database';\n\n/**\n * WAIT FOR AND FETCH LATEST OTP\n * Monitors the inbox for a security code (4-8 digits).\n * Retries every 15 seconds for up to 3 minutes.\n */\nexport async function fetchLatestOTP(userId: number): Promise<string | null> {\n  console.log('Secretary: Monitoring inbox for security code...');\n  await logAction(userId, 'ai_secretary', 'üìß Monitoring inbox for security code...', 'in_progress');\n\n  const configRes = await getAllQuery('SELECT * FROM email_config');\n  const config = configRes[0];\n  \n  if (!config || !config.email_user || !config.email_password || !config.imap_host) {\n    await logAction(userId, 'ai_secretary', '‚ùå Email configuration is missing in Settings', 'failed', false);\n    return null;\n  }\n\n  // Retry logic: check every 15 seconds for up to 12 attempts (3 minutes total)\n  for (let attempt = 0; attempt < 12; attempt++) {\n    const otp = await performImapSearch(config, ['UNSEEN'], (text: string) => {\n      // Regex to match 4 to 8 digit numeric codes\n      const match = text.match(/\\b\\d{4,8}\\b/);\n      return match ? match[0] : null;\n    });\n\n    if (otp) {\n      await logAction(userId, 'ai_secretary', `‚úÖ Security code found: ${otp}`, 'completed', true);\n      return otp;\n    }\n\n    console.log(`Secretary: OTP not found yet (Attempt ${attempt + 1}/12). Waiting 15s...`);\n    await new Promise(resolve => setTimeout(resolve, 15000));\n  }\n\n  await logAction(userId, 'ai_secretary', '‚ùå Timed out waiting for security code after 3 minutes', 'failed', false);\n  return null;\n}\n\n/**\n * MONITOR FOR APPLICATION CONFIRMATIONS\n * Scans for emails indicating a successful submission.\n */\nexport async function monitorConfirmations(userId: number) {\n  const configRes = await getAllQuery('SELECT * FROM email_config');\n  const config = configRes[0];\n  if (!config || !config.email_user || !config.email_password) return;\n\n  const confirmation = await performImapSearch(config, ['UNSEEN'], (text: string, subject: string) => {\n    const keywords = ['application received', 'thank you for applying', 'confirmation', 'received your application'];\n    const combined = (text + ' ' + subject).toLowerCase();\n    \n    if (keywords.some(k => combined.includes(k))) {\n      return { subject, snippet: text.substring(0, 200) };\n    }\n    return null;\n  });\n\n  if (confirmation) {\n    await logAction(userId, 'ai_secretary', `üì¨ Received confirmation: ${confirmation.subject}`, 'completed', true);\n    await runQuery('INSERT INTO email_alerts', {\n      user_id: userId,\n      alert_type: 'confirmation',\n      subject: confirmation.subject,\n      snippet: confirmation.snippet,\n      timestamp: new Date().toISOString()\n    });\n  }\n}\n\n/**\n * INTERNAL HELPER: PERFORM IMAP SEARCH\n */\nasync function performImapSearch(config: any, criteria: any[], extractor: (text: string, subject: string) => any): Promise<any> {\n  return new Promise((resolve) => {\n    const imap = new Imap({\n      user: config.email_user,\n      password: config.email_password,\n      host: config.imap_host,\n      port: config.imap_port || 993,\n      tls: true,\n      tlsOptions: { rejectUnauthorized: false }\n    });\n\n    imap.once('ready', () => {\n      imap.openBox('INBOX', false, (err) => {\n        if (err) {\n          console.error('IMAP: Could not open inbox', err);\n          imap.end();\n          resolve(null);\n          return;\n        }\n        \n        imap.search(criteria, (err, results) => {\n          if (err || !results || results.length === 0) {\n            imap.end();\n            resolve(null);\n            return;\n          }\n          \n          // Fetch the most recent matching message\n          const f = imap.fetch(results[results.length - 1], { bodies: '' });\n          \n          f.on('message', (msg) => {\n            msg.on('body', async (stream: any) => {\n              const parsed: any = await simpleParser(stream);\n              const result = extractor(parsed.text || '', parsed.subject || '');\n              resolve(result);\n            });\n          });\n          \n          f.once('end', () => imap.end());\n        });\n      });\n    });\n\n    imap.once('error', (err) => {\n      console.error('IMAP Connection Error:', err);\n      resolve(null);\n    });\n\n    imap.connect();\n  });\n}","import { getDatabase, runQuery } from '../database';\nimport * as SecretaryService from './secretary-service';\n\n// Global flag to track if scheduler is enabled\nlet schedulerEnabled = false;\n\n/**\n * Enable/disable the scheduler\n */\nexport function setSchedulerEnabled(enabled: boolean) {\n  schedulerEnabled = enabled;\n  console.log(`Scheduler: ${enabled ? 'ENABLED' : 'DISABLED'}`);\n}\n\n/**\n * MAIN SCHEDULER\n * Runs every 60 seconds to check for scheduled tasks.\n * IMPORTANT: Only runs if explicitly enabled via settings\n */\nexport function startHuntingScheduler(userId: number, startHunterSearch: Function, callAI: Function) {\n  return setInterval(async () => {\n    const db = getDatabase();\n    \n    // 1. Check global setting for Job Hunting\n    // CRITICAL: Only proceed if job_hunting_active is explicitly set to 1\n    // This prevents auto-scraping without user consent\n    const settings = db.settings[0];\n    \n    // Double-check: Must have settings AND job_hunting_active must be exactly 1\n    if (!settings || settings.job_hunting_active !== 1) {\n      // Silently skip - don't log every minute to avoid spam\n      return;\n    }\n\n    // Additional safety check: scheduler must be explicitly enabled\n    if (!schedulerEnabled) {\n      console.log('Scheduler: Skipping - not explicitly enabled');\n      return;\n    }\n\n    const websites = db.job_websites.filter((w: any) => w.is_active === 1);\n    const now = new Date();\n    \n    for (const website of websites) {\n      const lastChecked = website.last_checked ? new Date(website.last_checked) : new Date(0);\n      const hoursSinceLastCheck = (now.getTime() - lastChecked.getTime()) / (1000 * 60 * 60);\n      \n      // Career pages check every 24h, others use custom frequency (default 4h)\n      const frequency = website.site_type === 'career_page' ? 24 : (website.check_frequency || 4);\n      \n      if (hoursSinceLastCheck >= frequency) {\n        console.log(`Scheduler: Checking ${website.website_name}...`);\n        await startHunterSearch(userId, callAI);\n        await runQuery('UPDATE job_websites', { id: website.id, last_checked: now.toISOString() });\n      }\n    }\n\n    // 2. Always run Secretary monitoring for confirmations\n    // This runs independently of the job hunting toggle\n    try {\n      await SecretaryService.monitorConfirmations(userId);\n    } catch (e) {\n      console.error('Scheduler: Secretary monitoring failed', e);\n    }\n\n  }, 60000); // Check every minute\n}","import { app, BrowserWindow, Menu, MenuItem } from 'electron';\nimport path from 'path';\nimport isDev from 'electron-is-dev';\nimport { initializeDatabase } from './src/main/database';\nimport { setupIpcHandlers } from './src/main/ipc-handlers';\n\n// FIX: Resolve GPU process crashes on Windows\napp.disableHardwareAcceleration();\n\n// FIX: Prevent multiple instances\nconst gotTheLock = app.requestSingleInstanceLock();\nif (!gotTheLock) {\n  app.quit();\n}\n\nlet mainWindow: BrowserWindow | null = null;\n\nfunction createWindow() {\n  mainWindow = new BrowserWindow({\n    width: 1400,\n    height: 900,\n    minWidth: 1000,\n    minHeight: 700,\n    webPreferences: {\n      preload: path.join(__dirname, \"preload.cjs\"),\n      contextIsolation: true,\n      nodeIntegration: false\n    },\n  });\n\n  const startUrl = isDev ? 'http://localhost:5173' : `file://${path.join(__dirname, '../dist/index.html')}`;\n  mainWindow.loadURL(startUrl);\n\n  if (isDev) mainWindow.webContents.openDevTools();\n\n  mainWindow.webContents.on('context-menu', (event, params) => {\n    const menu = new Menu();\n    menu.append(new MenuItem({ label: 'Cut', role: 'cut', enabled: params.editFlags.canCut }));\n    menu.append(new MenuItem({ label: 'Copy', role: 'copy', enabled: params.editFlags.canCopy }));\n    menu.append(new MenuItem({ label: 'Paste', role: 'paste', enabled: params.editFlags.canPaste }));\n    menu.append(new MenuItem({ type: 'separator' }));\n    menu.append(new MenuItem({ label: 'Select All', role: 'selectAll', enabled: params.editFlags.canSelectAll }));\n    menu.popup({ window: mainWindow! });\n  });\n\n  mainWindow.on('closed', () => { mainWindow = null; });\n}\n\napp.on('ready', async () => {\n  await initializeDatabase();\n  setupIpcHandlers();\n  createWindow();\n});\n\napp.on('window-all-closed', () => { if (process.platform !== 'darwin') app.quit(); });\n\napp.on('second-instance', () => {\n  if (mainWindow) {\n    if (mainWindow.isMinimized()) mainWindow.restore();\n    mainWindow.focus();\n  }\n});","import { runQuery, getAllQuery, getDatabase } from './database';\nimport { ipcMain, shell, BrowserWindow } from 'electron';\nimport * as aiService from './ai-service';\nimport axios from 'axios';\n\nexport function setupIpcHandlers(): void {\n  // CLEAN SLATE: Remove ALL existing handlers to prevent \"second handler\" error\n  const channels = [\n    'settings:get', 'settings:update', 'user:get-profile', 'user:update-profile',\n    'user:open-linkedin', 'user:capture-linkedin',\n    'profiles:get-all', 'profiles:save', 'profiles:update', 'profiles:delete',\n    'jobs:get-all', 'jobs:delete', 'jobs:add-manual', 'jobs:update-doc-confirmation',\n    'hunter:start-search', 'ai:process-application', 'ai:generate-tailored-docs',\n    'ai:fetch-models',\n    'docs:get-all', 'docs:save', 'docs:open-file',\n    'websites:get-all', 'websites:add', 'websites:delete', 'websites:toggle-active',\n    'ai-models:get-all', 'ai-models:add', 'ai-models:update', 'ai-models:delete',\n    'logs:get-recent-actions', 'apps:get-all',\n    'scheduler:toggle', 'scheduler:get-status'\n  ];\n  \n  // Remove handlers first - prevents duplication on hot reload\n  channels.forEach(channel => {\n    try { ipcMain.removeHandler(channel); } catch (e) { /* ignore if not exists */ }\n  });\n\n  // --- SETTINGS ---\n  ipcMain.handle('settings:get', async () => {\n    try {\n      const data = await getAllQuery('SELECT * FROM settings');\n      return { success: true, data: data[0] || null };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('settings:update', async (_, data) => {\n    try {\n      await runQuery('UPDATE settings', data);\n      return { success: true };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  // --- USER PROFILE ---\n  ipcMain.handle('user:get-profile', async () => {\n    try {\n      const data = await getAllQuery('SELECT * FROM user_profile');\n      return { success: true, data: data[0] || null };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('user:update-profile', async (_, data) => {\n    try {\n      const db = getDatabase();\n      // If profile exists, update it; otherwise create it\n      if (db.user_profile.length > 0) {\n        await runQuery('UPDATE user_profile', { ...data, id: db.user_profile[0].id });\n      } else {\n        await runQuery('INSERT INTO user_profile', [{ ...data, id: 1 }]);\n      }\n      return { success: true };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  // --- LINKEDIN HELPERS ---\n  ipcMain.handle('user:open-linkedin', async (_, url) => {\n    try {\n      const linkedinUrl = url || 'https://www.linkedin.com/in/';\n      await shell.openExternal(linkedinUrl);\n      return { success: true };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('user:capture-linkedin', async () => {\n    try {\n      // This will attempt to capture LinkedIn data from the active browser\n      // For now, return a mock structure that the user can fill in manually\n      // Full implementation would require Playwright/Puppeteer\n      return { \n        success: true, \n        data: {\n          name: '',\n          title: '',\n          location: '',\n          photo: '',\n          summary: '',\n          experienceList: [],\n          educationList: [],\n          skillList: [],\n          licenseList: [],\n          languageList: []\n        },\n        message: 'LinkedIn capture requires browser automation. Please use manual entry for now.'\n      };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  // --- SEARCH PROFILES ---\n  ipcMain.handle('profiles:get-all', async () => {\n    try {\n      const data = await getAllQuery('SELECT * FROM search_profiles');\n      return { success: true, data };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('profiles:save', async (_, data) => {\n    try {\n      const result = await runQuery('INSERT INTO search_profiles', [data]);\n      return { success: true, id: result.id };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('profiles:update', async (_, data) => {\n    try {\n      // data can include: job_titles, industry, excluded_industries, experience_levels, certifications\n      // These are stored as comma-separated strings\n      await runQuery('UPDATE search_profiles', data);\n      return { success: true };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('profiles:delete', async (_, id) => {\n    try {\n      await runQuery('DELETE FROM search_profiles', { id });\n      return { success: true };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  // --- JOBS ---\n  ipcMain.handle('jobs:get-all', async () => {\n    try {\n      const data = await getAllQuery('SELECT * FROM job_listings');\n      return { success: true, data };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('jobs:delete', async (_, id) => {\n    try {\n      const deleteId = typeof id === 'object' ? id.id : id;\n      await runQuery('DELETE FROM job_listings', { id: deleteId });\n      return { success: true };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('jobs:add-manual', async (_, data) => {\n    try {\n      const result = await runQuery('INSERT INTO job_listings', { \n        ...data, \n        source: 'Manual', \n        status: 'analyzing' \n      });\n      // Start analysis in background\n      aiService.analyzeJobUrl(result.id, data.userId, data.url).catch(console.error);\n      return { success: true, id: result.id };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('jobs:update-doc-confirmation', async (_, data) => {\n    try {\n      await runQuery('UPDATE job_listings', { \n        id: data.jobId, \n        user_confirmed_docs: data.confirmed \n      });\n      return { success: true };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  // --- AI / HUNTER ---\n  ipcMain.handle('hunter:start-search', async (_, userId) => {\n    try {\n      const result = await aiService.startHunterSearch(userId);\n      return result;\n    } catch (e: any) {\n      console.error('Hunter search error:', e);\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('ai:process-application', async (_, jobId, userId) => {\n    try {\n      return await aiService.processApplication(jobId, userId);\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('ai:generate-tailored-docs', async (_, data) => {\n    try {\n      return await aiService.processApplication(data.jobId, data.userId);\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  // --- AI FETCH MODELS (NEW) ---\n  ipcMain.handle('ai:fetch-models', async (_, data) => {\n    try {\n      const { provider, apiKey } = data;\n      let models: string[] = [];\n\n      if (provider === 'openai') {\n        const response = await axios.get('https://api.openai.com/v1/models', {\n          headers: { 'Authorization': `Bearer ${apiKey}` },\n          timeout: 10000\n        });\n        models = response.data.data\n          .filter((m: any) => m.id.includes('gpt'))\n          .map((m: any) => m.id)\n          .sort();\n      } else if (provider === 'together') {\n        // Together AI models\n        models = [\n          'mistralai/Mixtral-8x7B-Instruct-v0.1',\n          'meta-llama/Llama-3-70b-chat-hf',\n          'meta-llama/Llama-3-8b-chat-hf',\n          'togethercomputer/CodeLlama-34b-Instruct'\n        ];\n      } else if (provider === 'local') {\n        // Try to fetch from Ollama\n        try {\n          const response = await axios.get('http://localhost:11434/api/tags', { timeout: 5000 });\n          models = response.data.models?.map((m: any) => m.name) || ['llama3', 'mistral', 'codellama'];\n        } catch {\n          models = ['llama3', 'mistral', 'codellama', 'phi3'];\n        }\n      }\n\n      return { success: true, models };\n    } catch (e: any) {\n      console.error('Fetch models error:', e.message);\n      return { success: false, error: e.message, models: [] };\n    }\n  });\n\n  // --- DOCUMENTS ---\n  ipcMain.handle('docs:get-all', async () => {\n    try {\n      const data = await getAllQuery('SELECT * FROM documents');\n      return { success: true, data };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('docs:save', async (_, data) => {\n    try {\n      const result = await runQuery('INSERT INTO documents', [data]);\n      return { success: true, id: result.id };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('docs:open-file', async (_, filePath) => {\n    try {\n      const { shell } = require('electron');\n      await shell.openPath(filePath);\n      return { success: true };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  // --- WEBSITES ---\n  ipcMain.handle('websites:get-all', async () => {\n    try {\n      const data = await getAllQuery('SELECT * FROM job_websites');\n      return { success: true, data };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('websites:add', async (_, data) => {\n    try {\n      const result = await runQuery('INSERT INTO job_websites', [data]);\n      return { success: true, id: result.id };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('websites:delete', async (_, id) => {\n    try {\n      await runQuery('DELETE FROM job_websites', { id });\n      return { success: true };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('websites:toggle-active', async (_, data) => {\n    try {\n      await runQuery('UPDATE job_websites', { id: data.id, is_active: data.isActive });\n      return { success: true };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  // --- AI MODELS ---\n  ipcMain.handle('ai-models:get-all', async () => {\n    try {\n      const data = await getAllQuery('SELECT * FROM ai_models');\n      return { success: true, data };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('ai-models:add', async (_, data) => {\n    try {\n      const result = await runQuery('INSERT INTO ai_models', [data]);\n      return { success: true, id: result.id };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('ai-models:update', async (_, data) => {\n    try {\n      await runQuery('UPDATE ai_models', [data]);\n      return { success: true };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('ai-models:delete', async (_, id) => {\n    try {\n      await runQuery('DELETE FROM ai_models', { id });\n      return { success: true };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  // --- LOGS ---\n  ipcMain.handle('logs:get-recent-actions', async () => {\n    try {\n      const data = await getAllQuery('SELECT * FROM action_logs');\n      return { success: true, data };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  // --- APPLICATIONS ---\n  ipcMain.handle('apps:get-all', async () => {\n    try {\n      const data = await getAllQuery('SELECT * FROM applications');\n      return { success: true, data };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  // --- SCHEDULER CONTROL ---\n  ipcMain.handle('scheduler:toggle', async (_, enabled) => {\n    try {\n      const { setSchedulerEnabled } = require('./features/scheduler');\n      setSchedulerEnabled(enabled);\n      // Also update settings in database\n      await runQuery('UPDATE settings', { job_hunting_active: enabled ? 1 : 0 });\n      return { success: true, enabled };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('scheduler:get-status', async () => {\n    try {\n      const db = getDatabase();\n      const settings = db.settings[0];\n      return { \n        success: true, \n        enabled: settings?.job_hunting_active === 1 \n      };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  // Start scheduler (but disabled by default)\n  aiService.startHuntingScheduler(1);\n  \n  console.log('‚úÖ IPC Handlers registered successfully');\n}","import { getDatabase, runQuery, getAllQuery, logAction } from './database';\nimport axios from 'axios';\n\n// Import Feature Modules\nimport * as HunterEngine from './features/Hunter-engine';\nimport * as DocGenerator from './features/doc-generator';\nimport * as GhostJobNetwork from './features/ghost-job-network';\nimport * as SecretaryService from './features/secretary-service';\nimport { startHuntingScheduler as initScheduler } from './features/scheduler';\nimport * as AppSubmitter from './features/application-submitter';\n\nlet huntingInterval: NodeJS.Timeout | null = null;\n\nexport async function callAI(model: any, prompt: string, fileData?: string): Promise<string> {\n  console.log('\\n----- CALL AI -----');\n  console.log('Model:', model?.model_name);\n  console.log('Prompt length:', prompt.length);\n  \n  try {\n    if (!model) {\n      console.log('‚ùå No model provided');\n      return \"Error: No AI model provided\";\n    }\n    \n    let apiKey = model.api_key ? model.api_key.trim() : '';\n    let modelName = model.model_name || 'gpt-3.5-turbo';\n    \n    // If no API key in model, try to find from database by role\n    if (!apiKey && model.role) {\n      console.log(`Looking for API key by role: ${model.role}`);\n      const models = await getAllQuery('SELECT * FROM ai_models');\n      const dbModel = models.find((m: any) => m.role === model.role && m.status === 'active');\n      if (dbModel) {\n        apiKey = dbModel.api_key?.trim() || '';\n        modelName = dbModel.model_name || modelName;\n        console.log(`Found model: ${modelName}, key: ${apiKey?.substring(0, 15)}...`);\n      }\n    }\n    \n    if (!apiKey) {\n      console.log('‚ùå No API key found');\n      return \"Error: No API key configured. Go to Settings > AI Models and add your API key.\";\n    }\n    \n    // Determine endpoint\n    let endpoint = 'https://api.openai.com/v1/chat/completions';\n    \n    if (model.model_type === 'local' || model.api_endpoint?.includes('localhost')) {\n      endpoint = model.api_endpoint || 'http://localhost:11434/v1/chat/completions';\n    } else if (apiKey.startsWith('tgp_v1_')) {\n      endpoint = 'https://api.together.xyz/v1/chat/completions';\n    }\n    \n    console.log('Endpoint:', endpoint);\n    console.log('Model name:', modelName);\n    \n    // Build request\n    const requestBody: any = {\n      model: modelName,\n      messages: [\n        { role: 'system', content: 'You are a helpful assistant that extracts job information. Always respond with valid JSON only.' },\n        { role: 'user', content: prompt }\n      ],\n      max_tokens: 1500,\n      temperature: 0.3\n    };\n    \n    // Add image if provided (for vision models)\n    if (fileData && modelName.includes('vision') || modelName.includes('gpt-4o')) {\n      requestBody.messages[1] = {\n        role: 'user',\n        content: [\n          { type: 'text', text: prompt },\n          { type: 'image_url', image_url: { url: fileData } }\n        ]\n      };\n    }\n    \n    console.log('Making API request...');\n    \n    const response = await axios.post(endpoint, requestBody, {\n      headers: { \n        'Authorization': `Bearer ${apiKey}`, \n        'Content-Type': 'application/json' \n      },\n      timeout: 60000\n    });\n    \n    const content = response.data.choices[0].message.content;\n    console.log('AI Response (first 500 chars):', content?.substring(0, 500));\n    console.log('----- END CALL AI -----\\n');\n    \n    return content;\n    \n  } catch (err: any) {\n    const errorMsg = err.response?.data?.error?.message || err.message;\n    console.log('‚ùå AI Error:', errorMsg);\n    console.log('Full error:', err.response?.data || err.message);\n    return \"Error: \" + errorMsg;\n  }\n}\n\nexport async function startHunterSearch(userId: number) {\n  console.log('startHunterSearch called with userId:', userId);\n  return await HunterEngine.startHunterSearch(userId, callAI);\n}\n\nexport async function analyzeJobUrl(jobId: number, userId: number, url: string) {\n  console.log('analyzeJobUrl called:', { jobId, userId, url });\n  const models = await getAllQuery('SELECT * FROM ai_models');\n  const hunter = models.find((m: any) => m.role === 'Hunter' && m.status === 'active');\n  const auditor = models.find((m: any) => m.role === 'Auditor' && m.status === 'active');\n  return await HunterEngine.analyzeJobUrl(jobId, userId, url, hunter, auditor || hunter, callAI);\n}\n\nexport async function processApplication(jobId: number, userId: number, userConsentGiven: boolean = false) {\n  try {\n    const db = getDatabase();\n    const job = db.job_listings.find((j: any) => j.id === jobId);\n    if (!job) return { success: false, error: 'Job not found' };\n\n    const models = await getAllQuery('SELECT * FROM ai_models');\n    const thinker = models.find((m: any) => m.role === 'Thinker' && m.status === 'active');\n    const auditor = models.find((m: any) => m.role === 'Auditor' && m.status === 'active');\n    const observer = models.find((m: any) => m.role === 'Observer' && m.status === 'active') || thinker;\n\n    // Step 1: Generate Docs (The \"Skeleton\" call)\n    if (thinker && auditor) {\n      await DocGenerator.generateTailoredDocs(job, userId, thinker, auditor, { cv: true, coverLetter: true }, callAI);\n    }\n\n    // Step 2: Trigger AI Mouse Submission (The \"Skeleton\" link)\n    console.log(`AI Service: Docs ready for job ${jobId}. Handing over to AI Mouse...`);\n    return await AppSubmitter.submitApplication(jobId, userId, observer, callAI);\n\n  } catch (error: any) {\n    return { success: false, error: error.message };\n  }\n}\n\nexport function startHuntingScheduler(userId: number) {\n  if (huntingInterval) clearInterval(huntingInterval);\n  huntingInterval = initScheduler(userId, startHunterSearch, callAI);\n}\n\nexport async function submitApplication(jobId: number, userId: number) {\n  const models = await getAllQuery('SELECT * FROM ai_models');\n  const observer = models.find((m: any) => m.role === 'Observer' && m.status === 'active') || \n                   models.find((m: any) => m.role === 'Hunter' && m.status === 'active');\n  \n  return await AppSubmitter.submitApplication(jobId, userId, observer, callAI);\n}","import { runQuery, getDatabase, getAllQuery, logAction } from '../database';\nimport { scrapeJobs, getJobPageContent } from '../scraper-service';\nimport { reportGhostJob as reportGhostJobNetwork, isGhostJob as isGhostJobNetwork } from './ghost-job-network';\n\nexport async function analyzeJobUrl(jobId: number, userId: number, url: string, hunter: any, auditor: any, callAI: Function) {\n  console.log(`\\n========== ANALYZING JOB ${jobId} ==========`);\n  console.log(`URL: ${url}`);\n  console.log(`Hunter model:`, hunter ? hunter.model_name : 'MISSING!');\n  \n  await logAction(userId, 'ai_hunter', `üîç Analyzing: ${url}`, 'in_progress');\n  \n  // Step 1: Get page content\n  console.log('Step 1: Getting page content...');\n  const pageData = await getJobPageContent(url, userId, callAI);\n  \n  console.log(`Scraper result: strategy=\"${pageData.strategyUsed}\", contentLength=${pageData.content.length}`);\n  \n  // Check if blocked or failed\n  if (pageData.strategyUsed.includes('Blocked') || pageData.strategyUsed.includes('Failed')) {\n    console.log('‚ùå Page was blocked or failed');\n    await logAction(userId, 'ai_auditor', `‚ùå Blocked: ${url}`, 'failed', false);\n    await runQuery('DELETE FROM job_listings', { id: jobId });\n    return;\n  }\n\n  // Check minimum content\n  if (!pageData.content || pageData.content.length < 100) {\n    console.log('‚ùå Content too short:', pageData.content.length);\n    await logAction(userId, 'ai_auditor', `‚ùå Empty content: ${url}`, 'failed', false);\n    await runQuery('DELETE FROM job_listings', { id: jobId });\n    return;\n  }\n\n  console.log('‚úÖ Got content, first 500 chars:', pageData.content.substring(0, 500));\n  await logAction(userId, 'ai_hunter', `üìÑ Got ${pageData.content.length} chars via ${pageData.strategyUsed}`, 'in_progress');\n\n  // Step 2: Check if we have a valid Hunter AI model\n  if (!hunter || !hunter.api_key) {\n    console.log('‚ùå No Hunter AI model or missing API key!');\n    await logAction(userId, 'ai_hunter', `‚ùå No Hunter AI configured!`, 'failed', false);\n    \n    // FALLBACK: Try to extract basic info without AI\n    console.log('Attempting fallback extraction...');\n    const fallbackData = extractBasicInfo(pageData.content, url);\n    if (fallbackData.jobTitle) {\n      await runQuery('UPDATE job_listings', { \n        id: jobId, \n        ...fallbackData,\n        status: 'analyzed', \n        date_imported: new Date().toLocaleDateString() \n      });\n      console.log('‚úÖ Saved with fallback data:', fallbackData);\n    }\n    return;\n  }\n\n  // Step 3: Build prompt for AI\n  const isJsonLd = pageData.strategyUsed.includes('JSON-LD');\n  console.log('Is JSON-LD:', isJsonLd);\n  \n  let prompt: string;\n  if (isJsonLd) {\n    prompt = `You are a job data extractor. Extract job details from this JSON-LD data.\n\nReturn ONLY a valid JSON object (no markdown, no explanation):\n{\"jobTitle\":\"exact job title\",\"companyName\":\"company name\",\"location\":\"city, country\",\"jobType\":\"Full-time/Part-time/Contract\",\"experienceLevel\":\"Junior/Mid/Senior\",\"salaryRange\":\"salary or N/A\",\"description\":\"2-3 sentence summary\",\"requiredSkills\":\"comma separated\",\"remoteOnsite\":\"Remote/Hybrid/Onsite\"}\n\nJSON-LD:\n${pageData.content.substring(0, 6000)}`;\n  } else {\n    prompt = `You are a job data extractor. Extract job details from this job listing text.\n\nReturn ONLY a valid JSON object (no markdown, no explanation):\n{\"jobTitle\":\"exact job title\",\"companyName\":\"company name\",\"location\":\"city, country\",\"jobType\":\"Full-time/Part-time/Contract\",\"experienceLevel\":\"Junior/Mid/Senior\",\"salaryRange\":\"salary or N/A\",\"description\":\"2-3 sentence summary\",\"requiredSkills\":\"comma separated\",\"remoteOnsite\":\"Remote/Hybrid/Onsite\"}\n\nJob listing:\n${pageData.content.substring(0, 6000)}`;\n  }\n\n  console.log('Step 3: Calling AI...');\n  console.log('Prompt length:', prompt.length);\n  \n  // Step 4: Call AI\n  let aiResponse: string;\n  try {\n    aiResponse = await callAI(hunter, prompt);\n    console.log('AI Response:', aiResponse);\n  } catch (aiError: any) {\n    console.log('‚ùå AI call failed:', aiError.message);\n    await logAction(userId, 'ai_hunter', `‚ùå AI error: ${aiError.message}`, 'failed', false);\n    \n    // Try fallback\n    const fallbackData = extractBasicInfo(pageData.content, url);\n    if (fallbackData.jobTitle) {\n      await runQuery('UPDATE job_listings', { id: jobId, ...fallbackData, status: 'analyzed', date_imported: new Date().toLocaleDateString() });\n    } else {\n      await runQuery('UPDATE job_listings', { id: jobId, status: 'manual_review' });\n    }\n    return;\n  }\n\n  // Check for AI errors in response\n  if (aiResponse.toLowerCase().includes('error:') || aiResponse.toLowerCase().includes('invalid api')) {\n    console.log('‚ùå AI returned error:', aiResponse);\n    await logAction(userId, 'ai_hunter', `‚ùå AI error: ${aiResponse.substring(0, 100)}`, 'failed', false);\n    await runQuery('UPDATE job_listings', { id: jobId, status: 'manual_review' });\n    return;\n  }\n\n  // Step 5: Parse AI response\n  console.log('Step 5: Parsing AI response...');\n  try {\n    // Clean the response\n    let cleanedResponse = aiResponse\n      .replace(/```json/gi, '')\n      .replace(/```/g, '')\n      .replace(/^[^{]*/, '')  // Remove anything before first {\n      .replace(/[^}]*$/, '')  // Remove anything after last }\n      .trim();\n    \n    // Try to find JSON\n    const jsonMatch = cleanedResponse.match(/\\{[\\s\\S]*\\}/);\n    if (!jsonMatch) {\n      console.log('‚ùå No JSON found in response');\n      throw new Error('No JSON in response');\n    }\n    \n    const data = JSON.parse(jsonMatch[0]);\n    console.log('Parsed data:', data);\n    \n    // Validate required fields\n    const jobTitle = data.jobTitle || data.title || data.job_title || '';\n    const companyName = data.companyName || data.company || data.company_name || data.hiringOrganization?.name || '';\n    \n    if (!jobTitle || jobTitle.toLowerCase() === 'n/a' || jobTitle.toLowerCase() === 'unknown') {\n      console.log('‚ùå Missing job title');\n      await logAction(userId, 'ai_auditor', `‚ùå Missing job title`, 'failed', false);\n      const fallbackData = extractBasicInfo(pageData.content, url);\n      if (fallbackData.jobTitle) {\n        await runQuery('UPDATE job_listings', { id: jobId, ...fallbackData, status: 'analyzed', date_imported: new Date().toLocaleDateString() });\n      } else {\n        await runQuery('DELETE FROM job_listings', { id: jobId });\n      }\n      return;\n    }\n\n    // Step 6: Save to database\n    console.log('Step 6: Saving to database...');\n    const updateData = {\n      id: jobId,\n      job_title: jobTitle,\n      company_name: companyName || 'Unknown Company',\n      location: data.location || data.jobLocation || 'N/A',\n      job_type: data.jobType || data.employmentType || 'N/A',\n      experience_level: data.experienceLevel || 'N/A',\n      salary_range: data.salaryRange || data.salary || data.baseSalary || 'N/A',\n      description: data.description || '',\n      required_skills: data.requiredSkills || data.skills || 'N/A',\n      remote_onsite: data.remoteOnsite || data.jobLocationType || 'N/A',\n      posted_date: data.postedDate || data.datePosted || 'N/A',\n      application_url: data.applicationUrl || data.url || url,\n      status: 'analyzed',\n      date_imported: new Date().toLocaleDateString()\n    };\n    \n    console.log('Update data:', updateData);\n    await runQuery('UPDATE job_listings', updateData);\n    \n    await logAction(userId, 'ai_auditor', `‚úÖ Extracted: ${jobTitle} at ${companyName}`, 'completed', true);\n    console.log(`‚úÖ SUCCESS: ${jobTitle} at ${companyName}`);\n    \n  } catch (parseError: any) {\n    console.log('‚ùå Parse error:', parseError.message);\n    await logAction(userId, 'ai_auditor', `‚ùå Parse failed`, 'failed', false);\n\n    // Final fallback\n    const fallbackData = extractBasicInfo(pageData.content, url);\n    if (fallbackData.jobTitle) {\n      await runQuery('UPDATE job_listings', { id: jobId, ...fallbackData, status: 'analyzed', date_imported: new Date().toLocaleDateString() });\n      console.log('‚úÖ Saved with fallback:', fallbackData);\n    } else {\n      await runQuery('UPDATE job_listings', { id: jobId, status: 'manual_review' });\n    }\n  }\n}\n\n/**\n * CHECK IF JOB IS A GHOST JOB\n * Uses heuristics: age, company reputation, and description patterns.\n */\nexport async function isGhostJob(jobData: any, userId: number): Promise<{ isGhost: boolean, reason: string }> {\n  console.log(`GJN: Checking reputation for ${jobData.company_name}...`);\n\n  // 1. Check Age (Heuristic)\n  if (jobData.posted_date && jobData.posted_date !== 'N/A') {\n    try {\n      const posted = new Date(jobData.posted_date);\n      const now = new Date();\n      const diffDays = (now.getTime() - posted.getTime()) / (1000 * 60 * 60 * 24);\n      if (diffDays > 30) {\n        return { isGhost: true, reason: \"Job posted more than 30 days ago.\" };\n      }\n    } catch (e) {}\n  }\n\n  // 2. Check Company Reputation\n  const db = getDatabase();\n  const flaggedCompanies = (db.company_monitoring || [])\n    .filter((c: any) => c.status === 'flagged')\n    .map((c: any) => c.name.toLowerCase());\n  \n  if (flaggedCompanies.includes(jobData.company_name.toLowerCase())) {\n    return { isGhost: true, reason: \"Company is flagged in your monitoring list.\" };\n  }\n\n  // 3. Check for \"Ghost\" patterns in description\n  const ghostKeywords = ['evergreen', 'pipeline', 'future opportunities', 'not a specific opening', 'general application'];\n  const desc = (jobData.description || '').toLowerCase();\n  if (ghostKeywords.some(k => desc.includes(k))) {\n    return { isGhost: true, reason: \"Description matches 'Evergreen/Pipeline' patterns.\" };\n  }\n\n  return { isGhost: false, reason: \"\" };\n}\n\nexport async function reportGhostJobLocal(jobId: number, userId: number, reason: string) {\n  console.log(`GJN: Flagging job ${jobId} as Ghost. Reason: ${reason}`);\n  await runQuery('UPDATE job_listings', { id: jobId, status: 'ghost_job_detected', ghost_reason: reason });\n}\n\n/**\n * FALLBACK: Extract basic info without AI\n */\nfunction extractBasicInfo(content: string, url: string): any {\n  console.log('Running fallback extraction...');\n  \n  const data: any = {\n    application_url: url\n  };\n  \n  // Try to extract from JSON-LD\n  try {\n    if (content.startsWith('{')) {\n      const json = JSON.parse(content);\n      data.job_title = json.title || json.jobTitle || json.name || '';\n      data.company_name = json.hiringOrganization?.name || json.companyName || json.company || '';\n      data.location = json.jobLocation?.address?.addressLocality || json.location || '';\n      data.job_type = json.employmentType || '';\n      data.description = json.description?.substring(0, 500) || '';\n      console.log('Extracted from JSON:', data);\n      return data;\n    }\n  } catch (e) {}\n  \n  // Try regex patterns on text\n  const lines = content.split('\\n').map(l => l.trim()).filter(l => l);\n  \n  // Job title is often in first few lines or after specific keywords\n  for (const line of lines.slice(0, 10)) {\n    if (line.length > 5 && line.length < 100 && !line.includes('cookie') && !line.includes('Sign')) {\n      if (!data.job_title) {\n        data.job_title = line;\n        break;\n      }\n    }\n  }\n  \n  // Look for company name patterns\n  const companyPatterns = [\n    /(?:at|@|by|company[:\\s]+)([A-Z][A-Za-z0-9\\s&.-]+)/i,\n    /([A-Z][A-Za-z0-9\\s&.-]+)(?:\\s+is hiring|\\s+jobs)/i\n  ];\n  \n  for (const pattern of companyPatterns) {\n    const match = content.match(pattern);\n    if (match && match[1]) {\n      data.company_name = match[1].trim();\n      break;\n    }\n  }\n  \n  // Location patterns\n  const locationPatterns = [\n    /(?:location|located in|based in)[:\\s]+([A-Za-z\\s,]+)/i,\n    /(Berlin|Munich|Hamburg|Frankfurt|London|Paris|Amsterdam|Remote)/i\n  ];\n  \n  for (const pattern of locationPatterns) {\n    const match = content.match(pattern);\n    if (match && match[1]) {\n      data.location = match[1].trim();\n      break;\n    }\n  }\n  \n  console.log('Fallback extracted:', data);\n  return data;\n}\n\nexport async function startHunterSearch(userId: number, callAI: Function) {\n  console.log('\\n========== STARTING HUNTER SEARCH ==========');\n  \n  try {\n    await logAction(userId, 'ai_hunter', 'üöÄ Starting job hunt...', 'in_progress');\n    \n    const db = getDatabase();\n    const profiles = db.search_profiles.filter((p: any) => p.is_active === 1);\n    const websites = db.job_websites.filter((w: any) => w.is_active === 1);\n    const models = await getAllQuery('SELECT * FROM ai_models');\n    \n    console.log('Search profiles:', profiles.length);\n    console.log('Job websites:', websites.length);\n    console.log('AI models:', models.length);\n    \n    const hunter = models.find((m: any) => m.role === 'Hunter' && m.status === 'active');\n    const auditor = models.find((m: any) => m.role === 'Auditor' && m.status === 'active');\n\n    console.log('Hunter:', hunter ? `${hunter.model_name} (key: ${hunter.api_key?.substring(0, 10)}...)` : 'NOT FOUND');\n    console.log('Auditor:', auditor ? auditor.model_name : 'NOT FOUND (will use Hunter)');\n\n    if (!hunter) {\n      const errorMsg = 'No active Hunter AI model. Go to Settings > AI Models and add one with role \"Hunter\".';\n      console.log('‚ùå', errorMsg);\n      await logAction(userId, 'ai_hunter', `‚ùå ${errorMsg}`, 'failed', false);\n      return { success: false, error: errorMsg };\n    }\n    \n    if (profiles.length === 0) {\n      const errorMsg = 'No active search profiles. Go to Search Profiles and create one.';\n      console.log('‚ùå', errorMsg);\n      await logAction(userId, 'ai_hunter', `‚ùå ${errorMsg}`, 'failed', false);\n      return { success: false, error: errorMsg };\n    }\n    \n    if (websites.length === 0) {\n      const errorMsg = 'No active job websites. Go to Job Websites and add one.';\n      console.log('‚ùå', errorMsg);\n      await logAction(userId, 'ai_hunter', `‚ùå ${errorMsg}`, 'failed', false);\n      return { success: false, error: errorMsg };\n    }\n\n    let totalJobsFound = 0;\n\n    for (const profile of profiles) {\n      console.log(`\\nProfile: ${profile.job_title} in ${profile.location}`);\n      \n      for (const website of websites) {\n        console.log(`Website: ${website.website_name} (${website.website_url})`);\n        \n        await logAction(userId, 'ai_hunter', `üåê Searching ${website.website_name}...`, 'in_progress');\n        \n        // Simple search query (don't waste AI tokens on this)\n        const query = profile.job_title;\n        console.log(`Search query: \"${query}\"`);\n        \n        // Scrape job URLs\n        const jobUrls = await scrapeJobs(\n          website.website_url, \n          query, \n          profile.location || '', \n          { email: website.email, password: website.password }, \n          userId, \n          callAI\n        );\n        \n        console.log(`Found ${jobUrls.length} URLs`);\n        await logAction(userId, 'ai_hunter', `üì• Found ${jobUrls.length} jobs on ${website.website_name}`, 'completed', true);\n        \n        // Process each URL\n        for (const url of jobUrls) {\n          // Skip duplicates\n          const existing = db.job_listings.find((j: any) => j.url === url);\n          if (existing) {\n            console.log(`Skipping duplicate: ${url}`);\n            continue;\n          }\n          \n          // Create job entry\n          const jobId = Date.now() + Math.floor(Math.random() * 1000);\n          await runQuery('INSERT INTO job_listings', { \n            id: jobId, \n            url, \n            source: website.website_name, \n            status: 'analyzing' \n          });\n          \n          totalJobsFound++;\n          console.log(`Added job ${jobId}: ${url}`);\n          \n          // Analyze immediately (wait for it to complete)\n          await analyzeJobUrl(jobId, userId, url, hunter, auditor || hunter, callAI);\n          \n          // Small delay\n          await new Promise(resolve => setTimeout(resolve, 2000));\n        }\n      }\n    }\n    \n    await logAction(userId, 'ai_hunter', `‚úÖ Done! Processed ${totalJobsFound} jobs.`, 'completed', true);\n    console.log(`\\n========== HUNT COMPLETE: ${totalJobsFound} jobs ==========\\n`);\n    return { success: true, jobsFound: totalJobsFound };\n    \n  } catch (error: any) { \n    console.error('Hunt error:', error);\n    await logAction(userId, 'ai_hunter', `‚ùå Error: ${error.message}`, 'failed', false);\n    return { success: false, error: error.message }; \n  }\n}","import puppeteer, { Browser, Page } from 'puppeteer';\nimport { logAction, getDatabase } from './database';\nimport path from 'path';\nlet app: any; try { app = require('electron').app; } catch (e) { app = (global as any).electronApp; }\n\nlet activeBrowser: Browser | null = null;\n\n// Get persistent user data directory for session cookies\nconst getUserDataDir = () => {\n  return path.join(app.getPath('userData'), 'browser_data');\n};\n\n/**\n * HELPER: LAUNCH BROWSER WITH PROXY SUPPORT\n * Automatically pulls proxy_url from the settings table.\n */\nasync function launchBrowser(options: { headless?: boolean | 'new', userDataDir?: string, args?: string[] } = {}): Promise<Browser> {\n  const db = getDatabase();\n  const settings = db.settings[0] || {};\n  const proxyServer = settings.proxy_url;\n\n  const defaultArgs = [\n    '--no-sandbox',\n    '--disable-setuid-sandbox',\n    '--disable-blink-features=AutomationControlled',\n    '--disable-infobars',\n    '--window-size=1280,800'\n  ];\n\n  if (proxyServer) {\n    console.log(`Scraper: Using proxy server: ${proxyServer}`);\n    defaultArgs.push(`--proxy-server=${proxyServer}`);\n  }\n\n  const launchOptions: any = {\n    headless: options.headless !== undefined ? options.headless : false,\n    userDataDir: options.userDataDir || getUserDataDir(),\n    args: [...defaultArgs, ...(options.args || [])]\n  };\n\n  const browser = await puppeteer.launch(launchOptions);\n\n  // Handle proxy authentication if credentials are provided in the URL\n  if (proxyServer && proxyServer.includes('@')) {\n    const authPart = proxyServer.split('@')[0].replace('http://', '').replace('https://', '');\n    const [username, password] = authPart.split(':');\n    if (username && password) {\n      const page = (await browser.pages())[0] || await browser.newPage();\n      await page.authenticate({ username, password });\n    }\n  }\n\n  return browser;\n}\n\n/**\n * Random delay to simulate human behavior\n */\nfunction randomDelay(min: number, max: number): Promise<void> {\n  const delay = Math.floor(Math.random() * (max - min + 1)) + min;\n  return new Promise(resolve => setTimeout(resolve, delay));\n}\n\n/**\n * COOKIE BANNER BYPASS\n */\nasync function handleCookieRoadblock(page: Page, userId: number, callAI: Function) {\n  try {\n    const isBannerVisible = await page.evaluate(() => {\n      const text = document.body.innerText.toLowerCase();\n      return text.includes('cookie') || text.includes('accept') || text.includes('agree') || text.includes('zustimmen') || text.includes('akzeptieren');\n    });\n    \n    if (!isBannerVisible) return;\n\n    await logAction(userId, 'ai_observer', 'üì∏ Cookie banner detected. Attempting bypass...', 'in_progress');\n    \n    // Try DOM-based click first (faster & more reliable)\n    const clicked = await page.evaluate(() => {\n      const selectors = [\n        'button[data-testid=\"cookie-policy-dialog-accept-button\"]',\n        'button[id*=\"reject\"]', 'button[id*=\"decline\"]', 'button[id*=\"ablehnen\"]',\n        'button[class*=\"reject\"]', 'button[class*=\"decline\"]',\n        '[data-tracking-control-name*=\"cookie\"]',\n        'button.artdeco-button--secondary'\n      ];\n      \n      for (const sel of selectors) {\n        const btn = document.querySelector(sel) as HTMLElement;\n        if (btn) { btn.click(); return true; }\n      }\n      \n      // Fallback: find by text content\n      const btns = Array.from(document.querySelectorAll('button, a, div[role=\"button\"]'));\n      const rejectBtn = btns.find(b => {\n        const txt = b.textContent?.toLowerCase() || '';\n        return txt.includes('reject') || txt.includes('decline') || txt.includes('ablehnen') || txt.includes('nur notwendige') || txt.includes('essential');\n      });\n      if (rejectBtn) { (rejectBtn as HTMLElement).click(); return true; }\n      \n      // Last resort: accept\n      const acceptBtn = btns.find(b => {\n        const txt = b.textContent?.toLowerCase() || '';\n        return txt.includes('accept') || txt.includes('agree') || txt.includes('akzeptieren') || txt.includes('alle akzeptieren');\n      });\n      if (acceptBtn) { (acceptBtn as HTMLElement).click(); return true; }\n      \n      return false;\n    });\n\n    if (clicked) {\n      await logAction(userId, 'ai_observer', '‚úÖ Cookie banner dismissed', 'completed', true);\n      await randomDelay(1500, 2500);\n    }\n  } catch (e) {\n    console.log('Cookie bypass error:', e);\n  }\n}\n\n/**\n * Check if page is blocked by bot detection\n */\nasync function isPageBlocked(page: Page): Promise<boolean> {\n  return await page.evaluate(() => {\n    const text = document.body.innerText.toLowerCase();\n    return text.includes('verify you are human') || \n           text.includes('captcha') || \n           text.includes('unusual traffic') ||\n           text.includes('sign in to view') ||\n           text.includes('please verify') ||\n           text.includes('robot') ||\n           text.includes('blocked');\n  });\n}\n\n/**\n * SCRAPING - GET JOB PAGE CONTENT\n * Tries multiple extraction strategies\n */\nexport async function getJobPageContent(url: string, userId: number, callAI: Function): Promise<{ content: string, strategyUsed: string }> {\n  let browser: Browser | null = null;\n  \n  try {\n    console.log(`Scraper: Opening ${url}`);\n    \n    browser = await launchBrowser({ headless: false });\n    \n    const page = await browser.newPage();\n    \n    // Stealth settings\n    await page.setViewport({ width: 1280, height: 800 });\n    await page.setUserAgent('Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36');\n    \n    // Hide webdriver property\n    await page.evaluateOnNewDocument(() => {\n      Object.defineProperty(navigator, 'webdriver', { get: () => false });\n      Object.defineProperty(navigator, 'plugins', { get: () => [1, 2, 3, 4, 5] });\n      Object.defineProperty(navigator, 'languages', { get: () => ['en-US', 'en', 'de'] });\n    });\n    \n    await page.goto(url, { waitUntil: 'networkidle2', timeout: 60000 });\n    \n    // Handle cookie banner\n    await handleCookieRoadblock(page, userId, callAI);\n    \n    // Human-like scrolling\n    await page.evaluate(() => window.scrollBy(0, 300));\n    await randomDelay(800, 1500);\n    await page.evaluate(() => window.scrollBy(0, 400));\n    await randomDelay(1500, 3000);\n\n    // Check if blocked\n    if (await isPageBlocked(page)) {\n      console.log('Scraper: Page blocked by bot detection');\n      return { content: '', strategyUsed: 'Blocked' };\n    }\n\n    // Try extraction strategies in order\n    const result = await page.evaluate(() => {\n      const getCleanText = (el: Element | null) => el ? (el as HTMLElement).innerText.replace(/\\s+/g, ' ').trim() : '';\n      \n      // STRATEGY 1: JSON-LD (Most reliable - structured data)\n      const jsonLdScripts = document.querySelectorAll('script[type=\"application/ld+json\"]');\n      for (const script of jsonLdScripts) {\n        try {\n          const data = JSON.parse(script.textContent || '');\n          // Check if it's a JobPosting\n          if (data['@type'] === 'JobPosting' || data.title || data.jobTitle) {\n            console.log('Found JSON-LD JobPosting');\n            return { content: JSON.stringify(data, null, 2), strategy: 'JSON-LD' };\n          }\n          // Check for array format\n          if (Array.isArray(data)) {\n            const job = data.find((item: any) => item['@type'] === 'JobPosting');\n            if (job) {\n              return { content: JSON.stringify(job, null, 2), strategy: 'JSON-LD' };\n            }\n          }\n          // Check for @graph format\n          if (data['@graph']) {\n            const job = data['@graph'].find((item: any) => item['@type'] === 'JobPosting');\n            if (job) {\n              return { content: JSON.stringify(job, null, 2), strategy: 'JSON-LD' };\n            }\n          }\n        } catch (e) {}\n      }\n      \n      // STRATEGY 2: Job-specific selectors\n      const jobSelectors = [\n        '.job-description', \n        '#jobDescriptionText', \n        '.description__text', \n        '.show-more-less-html__markup', \n        '.jobs-description__content',\n        '.jobs-box__html-content',\n        '[data-testid=\"job-description\"]', \n        '.job-details',\n        '.jobsearch-JobComponent-description',\n        '#job-details'\n      ];\n      \n      for (const sel of jobSelectors) {\n        const el = document.querySelector(sel);\n        if (el && el.textContent && el.textContent.length > 300) {\n          return { content: getCleanText(el), strategy: `Selector: ${sel}` };\n        }\n      }\n      \n      // STRATEGY 3: Semantic HTML tags\n      const semanticEls = document.querySelectorAll('main, article, [role=\"main\"]');\n      for (const el of semanticEls) {\n        if (el.textContent && el.textContent.length > 500) {\n          return { content: getCleanText(el), strategy: 'Semantic' };\n        }\n      }\n      \n      // STRATEGY 4: Find largest content block\n      const divs = Array.from(document.querySelectorAll('div, section'));\n      const blocks = divs\n        .map(el => ({ el, text: getCleanText(el), len: el.textContent?.length || 0 }))\n        .filter(b => b.len > 500 && b.len < 50000)\n        .sort((a, b) => b.len - a.len);\n      \n      if (blocks.length > 0) {\n        return { content: blocks[0].text, strategy: 'Density' };\n      }\n\n      // STRATEGY 5: Full body (last resort)\n      const bodyText = getCleanText(document.body);\n      if (bodyText.length > 300) {\n        return { content: bodyText.substring(0, 15000), strategy: 'Body' };\n      }\n      \n      return { content: '', strategy: 'Empty' };\n    });\n\n    console.log(`Scraper: Extracted using ${result.strategy}, length: ${result.content.length}`);\n    return { content: result.content, strategyUsed: result.strategy };\n    \n  } catch (error: any) {\n    console.error('Scraper Error:', error.message);\n    return { content: '', strategyUsed: 'Failed: ' + error.message };\n  } finally {\n    if (browser) {\n      await browser.close();\n    }\n  }\n}\n\n/**\n * SCRAPE JOB LISTING URLS FROM SEARCH RESULTS\n */\nexport async function scrapeJobs(baseUrl: string, query: string, location: string, credentials?: any, userId?: number, callAI?: Function): Promise<string[]> {\n  let browser: Browser | null = null;\n  const jobUrls: string[] = [];\n  \n  try {\n    console.log(`Scraper: Searching for \"${query}\" in \"${location}\" on ${baseUrl}`);\n    \n    browser = await launchBrowser({ headless: false, args: ['--start-maximized'] });\n    \n    const page = await browser.newPage();\n    await page.setViewport({ width: 1280, height: 800 });\n    await page.setUserAgent('Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36');\n    \n    // Hide webdriver\n    await page.evaluateOnNewDocument(() => {\n      Object.defineProperty(navigator, 'webdriver', { get: () => false });\n    });\n    \n    // Build search URL based on website\n    let searchUrl: string;\n    if (baseUrl.includes('linkedin.com')) {\n      searchUrl = `https://www.linkedin.com/jobs/search/?keywords=${encodeURIComponent(query)}&location=${encodeURIComponent(location)}`;\n    } else if (baseUrl.includes('indeed')) {\n      searchUrl = `https://de.indeed.com/jobs?q=${encodeURIComponent(query)}&l=${encodeURIComponent(location)}`;\n    } else if (baseUrl.includes('glassdoor')) {\n      searchUrl = `https://www.glassdoor.com/Job/jobs.htm?sc.keyword=${encodeURIComponent(query)}&locT=C&locKeyword=${encodeURIComponent(location)}`;\n    } else if (baseUrl.includes('xing')) {\n      searchUrl = `https://www.xing.com/jobs/search?keywords=${encodeURIComponent(query)}&location=${encodeURIComponent(location)}`;\n    } else {\n      searchUrl = baseUrl;\n    }\n    \n    console.log(`Scraper: Navigating to ${searchUrl}`);\n    await page.goto(searchUrl, { waitUntil: 'networkidle2', timeout: 60000 });\n    \n    // Handle cookies\n    if (callAI && userId) {\n      await handleCookieRoadblock(page, userId, callAI);\n    }\n    \n    // Human-like behavior - wait and scroll\n    await randomDelay(2000, 4000);\n    await page.evaluate(() => window.scrollBy(0, 400));\n    await randomDelay(1000, 2000);\n    await page.evaluate(() => window.scrollBy(0, 400));\n    await randomDelay(2000, 4000);\n    \n    // Check if blocked\n    if (await isPageBlocked(page)) {\n      console.log('Scraper: Search page blocked');\n      if (userId) {\n        await logAction(userId, 'ai_hunter', 'üö´ Search page blocked by bot detection', 'failed', false);\n      }\n      return [];\n    }\n    \n    // Extract job URLs\n    const links = await page.evaluate(() => {\n      const selectors = [\n        // LinkedIn\n        'a.job-card-container__link',\n        'a.base-card__full-link',\n        'a[data-tracking-control-name=\"public_jobs_jserp-result_search-card\"]',\n        '.jobs-search__results-list a',\n        // Indeed\n        'a.jcs-JobTitle',\n        'h2.jobTitle a',\n        '.job_seen_beacon a[data-jk]',\n        '.jobsearch-ResultsList a.tapItem',\n        // Glassdoor\n        'a.job-title',\n        '.react-job-listing a',\n        // Xing\n        'a[data-testid=\"job-posting-link\"]',\n        '.jobs-list a',\n        // Generic\n        'a[href*=\"/job/\"]',\n        'a[href*=\"/jobs/\"]',\n        'a[href*=\"jobPosting\"]'\n      ];\n      \n      const foundLinks: string[] = [];\n      \n      selectors.forEach(selector => {\n        document.querySelectorAll(selector).forEach(el => {\n          const href = (el as HTMLAnchorElement).href;\n          if (href && \n              href.startsWith('http') && \n              !foundLinks.includes(href) &&\n              !href.includes('/login') &&\n              !href.includes('/signup') &&\n              !href.includes('/register')) {\n            foundLinks.push(href);\n          }\n        });\n      });\n      \n      return foundLinks;\n    });\n    \n    // Limit to first 15 unique URLs\n    const uniqueLinks = [...new Set(links)].slice(0, 15);\n    jobUrls.push(...uniqueLinks);\n    \n    console.log(`Scraper: Found ${jobUrls.length} job URLs`);\n    \n  } catch (error: any) { \n    console.error('Scraper Error:', error.message); \n  } finally { \n    if (browser) {\n      await browser.close();\n    }\n  }\n  \n  return jobUrls;\n}\n\n/**\n * Open browser for manual login warm-up\n */\nexport async function openLinkedIn(userId: number, url: string) {\n  activeBrowser = await launchBrowser({ headless: false, args: ['--start-maximized'] });\n  const page = await activeBrowser.newPage();\n  await page.goto(url, { waitUntil: 'domcontentloaded' });\n  return { success: true };\n}\n\n/**\n * SEARCH AND SCRAPE COMPANY INFO\n */\nexport async function getCompanyInfo(companyName: string, userId: number, callAI: Function): Promise<string> {\n  let browser: Browser | null = null;\n  try {\n    console.log(`Scraper: Researching company: ${companyName}`);\n    await logAction(userId, 'ai_observer', `üîç Researching company: ${companyName}`, 'in_progress');\n\n    browser = await launchBrowser({ headless: true });\n    const page = await browser.newPage();\n    await page.setUserAgent('Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36');\n\n    // Step 1: Find official website\n    const siteSearchUrl = `https://www.google.com/search?q=${encodeURIComponent(companyName + \" official website\")}`;\n    await page.goto(siteSearchUrl, { waitUntil: 'networkidle2' });\n    const officialSite = await page.evaluate(() => document.querySelector('div.g a')?.getAttribute('href'));\n    \n    // Step 2: Search for mission/about\n    const searchUrl = officialSite \n      ? `https://www.google.com/search?q=site:${new URL(officialSite).hostname} mission history about`\n      : `https://www.google.com/search?q=${encodeURIComponent(companyName + \" company mission history news\")}`;\n\n    await page.goto(searchUrl, { waitUntil: 'networkidle2' });\n\n    // Get the first few organic results\n    const links = await page.evaluate(() => {\n      return Array.from(document.querySelectorAll('div.g a'))\n        .map(a => (a as HTMLAnchorElement).href)\n        .filter(href => href && !href.includes('google.com'))\n        .slice(0, 2);\n    });\n\n    let combinedInfo = \"\";\n    for (const link of links) {\n      try {\n        await page.goto(link, { waitUntil: 'networkidle2', timeout: 30000 });\n        const text = await page.evaluate(() => {\n          const body = document.body.innerText;\n          return body.substring(0, 5000).replace(/\\s+/g, ' ').trim();\n        });\n        combinedInfo += `\\n--- Source: ${link} ---\\n${text}\\n`;\n      } catch (e) {\n        console.log(`Failed to scrape ${link}:`, e);\n      }\n    }\n\n    return combinedInfo || \"No specific company info found.\";\n  } catch (error: any) {\n    console.error('Company Research Error:', error.message);\n    return \"Error researching company: \" + error.message;\n  } finally {\n    if (browser) await browser.close();\n  }\n}\n\n/**\n * CAPTURE SCREENSHOT FOR AI OBSERVER\n */\nexport async function capturePageScreenshot(page: Page): Promise<string> {\n  const screenshot = await page.screenshot({ encoding: 'base64' });\n  return `data:image/png;base64,${screenshot}`;\n}\n\n/**\n * EXECUTE MOUSE ACTION BASED ON COORDINATES\n */\nexport async function executeMouseAction(page: Page, action: { type: 'click' | 'type' | 'upload', x: number, y: number, text?: string, filePath?: string }) {\n  console.log(`AI Mouse: Executing ${action.type} at (${action.x}, ${action.y})`);\n  \n  // Move mouse with jitter\n  await page.mouse.move(action.x + Math.random() * 5, action.y + Math.random() * 5, { steps: 10 });\n  await randomDelay(200, 500);\n\n  if (action.type === 'click') {\n    await page.mouse.click(action.x, action.y);\n  } else if (action.type === 'type' && action.text) {\n    await page.mouse.click(action.x, action.y);\n    await randomDelay(100, 300);\n    await page.keyboard.type(action.text, { delay: Math.random() * 100 + 50 });\n  } else if (action.type === 'upload' && action.filePath) {\n    // For upload, we often need to click the button first to trigger the file picker, \n    // but Puppeteer's fileChooser is more reliable if we can find the input.\n    // Fallback: click the coordinates and hope for the best, or use fileChooser.\n    const [fileChooser] = await Promise.all([\n      page.waitForFileChooser(),\n      page.mouse.click(action.x, action.y),\n    ]);\n    await fileChooser.accept([action.filePath]);\n  }\n}\n\n/**\n * GET FORM COORDINATES VIA AI OBSERVER\n */\nexport async function getFormCoordinates(page: Page, userId: number, observerModel: any, callAI: Function): Promise<any[]> {\n  await logAction(userId, 'ai_observer', 'üì∏ Analyzing page layout visually...', 'in_progress');\n  \n  const screenshot = await capturePageScreenshot(page);\n  const prompt = `\n    Analyze this screenshot of a job application form. \n    Identify the (x, y) coordinates for the following fields:\n    - First Name\n    - Last Name\n    - Email\n    - Phone Number\n    - Upload CV/Resume button\n    - Submit button\n    \n    Return ONLY a JSON array of objects:\n    [{\"field\": \"first_name\", \"x\": 123, \"y\": 456}, ...]\n    \n    The coordinates should be relative to the top-left of the image (1280x800).\n  `;\n\n  const response = await callAI(observerModel, prompt, screenshot);\n  try {\n    const cleaned = response.replace(/```json/gi, '').replace(/```/g, '').trim();\n    return JSON.parse(cleaned);\n  } catch (e) {\n    console.error(\"Failed to parse observer response:\", e);\n    return [];\n  }\n}","import { runQuery, getDatabase, logAction } from '../database';\nimport { getCompanyInfo } from '../scraper-service';\n\nexport async function generateTailoredDocs(job: any, userId: number, thinker: any, auditor: any, options: any, callAI: Function) {\n  const db = getDatabase();\n  const userProfile = db.user_profile.find((p: any) => p.id === userId) || db.user_profile[0];\n  \n  const docTypes = [\n    { key: 'cv', label: 'CV' },\n    { key: 'motivation_letter', label: 'Motivation Letter' },\n    { key: 'portfolio', label: 'Portfolio' },\n    { key: 'proposal', label: 'Proposal' },\n    { key: 'cover_letter', label: 'Cover Letter' }\n  ];\n\n  // Step 0: Research Company\n  let companyResearch = \"\";\n  try {\n    await logAction(userId, 'ai_thinker', `üîç Researching ${job.company_name} mission and history...`, 'in_progress');\n    companyResearch = await getCompanyInfo(job.company_name, userId, callAI);\n  } catch (e) {\n    console.error(\"Research failed:\", e);\n    companyResearch = \"Research unavailable.\";\n  }\n\n  for (const type of docTypes) {\n    const optionKey = type.key === 'motivation_letter' ? 'motivationLetter' : type.key;\n    if (options[optionKey]) {\n      try {\n        await logAction(userId, 'ai_thinker', `‚úçÔ∏è Generating tailored ${type.label} for ${job.company_name}`, 'in_progress');\n        await runQuery('UPDATE job_listings', { id: job.id, [`${type.key}_status`]: 'generating' });\n\n        let attempts = 0;\n        let approved = false;\n        let content = '';\n        let feedback = '';\n\n        while (attempts < 2 && !approved) {\n          attempts++;\n          \n          const thinkerPrompt = `\n            You are the \"Thinker\" agent. Your task is to generate a highly tailored ${type.label} that sounds 100% HUMAN with some common writing mistakes randomly.\n            \n            NEGATIVE PROMPT (DO NOT USE):\n            - Clich√©s: \"I am thrilled to apply\", \"In today's fast-paced world\", \"I am a passionate professional\", \"I believe I am a perfect fit\".\n            - AI Structures: Repetitive \"I have...\" or \"My experience...\" at the start of every sentence.\n            - Formatting: No long hyphens (‚Äî), use standard dashes (-) if needed. No bullet points. Do not exceed more than one full page for motivation letters.\n            \n            STRICT 6-POINT STRUCTURE:\n            1. CLEAR PURPOSE: State intent upfront. Who are you and why are you writing?\n            2. RESEARCH: Reference specific facts from the company research below (Mission, History, News). Show you've done your homework.\n            3. ALIGNMENT: Connect your personal goals to their mission. Why this company specifically?\n            4. QUALIFICATIONS: Highlight 2-3 key achievements. Use METRICS (e.g., \"increased efficiency by 20%\").\n            5. PASSION: Why this role? Why are you the best candidate? Convey genuine enthusiasm.\n            6. CLOSING: Professional sign-off, thank the reader, and suggest next steps.\n            \n            LANGUAGE: Must match the Job Description language.\n            CONTACT INFO: Include applicant's info at the very top.\n            ATS FRIENDLY: Use clear headings no bullet points, and standard formatting. use keywoards from the job description.\n            \n          \n\n            LANGUAGE REQUIREMENT:\n            The output MUST be in the same language as the Job Description provided below.\n            \n            USER PROFILE:\n            Name: ${userProfile?.name}\n            Title: ${userProfile?.title}\n            Experiences: ${userProfile?.experiences}\n            Skills: ${userProfile?.skills}\n            Contact Info: ${userProfile?.email || ''}, ${userProfile?.phone || ''}, ${userProfile?.location || ''}\n            \n            JOB DETAILS:\n            Title: ${job.job_title}\n            Company: ${job.company_name}\n            Description: ${job.description}\n            Required Skills: ${job.required_skills}\n            \n            COMPANY RESEARCH:\n            ${companyResearch}\n            \n            ${feedback ? `PREVIOUS FEEDBACK FROM AUDITOR: ${feedback}\\nPlease fix these issues in the new version.` : ''}\n            \n            STRICT GUIDELINES:\n            1. HUMAN-LIKE CONTENT: Avoid AI-generated clich√©s. Do not use long hyphens (‚Äî) or repetitive word structures. Be authentic and concise.\n            2. CONTACT INFO: Include the applicant's contact info at the top.\n            3. ATS FRIENDLY: Use clear headings and standard formatting.\n            4. MOTIVATION/COVER LETTER STRUCTURE:\n               - 1. Clear Purpose: State intent upfront and introduce yourself briefly.\n               - 2. Research & Specific Interest: Show you've done your homework. Reference the company's mission, history, or news from the research provided. Avoid generic statements.\n               - 3. Alignment: Connect your aspirations to the organization's mission and values.\n               - 4. Qualifications: Highlight key skills/experiences directly related to the role. QUANTIFY achievements with metrics (e.g., \"reduced time by 30%\").\n               - 5. Passion: Convey genuine enthusiasm and explain why you are the best fit.\n               - 6. Professional Closing: Reiterate eagerness, thank the reader, and offer next steps.\n            5. 3 MAIN QUESTIONS: The letter must answer: Why this company? Why this role? Why am I the best candidate?\n            6. NO PLACEHOLDERS: Do not use [Company Name] or [Date]. Use the actual data.\n            \n            Return ONLY the content of the ${type.label}.\n          `;\n\n          content = await callAI(thinker, thinkerPrompt);\n          \n          await logAction(userId, 'ai_auditor', `üßê Auditing ${type.label} (Attempt ${attempts})`, 'in_progress');\n          \n          const auditorPrompt = `\n            You are the \"Auditor\" agent. Review this ${type.label} for accuracy and quality.\n            \n            JOB: ${job.job_title} at ${job.company_name}\n            CONTENT:\n            ${content}\n            \n            CRITERIA:\n            1. LANGUAGE: Is it in the same language as the job description?\n            2. HUMAN-LIKE: Does it avoid AI clich√©s and long hyphens?\n            3. CONTACT INFO: Is the applicant's contact info at the top?\n            4. ATS FRIENDLY: Is the structure clear?\n            5. RESEARCH: Does it reference specific company mission/history/news from the research?\n            6. 3 QUESTIONS: Does it answer Why Company, Why Role, and Why Candidate?\n            7. STRUCTURE: Does it follow the 6-point structure (Purpose, Research, Alignment, Qualifications, Passion, Closing)?\n            8. QUANTIFIED: Are achievements quantified with metrics?\n            9. NO PLACEHOLDERS: Are there any \"[Insert...]\" or \"XYZ\"?\n            \n            If it passes all criteria, respond with \"APPROVED\".\n            If it fails, respond with \"REJECTED: \" followed by specific feedback on what to fix.\n          `;\n\n          const auditResponse = await callAI(auditor, auditorPrompt);\n          \n          if (auditResponse.toUpperCase().includes('APPROVED')) {\n            approved = true;\n            await logAction(userId, 'ai_auditor', `‚úÖ ${type.label} approved`, 'completed', true);\n          } else {\n            feedback = auditResponse.replace(/REJECTED:/i, '').trim();\n            await logAction(userId, 'ai_auditor', `‚ùå ${type.label} rejected: ${feedback}`, 'in_progress', false);\n          }\n        }\n\n        if (approved) {\n          // Save to documents table\n          const docId = Date.now() + Math.floor(Math.random() * 1000);\n          await runQuery('INSERT INTO documents', {\n            id: docId,\n            job_id: job.id,\n            user_id: userId,\n            document_type: type.key,\n            content: content,\n            version: 1,\n            status: 'final'\n          });\n\n          await runQuery('UPDATE job_listings', { id: job.id, [`${type.key}_status`]: 'auditor_done' });\n        } else {\n          await runQuery('UPDATE job_listings', { id: job.id, [`${type.key}_status`]: 'failed' });\n          await logAction(userId, 'ai_thinker', `‚ùå Failed to generate acceptable ${type.label} after 2 attempts`, 'failed', false);\n        }\n\n      } catch (e: any) {\n        console.error(`Error generating ${type.key}:`, e);\n        await runQuery('UPDATE job_listings', { id: job.id, [`${type.key}_status`]: 'failed' });\n        await logAction(userId, 'ai_thinker', `‚ùå Error: ${e.message}`, 'failed', false);\n      }\n    }\n  }\n}","import { getDatabase, logAction, runQuery } from '../database';\nimport { getFormCoordinates, executeMouseAction } from '../scraper-service';\nimport puppeteer from 'puppeteer';\nimport path from 'path';\nimport { app } from 'electron';\n\nexport async function submitApplication(jobId: number, userId: number, observerModel: any, callAI: Function) {\n  console.log(`\\n========== SUBMITTING APPLICATION FOR JOB ${jobId} ==========`);\n  \n  try {\n    const db = getDatabase();\n    const job = db.job_listings.find((j: any) => j.id === jobId);\n    const userProfile = db.user_profile.find((p: any) => p.id === userId) || db.user_profile[0];\n    const tailoredDoc = db.documents.find((d: any) => d.job_id === jobId && d.document_type === 'cv');\n\n    if (!job || !job.application_url) {\n      throw new Error(\"Job or application URL not found\");\n    }\n\n    await logAction(userId, 'ai_mouse', `üñ±Ô∏è Starting automated submission for ${job.company_name}`, 'in_progress');\n\n    const browser = await puppeteer.launch({ \n      headless: false,\n      userDataDir: path.join(app.getPath('userData'), 'browser_data'),\n      args: ['--no-sandbox', '--start-maximized']\n    });\n\n    const page = await browser.newPage();\n    await page.setViewport({ width: 1280, height: 800 });\n    await page.goto(job.application_url, { waitUntil: 'networkidle2', timeout: 60000 });\n\n    // Step 1: Get coordinates via AI Observer\n    const coordinates = await getFormCoordinates(page, userId, observerModel, callAI);\n    console.log(\"Form coordinates identified:\", coordinates);\n\n    // Step 2: Fill form using AI Mouse\n    for (const coord of coordinates) {\n      let value = \"\";\n      if (coord.field === 'first_name') value = userProfile.name.split(' ')[0];\n      else if (coord.field === 'last_name') value = userProfile.name.split(' ').slice(1).join(' ');\n      else if (coord.field === 'email') value = userProfile.email || \"\";\n      else if (coord.field === 'phone') value = userProfile.phone || \"\";\n      \n      if (value) {\n        await executeMouseAction(page, { type: 'type', x: coord.x, y: coord.y, text: value });\n      } else if (coord.field.includes('upload') && tailoredDoc) {\n        // Save content to a temporary file for uploading\n        const fs = require('fs');\n        const tempPath = path.join(app.getPath('temp'), `tailored_cv_${jobId}.txt`);\n        fs.writeFileSync(tempPath, tailoredDoc.content);\n        await executeMouseAction(page, { type: 'upload', x: coord.x, y: coord.y, filePath: tempPath });\n      }\n    }\n\n    // Step 3: Final Review & Submit\n    const submitBtn = coordinates.find((c: any) => c.field === 'submit');\n    if (submitBtn) {\n      await logAction(userId, 'ai_auditor', 'üßê Final visual check before submission...', 'in_progress');\n      await executeMouseAction(page, { type: 'click', x: submitBtn.x, y: submitBtn.y });\n      await logAction(userId, 'ai_mouse', `‚úÖ Application submitted to ${job.company_name}`, 'completed', true);\n      await runQuery('UPDATE job_listings', { id: jobId, status: 'submitted' });\n    }\n\n    await new Promise(resolve => setTimeout(resolve, 5000));\n    await browser.close();\n    return { success: true };\n\n  } catch (error: any) {\n    console.error(\"Submission Error:\", error);\n    await logAction(userId, 'ai_mouse', `‚ùå Submission failed: ${error.message}`, 'failed', false);\n    return { success: false, error: error.message };\n  }\n}"],"mappings":"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","names":["fs","path","Imap","err","startHunterSearch","callAI","import_electron","import_path","import_electron","import_path","app","path","app","puppeteer","callAI","callAI","callAI","callAI","callAI","import_puppeteer","import_path","import_electron","callAI","puppeteer","path","fs","axios","startHunterSearch","analyzeJobUrl","startHuntingScheduler","import_axios","analyzeJobUrl","startHunterSearch","axios","shell","setSchedulerEnabled","startHuntingScheduler","path","isDev"]}