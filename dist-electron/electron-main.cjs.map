{"version":3,"sources":["../src/main/database.ts","../src/main/features/linkedin-scraper.ts","../src/main/scraper-service.ts","../src/main/features/compatibility-service.ts","../src/main/features/Hunter-engine.ts","../src/main/features/doc-generator.ts","../src/main/features/secretary-service.ts","../src/main/features/scheduler.ts","../src/main/features/smart-applicant.ts","../src/main/features/pdf-export.ts","../electron-main.ts","../src/main/ipc/index.ts","../src/main/ipc/settings-handlers.ts","../src/main/ipc/user-handlers.ts","../src/main/ipc/profiles-handlers.ts","../src/main/ipc/jobs-handlers.ts","../src/main/ai-service.ts","../src/main/features/application-submitter.ts","../src/main/ipc/ai-handlers.ts","../src/main/ipc/docs-handlers.ts","../src/main/ipc/websites-handlers.ts","../src/main/ipc/ai-models-handlers.ts","../src/main/ipc/system-handlers.ts","../src/main/ipc/services-handlers.ts","../src/main/features/email-service.ts","../src/main/features/secretary-auth.ts"],"sourcesContent":["import path from 'path';\nimport { app } from 'electron';\nimport fs from 'fs';\n\nlet dbData: any = (global as any).dbData || null;\n\nconst getDbPath = () => {\n  const dataDir = path.join(app.getPath('userData'), 'data');\n  if (!fs.existsSync(dataDir)) fs.mkdirSync(dataDir, { recursive: true });\n  return path.join(dataDir, 'db.json');\n};\n\nexport function getDatabase(): any {\n  if (!dbData) {\n    const dbPath = getDbPath();\n    if (fs.existsSync(dbPath)) {\n      try { dbData = JSON.parse(fs.readFileSync(dbPath, 'utf8')); } \n      catch (e) { dbData = getDefaultData(); }\n    } else { dbData = getDefaultData(); }\n    (global as any).dbData = dbData;\n  }\n  const tables = ['user_profile', 'email_config', 'job_preferences', 'ai_models', 'job_websites', 'company_monitoring', 'job_listings', 'applications', 'action_logs', 'email_alerts', 'documents', 'search_profiles', 'settings', 'questions'];\n  tables.forEach(t => { if (!dbData[t]) dbData[t] = []; });\n  return dbData;\n}\n\nconst getDefaultData = () => ({\n  user_profile: [], email_config: [], job_preferences: [], ai_models: [],\n  job_websites: [], company_monitoring: [], job_listings: [],\n  applications: [], action_logs: [], email_alerts: [],\n  documents: [], search_profiles: [], settings: [], questions: []\n});\n\nconst saveDb = () => {\n  try {\n    fs.writeFileSync(getDbPath(), JSON.stringify(dbData, null, 2));\n    console.log('DB: Saved to disk');\n  } catch (e) {\n    console.error('DB: Save failed', e);\n  }\n};\n\nexport async function initializeDatabase(): Promise<void> { getDatabase(); }\n\nconst toSnakeCase = (str: string) => str.replace(/[A-Z]/g, letter => `_${letter.toLowerCase()}`);\n\nconst mapToSnakeCase = (obj: any) => {\n  const newObj: any = {};\n  for (const key in obj) { \n    newObj[toSnakeCase(key)] = obj[key]; \n  }\n  return newObj;\n};\n\nexport async function runQuery(sql: string, params: any = []): Promise<any> {\n  const db = getDatabase();\n  \n  // Parse SQL to get operation and table\n  const sqlUpper = sql.toUpperCase();\n  const sqlParts = sql.trim().split(/\\s+/);\n  \n  let table = '';\n  if (sqlUpper.includes('INSERT INTO')) {\n    table = sqlParts[2];\n  } else if (sqlUpper.includes('UPDATE')) {\n    table = sqlParts[1];\n  } else if (sqlUpper.includes('DELETE FROM')) {\n    table = sqlParts[2];\n  }\n  table = table.replace(/[`\"']/g, '');\n  \n  console.log(`DB: ${sqlUpper.split(' ')[0]} on \"${table}\"`);\n  \n  if (!db[table]) {\n    console.log(`DB: Table \"${table}\" not found!`);\n    return { success: false, error: 'Table not found' };\n  }\n  \n  // Get data from params\n  const newData = Array.isArray(params) ? params[0] : params;\n  \n  // INSERT\n  if (sqlUpper.includes('INSERT')) {\n    const mapped = mapToSnakeCase(newData);\n    \n    // USE THE PROVIDED ID if it exists, otherwise generate one\n    const recordId = mapped.id || newData.id || Date.now();\n    \n    const record = { \n      ...mapped, \n      id: recordId,\n      is_active: mapped.is_active ?? 1, \n      timestamp: new Date().toISOString() \n    };\n    \n    db[table].push(record);\n    saveDb();\n    \n    console.log(`DB: Inserted into ${table} with id=${recordId}`);\n    return { id: recordId, success: true };\n  } \n  \n  // UPDATE\n  else if (sqlUpper.includes('UPDATE')) {\n    const mapped = mapToSnakeCase(newData);\n    const updateId = mapped.id || newData.id;\n    \n    console.log(`DB: Looking for id=${updateId} in ${table} (${db[table].length} records)`);\n    \n    // Find by ID\n    let index = -1;\n    if (updateId !== undefined) {\n      index = db[table].findIndex((item: any) => {\n        // Compare as numbers and strings\n        return item.id === updateId || \n               item.id === Number(updateId) || \n               String(item.id) === String(updateId);\n      });\n    }\n    \n    // Special case for single-record tables\n    if (index === -1 && ['user_profile', 'settings', 'job_preferences', 'email_config'].includes(table)) {\n      if (db[table].length > 0) {\n        index = 0;\n      } else {\n        // Create new record for single-record tables\n        const record = { ...mapped, id: updateId || Date.now(), timestamp: new Date().toISOString() };\n        db[table].push(record);\n        saveDb();\n        console.log(`DB: Created new ${table} record`);\n        return { id: record.id, success: true };\n      }\n    }\n    \n    if (index !== -1) {\n      // Merge existing data with new data\n      db[table][index] = { \n        ...db[table][index], \n        ...mapped,\n        id: db[table][index].id // Keep original ID\n      };\n      saveDb();\n      console.log(`DB: Updated ${table}[${index}] with id=${db[table][index].id}`);\n      return { success: true, id: db[table][index].id };\n    } else {\n      console.log(`DB: ‚ùå Record not found for update! id=${updateId}`);\n      console.log(`DB: Available IDs in ${table}:`, db[table].map((r: any) => r.id));\n      return { success: false, error: 'Record not found' };\n    }\n  } \n  \n  // DELETE\n  else if (sqlUpper.includes('DELETE')) {\n    const deleteId = typeof newData === 'object' ? (newData.id) : newData;\n    const beforeCount = db[table].length;\n    \n    db[table] = db[table].filter((item: any) => {\n      return item.id !== deleteId && \n             item.id !== Number(deleteId) && \n             String(item.id) !== String(deleteId);\n    });\n    \n    const deleted = beforeCount - db[table].length;\n    saveDb();\n    console.log(`DB: Deleted ${deleted} record(s) from ${table} where id=${deleteId}`);\n    return { success: true, deleted };\n  }\n  \n  return { success: false, error: 'Unknown operation' };\n}\n\nexport async function getAllQuery(sql: string): Promise<any[]> {\n  const db = getDatabase();\n  const parts = sql.trim().split(/\\s+/);\n  \n  // Handle \"SELECT * FROM table\"\n  let table = '';\n  const fromIndex = parts.findIndex(p => p.toUpperCase() === 'FROM');\n  if (fromIndex !== -1 && parts[fromIndex + 1]) {\n    table = parts[fromIndex + 1].replace(/[`\"']/g, '');\n  }\n  \n  const result = db[table] || [];\n  console.log(`DB: SELECT from ${table} returned ${result.length} records`);\n  return result;\n}\n\nexport async function logAction(userId: number, type: string, desc: string, status: string, success?: boolean) {\n  const db = getDatabase();\n  const logEntry = { \n    id: Date.now(),\n    user_id: userId, \n    action_type: type, \n    action_description: desc, \n    status: status, \n    success: success,\n    timestamp: new Date().toISOString()\n  };\n  \n  db.action_logs.push(logEntry);\n  \n  // Keep only last 200 logs\n  if (db.action_logs.length > 200) {\n    db.action_logs = db.action_logs.slice(-200);\n  }\n  \n  saveDb();\n}","import puppeteer, { Browser, Page } from 'puppeteer';\nimport { logAction, getDatabase, runQuery } from '../database';\nimport path from 'path';\nimport fs from 'fs';\nlet app: any;\ntry { app = require('electron').app; } catch (e) { app = (global as any).electronApp; }\n\n// Get persistent user data directory for browser session\nconst getUserDataDir = () => {\n  const browserDataDir = path.join(app.getPath('userData'), 'linkedin_browser_data');\n  if (!fs.existsSync(browserDataDir)) {\n    fs.mkdirSync(browserDataDir, { recursive: true });\n  }\n  return browserDataDir;\n};\n\n// Shared browser instance for session persistence\nlet sharedBrowser: Browser | null = null;\nlet sharedPage: Page | null = null;\n\ninterface LinkedInProfile {\n  name: string;\n  title: string;\n  location: string;\n  photo: string;\n  summary: string;\n  experiences: Array<{\n    title: string;\n    company: string;\n    location: string;\n    startDate: string;\n    endDate: string;\n    description: string;\n  }>;\n  educations: Array<{\n    school: string;\n    degree: string;\n    field: string;\n    startYear: string;\n    endYear: string;\n  }>;\n  skills: string[];\n  licenses: string[];\n  languages: string[];\n}\n\n/**\n * Check if user is already logged in to LinkedIn\n */\nasync function isLoggedIn(page: Page): Promise<boolean> {\n  try {\n    // Check for feed or profile indicators\n    const loggedInIndicators = await page.evaluate(() => {\n      return !!(\n        document.querySelector('.global-nav__me') ||\n        document.querySelector('.feed-identity-module') ||\n        document.querySelector('[data-test-id=\"nav-settings\"]') ||\n        document.querySelector('.share-box-feed-entry__trigger') ||\n        window.location.href.includes('/feed/') ||\n        window.location.href.includes('/in/')\n      );\n    });\n    return loggedInIndicators;\n  } catch (e) {\n    return false;\n  }\n}\n\n/**\n * Get or create a shared browser instance with persistent session\n */\nasync function getOrCreateBrowser(): Promise<{ browser: Browser; page: Page; isNew: boolean }> {\n  // If we have an existing browser that's still connected, reuse it\n  if (sharedBrowser && sharedBrowser.isConnected()) {\n    // Get existing pages or create new one\n    const pages = await sharedBrowser.pages();\n    if (pages.length > 0 && sharedPage && !sharedPage.isClosed()) {\n      return { browser: sharedBrowser, page: sharedPage, isNew: false };\n    }\n    // Create new page if none exist\n    sharedPage = await sharedBrowser.newPage();\n    await setupPage(sharedPage);\n    return { browser: sharedBrowser, page: sharedPage, isNew: false };\n  }\n  \n  // Launch new browser with persistent session\n  console.log('Launching new browser with user data dir:', getUserDataDir());\n  sharedBrowser = await puppeteer.launch({\n    headless: false,\n    userDataDir: getUserDataDir(),\n    args: [\n      '--no-sandbox',\n      '--disable-setuid-sandbox',\n      '--disable-blink-features=AutomationControlled',\n      '--disable-infobars',\n      '--window-size=1280,800',\n      '--start-maximized'\n    ]\n  });\n  \n  const pages = await sharedBrowser.pages();\n  sharedPage = pages.length > 0 ? pages[0] : await sharedBrowser.newPage();\n  await setupPage(sharedPage);\n  \n  return { browser: sharedBrowser, page: sharedPage, isNew: true };\n}\n\n/**\n * Setup page with anti-detection measures\n */\nasync function setupPage(page: Page) {\n  await page.setViewport({ width: 1280, height: 800 });\n  await page.setUserAgent('Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36');\n  \n  // Hide webdriver property\n  await page.evaluateOnNewDocument(() => {\n    Object.defineProperty(navigator, 'webdriver', { get: () => false });\n    // Override permissions\n    const originalQuery = window.navigator.permissions.query;\n    (window.navigator.permissions.query as any) = (parameters: any) =>\n      parameters.name === 'notifications'\n        ? Promise.resolve({ state: 'denied' } as PermissionStatus)\n        : originalQuery(parameters);\n  });\n}\n\n/**\n * Open LinkedIn in browser for manual login\n * Returns the browser instance for later scraping\n */\nexport async function openLinkedInForLogin(userId: number): Promise<{ success: boolean; message: string; isLoggedIn?: boolean }> {\n  try {\n    await logAction(userId, 'linkedin', 'üîó Opening LinkedIn...', 'in_progress');\n    \n    const { browser, page, isNew } = await getOrCreateBrowser();\n    \n    // Set generous timeouts\n    page.setDefaultNavigationTimeout(60000);\n    page.setDefaultTimeout(30000);\n    \n    // Store references globally\n    (global as any).linkedInBrowser = browser;\n    (global as any).linkedInPage = page;\n    \n    // Check if already logged in\n    if (!isNew) {\n      const currentUrl = page.url();\n      if (currentUrl.includes('linkedin.com')) {\n        const loggedIn = await isLoggedIn(page);\n        if (loggedIn) {\n          await logAction(userId, 'linkedin', '‚úÖ Already logged in to LinkedIn!', 'completed', true);\n          return { \n            success: true, \n            message: 'You are already logged in to LinkedIn. You can click \"Fetch Profile\" directly.',\n            isLoggedIn: true\n          };\n        }\n      }\n    }\n    \n    // Navigate to LinkedIn login - use domcontentloaded for faster response\n    try {\n      await page.goto('https://www.linkedin.com/login', { waitUntil: 'domcontentloaded', timeout: 45000 });\n    } catch (navError: any) {\n      console.log('Navigation timeout, checking if page loaded...');\n      // Check if we're on LinkedIn despite the timeout\n      const currentUrl = page.url();\n      if (!currentUrl.includes('linkedin.com')) {\n        throw new Error('Failed to open LinkedIn. Please check your internet connection.');\n      }\n    }\n    \n    // Wait a bit for page to stabilize\n    await new Promise(r => setTimeout(r, 2000));\n    \n    // Check if we got redirected to feed (meaning already logged in)\n    const currentUrl = page.url();\n    if (currentUrl.includes('/feed') || currentUrl.includes('/in/')) {\n      await logAction(userId, 'linkedin', '‚úÖ Already logged in to LinkedIn!', 'completed', true);\n      return { \n        success: true, \n        message: 'You are already logged in to LinkedIn! Click \"Fetch Profile\" to capture your profile.',\n        isLoggedIn: true\n      };\n    }\n    \n    await logAction(userId, 'linkedin', '‚úÖ LinkedIn opened. Please login manually.', 'completed', true);\n    \n    return { \n      success: true, \n      message: 'LinkedIn opened. Please login manually in the browser window, then click \"Fetch Profile\".',\n      isLoggedIn: false\n    };\n  } catch (error: any) {\n    await logAction(userId, 'linkedin', `‚ùå Error: ${error.message}`, 'failed', false);\n    return { success: false, message: error.message };\n  }\n}\n\n/**\n * Scrape the currently open LinkedIn profile\n */\nexport async function scrapeLinkedInProfile(userId: number, profileUrl?: string): Promise<{ success: boolean; data?: LinkedInProfile; error?: string }> {\n  let page: Page | null = null;\n  let browser: Browser | null = null;\n  \n  try {\n    await logAction(userId, 'linkedin', 'üîç Starting LinkedIn profile capture...', 'in_progress');\n    \n    // Try to get existing browser or create new one\n    const browserResult = await getOrCreateBrowser();\n    browser = browserResult.browser;\n    page = browserResult.page;\n    \n    // Update global references\n    (global as any).linkedInBrowser = browser;\n    (global as any).linkedInPage = page;\n    \n    // Set more generous timeouts\n    page.setDefaultNavigationTimeout(90000);\n    page.setDefaultTimeout(30000);\n    \n    // Check if logged in\n    const currentUrl = page.url();\n    if (!currentUrl.includes('linkedin.com') || currentUrl.includes('/login') || currentUrl.includes('/checkpoint')) {\n      // Navigate to check login status - use domcontentloaded instead of networkidle2 for faster response\n      try {\n        await page.goto('https://www.linkedin.com/feed/', { waitUntil: 'domcontentloaded', timeout: 45000 });\n        // Wait a bit for page to stabilize\n        await new Promise(r => setTimeout(r, 2000));\n      } catch (navError: any) {\n        console.log('Feed navigation timeout, checking if page loaded anyway...');\n      }\n      \n      const loggedIn = await isLoggedIn(page);\n      if (!loggedIn) {\n        return { \n          success: false, \n          error: 'Not logged in to LinkedIn. Please click \"Sign in to LinkedIn\" first and complete the login process.'\n        };\n      }\n    }\n    \n    // Navigate to profile if URL provided, otherwise go to own profile\n    const targetUrl = profileUrl || 'https://www.linkedin.com/in/me/';\n    console.log('Navigating to profile:', targetUrl);\n    \n    // Use domcontentloaded for faster initial load\n    try {\n      await page.goto(targetUrl, { waitUntil: 'domcontentloaded', timeout: 45000 });\n    } catch (navError: any) {\n      console.log('Profile navigation timeout, checking if page loaded anyway...');\n      // Check if we're on the right page despite timeout\n      const currentPageUrl = page.url();\n      if (!currentPageUrl.includes('/in/')) {\n        throw new Error('Failed to navigate to profile page');\n      }\n    }\n    \n    // Wait for profile to load with multiple possible selectors\n    try {\n      await Promise.race([\n        page.waitForSelector('.pv-top-card', { timeout: 15000 }),\n        page.waitForSelector('.scaffold-layout__main', { timeout: 15000 }),\n        page.waitForSelector('h1.text-heading-xlarge', { timeout: 15000 }),\n        page.waitForSelector('.pv-text-details__left-panel', { timeout: 15000 })\n      ]);\n    } catch (e) {\n      console.log('Profile selector not found within timeout, continuing anyway...');\n    }\n    \n    // Random delay to appear human\n    await new Promise(r => setTimeout(r, 2000 + Math.random() * 2000));\n    \n    // Scroll to load lazy content\n    await page.evaluate(() => window.scrollBy(0, 500));\n    await new Promise(r => setTimeout(r, 1000));\n    await page.evaluate(() => window.scrollBy(0, 500));\n    await new Promise(r => setTimeout(r, 1000));\n    await page.evaluate(() => window.scrollTo(0, 0));\n    await new Promise(r => setTimeout(r, 500));\n    \n    // Extract profile data\n    const profileData = await page.evaluate(() => {\n      const getText = (selector: string) => document.querySelector(selector)?.textContent?.trim() || '';\n      const getAttr = (selector: string, attr: string) => document.querySelector(selector)?.getAttribute(attr) || '';\n      \n      // Basic Info\n      const name = getText('.pv-top-card--list li:first-child') || getText('h1.text-heading-xlarge') || getText('.pv-text-details__left-panel h1');\n      const title = getText('.pv-top-card--list-bullet li:first-child') || getText('.text-body-medium.break-words') || '';\n      const location = getText('.pv-top-card--list-bullet li:last-child') || getText('.text-body-small.inline.t-black--light.break-words') || '';\n      const photo = getAttr('.pv-top-card-profile-picture__image', 'src') || getAttr('img.pv-top-card-profile-picture__image--show', 'src') || '';\n      const summary = getText('.pv-about-section .pv-about__summary-text') || getText('#about ~ .display-flex .full-width') || '';\n      \n      // Experiences\n      const experiences: any[] = [];\n      document.querySelectorAll('#experience ~ .pvs-list__outer-container > ul > li').forEach(li => {\n        const titleEl = li.querySelector('.t-bold span[aria-hidden=\"true\"]') || li.querySelector('.mr1.t-bold span');\n        const companyEl = li.querySelector('.t-14.t-normal span[aria-hidden=\"true\"]') || li.querySelector('.t-14.t-normal');\n        const datesEl = li.querySelector('.t-14.t-normal.t-black--light span[aria-hidden=\"true\"]');\n        const descEl = li.querySelector('.pvs-list__outer-container .t-14.t-normal.t-black span[aria-hidden=\"true\"]');\n        \n        if (titleEl) {\n          const fullText = companyEl?.textContent || '';\n          const [company, ...locationParts] = fullText.split('¬∑').map(s => s.trim());\n          \n          const datesText = datesEl?.textContent || '';\n          const dateMatch = datesText.match(/(\\w+ \\d{4})\\s*[-‚Äì]\\s*(\\w+ \\d{4}|Present)/i);\n          \n          experiences.push({\n            title: titleEl.textContent?.trim() || '',\n            company: company || '',\n            location: locationParts.join(' ').trim(),\n            startDate: dateMatch?.[1] || '',\n            endDate: dateMatch?.[2] || '',\n            description: descEl?.textContent?.trim() || ''\n          });\n        }\n      });\n      \n      // Education\n      const educations: any[] = [];\n      document.querySelectorAll('#education ~ .pvs-list__outer-container > ul > li').forEach(li => {\n        const schoolEl = li.querySelector('.t-bold span[aria-hidden=\"true\"]');\n        const degreeEl = li.querySelector('.t-14.t-normal span[aria-hidden=\"true\"]');\n        const datesEl = li.querySelector('.t-14.t-normal.t-black--light span[aria-hidden=\"true\"]');\n        \n        if (schoolEl) {\n          const degreeText = degreeEl?.textContent || '';\n          const [degree, field] = degreeText.split(',').map(s => s.trim());\n          const datesText = datesEl?.textContent || '';\n          const yearMatch = datesText.match(/(\\d{4})\\s*[-‚Äì]\\s*(\\d{4})/);\n          \n          educations.push({\n            school: schoolEl.textContent?.trim() || '',\n            degree: degree || '',\n            field: field || '',\n            startYear: yearMatch?.[1] || '',\n            endYear: yearMatch?.[2] || ''\n          });\n        }\n      });\n      \n      // Skills\n      const skills: string[] = [];\n      document.querySelectorAll('#skills ~ .pvs-list__outer-container .t-bold span[aria-hidden=\"true\"]').forEach(el => {\n        const skill = el.textContent?.trim();\n        if (skill && !skills.includes(skill)) skills.push(skill);\n      });\n      \n      // Licenses & Certifications\n      const licenses: string[] = [];\n      document.querySelectorAll('#licenses_and_certifications ~ .pvs-list__outer-container .t-bold span[aria-hidden=\"true\"]').forEach(el => {\n        const license = el.textContent?.trim();\n        if (license && !licenses.includes(license)) licenses.push(license);\n      });\n      \n      // Languages\n      const languages: string[] = [];\n      document.querySelectorAll('#languages ~ .pvs-list__outer-container .t-bold span[aria-hidden=\"true\"]').forEach(el => {\n        const lang = el.textContent?.trim();\n        if (lang && !languages.includes(lang)) languages.push(lang);\n      });\n      \n      return { name, title, location, photo, summary, experiences, educations, skills, licenses, languages };\n    });\n    \n    await logAction(userId, 'linkedin', `‚úÖ Profile captured: ${profileData.name}`, 'completed', true);\n    \n    // Don't close the browser - keep it open for future scraping\n    // The session will persist due to userDataDir\n    \n    return { success: true, data: profileData as LinkedInProfile };\n    \n  } catch (error: any) {\n    console.error('LinkedIn scrape error:', error);\n    await logAction(userId, 'linkedin', `‚ùå Capture failed: ${error.message}`, 'failed', false);\n    \n    // Don't close the browser on error - let user retry\n    \n    return { success: false, error: error.message };\n  }\n}\n\n/**\n * Save scraped profile to database\n */\nexport async function saveLinkedInProfile(userId: number, profileData: LinkedInProfile): Promise<{ success: boolean }> {\n  try {\n    const db = getDatabase();\n    \n    // Check if profile exists\n    const existingProfile = db.user_profile.find((p: any) => p.id === userId) || db.user_profile[0];\n    \n    const profileToSave = {\n      id: existingProfile?.id || userId,\n      name: profileData.name,\n      title: profileData.title,\n      location: profileData.location,\n      photo: profileData.photo,\n      summary: profileData.summary,\n      experiences: JSON.stringify(profileData.experiences),\n      educations: JSON.stringify(profileData.educations),\n      skills: JSON.stringify(profileData.skills),\n      licenses: JSON.stringify(profileData.licenses),\n      languages: JSON.stringify(profileData.languages),\n      linkedin_imported: true,\n      updated_at: new Date().toISOString()\n    };\n    \n    if (existingProfile) {\n      await runQuery('UPDATE user_profile', profileToSave);\n    } else {\n      await runQuery('INSERT INTO user_profile', profileToSave);\n    }\n    \n    await logAction(userId, 'linkedin', `üíæ Profile saved to database`, 'completed', true);\n    return { success: true };\n    \n  } catch (error: any) {\n    console.error('Save profile error:', error);\n    return { success: false };\n  }\n}\n\n/**\n * Close LinkedIn browser if open\n */\nexport async function closeLinkedInBrowser(): Promise<void> {\n  if (sharedBrowser && sharedBrowser.isConnected()) {\n    await sharedBrowser.close();\n    sharedBrowser = null;\n    sharedPage = null;\n  }\n  \n  // Also clear global references\n  (global as any).linkedInBrowser = null;\n  (global as any).linkedInPage = null;\n}\n\n/**\n * Export isSearching state for UI sync\n */\nexport const isSearching = false;\n","import puppeteer, { Browser, Page } from 'puppeteer';\nimport { logAction, getDatabase } from './database';\nimport path from 'path';\nlet app: any; try { app = require('electron').app; } catch (e) { app = (global as any).electronApp; }\n\nlet activeBrowser: Browser | null = null;\n\n// Get persistent user data directory for session cookies\nconst getUserDataDir = () => {\n  return path.join(app.getPath('userData'), 'browser_data');\n};\n\n/**\n * HELPER: LAUNCH BROWSER WITH PROXY SUPPORT\n * Automatically pulls proxy_url from the settings table.\n */\nasync function launchBrowser(options: { headless?: boolean | 'new', userDataDir?: string, args?: string[] } = {}): Promise<Browser> {\n  const db = getDatabase();\n  const settings = db.settings[0] || {};\n  const proxyServer = settings.proxy_url;\n\n  const defaultArgs = [\n    '--no-sandbox',\n    '--disable-setuid-sandbox',\n    '--disable-blink-features=AutomationControlled',\n    '--disable-infobars',\n    '--window-size=1280,800'\n  ];\n\n  if (proxyServer) {\n    console.log(`Scraper: Using proxy server: ${proxyServer}`);\n    defaultArgs.push(`--proxy-server=${proxyServer}`);\n  }\n\n  const launchOptions: any = {\n    headless: options.headless !== undefined ? options.headless : false,\n    userDataDir: options.userDataDir || getUserDataDir(),\n    args: [...defaultArgs, ...(options.args || [])]\n  };\n\n  const browser = await puppeteer.launch(launchOptions);\n\n  // Handle proxy authentication if credentials are provided in the URL\n  if (proxyServer && proxyServer.includes('@')) {\n    const authPart = proxyServer.split('@')[0].replace('http://', '').replace('https://', '');\n    const [username, password] = authPart.split(':');\n    if (username && password) {\n      const page = (await browser.pages())[0] || await browser.newPage();\n      await page.authenticate({ username, password });\n    }\n  }\n\n  return browser;\n}\n\n/**\n * Random delay to simulate human behavior\n */\nfunction randomDelay(min: number, max: number): Promise<void> {\n  const delay = Math.floor(Math.random() * (max - min + 1)) + min;\n  return new Promise(resolve => setTimeout(resolve, delay));\n}\n\n/**\n * COOKIE BANNER BYPASS\n */\nasync function handleCookieRoadblock(page: Page, userId: number, callAI: Function) {\n  try {\n    const isBannerVisible = await page.evaluate(() => {\n      const text = document.body.innerText.toLowerCase();\n      return text.includes('cookie') || text.includes('accept') || text.includes('agree') || text.includes('zustimmen') || text.includes('akzeptieren');\n    });\n    \n    if (!isBannerVisible) return;\n\n    await logAction(userId, 'ai_observer', 'üì∏ Cookie banner detected. Attempting bypass...', 'in_progress');\n    \n    // Try DOM-based click first (faster & more reliable)\n    const clicked = await page.evaluate(() => {\n      const selectors = [\n        'button[data-testid=\"cookie-policy-dialog-accept-button\"]',\n        'button[id*=\"reject\"]', 'button[id*=\"decline\"]', 'button[id*=\"ablehnen\"]',\n        'button[class*=\"reject\"]', 'button[class*=\"decline\"]',\n        '[data-tracking-control-name*=\"cookie\"]',\n        'button.artdeco-button--secondary'\n      ];\n      \n      for (const sel of selectors) {\n        const btn = document.querySelector(sel) as HTMLElement;\n        if (btn) { btn.click(); return true; }\n      }\n      \n      // Fallback: find by text content\n      const btns = Array.from(document.querySelectorAll('button, a, div[role=\"button\"]'));\n      const rejectBtn = btns.find(b => {\n        const txt = b.textContent?.toLowerCase() || '';\n        return txt.includes('reject') || txt.includes('decline') || txt.includes('ablehnen') || txt.includes('nur notwendige') || txt.includes('essential');\n      });\n      if (rejectBtn) { (rejectBtn as HTMLElement).click(); return true; }\n      \n      // Last resort: accept\n      const acceptBtn = btns.find(b => {\n        const txt = b.textContent?.toLowerCase() || '';\n        return txt.includes('accept') || txt.includes('agree') || txt.includes('akzeptieren') || txt.includes('alle akzeptieren');\n      });\n      if (acceptBtn) { (acceptBtn as HTMLElement).click(); return true; }\n      \n      return false;\n    });\n\n    if (clicked) {\n      await logAction(userId, 'ai_observer', '‚úÖ Cookie banner dismissed', 'completed', true);\n      await randomDelay(1500, 2500);\n    }\n  } catch (e) {\n    console.log('Cookie bypass error:', e);\n  }\n}\n\n/**\n * Check if page is blocked by bot detection\n */\nasync function isPageBlocked(page: Page): Promise<boolean> {\n  return await page.evaluate(() => {\n    const text = document.body.innerText.toLowerCase();\n    return text.includes('verify you are human') || \n           text.includes('captcha') || \n           text.includes('unusual traffic') ||\n           text.includes('sign in to view') ||\n           text.includes('please verify') ||\n           text.includes('robot') ||\n           text.includes('blocked');\n  });\n}\n\n/**\n * SCRAPING - GET JOB PAGE CONTENT\n * Tries multiple extraction strategies\n */\nexport async function getJobPageContent(url: string, userId: number, callAI: Function): Promise<{ content: string, strategyUsed: string }> {\n  let browser: Browser | null = null;\n  \n  try {\n    console.log(`Scraper: Opening ${url}`);\n    \n    browser = await launchBrowser({ headless: false });\n    \n    const page = await browser.newPage();\n    \n    // Stealth settings\n    await page.setViewport({ width: 1280, height: 800 });\n    await page.setUserAgent('Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36');\n    \n    // Hide webdriver property\n    await page.evaluateOnNewDocument(() => {\n      Object.defineProperty(navigator, 'webdriver', { get: () => false });\n      Object.defineProperty(navigator, 'plugins', { get: () => [1, 2, 3, 4, 5] });\n      Object.defineProperty(navigator, 'languages', { get: () => ['en-US', 'en', 'de'] });\n    });\n    \n    await page.goto(url, { waitUntil: 'networkidle2', timeout: 60000 });\n    \n    // Handle cookie banner\n    await handleCookieRoadblock(page, userId, callAI);\n    \n    // Human-like scrolling\n    await page.evaluate(() => window.scrollBy(0, 300));\n    await randomDelay(800, 1500);\n    await page.evaluate(() => window.scrollBy(0, 400));\n    await randomDelay(1500, 3000);\n\n    // Check if blocked\n    if (await isPageBlocked(page)) {\n      console.log('Scraper: Page blocked by bot detection');\n      return { content: '', strategyUsed: 'Blocked' };\n    }\n\n    // Try extraction strategies in order\n    const result = await page.evaluate(() => {\n      const getCleanText = (el: Element | null) => el ? (el as HTMLElement).innerText.replace(/\\s+/g, ' ').trim() : '';\n      \n      // STRATEGY 1: JSON-LD (Most reliable - structured data)\n      const jsonLdScripts = document.querySelectorAll('script[type=\"application/ld+json\"]');\n      for (const script of jsonLdScripts) {\n        try {\n          const data = JSON.parse(script.textContent || '');\n          // Check if it's a JobPosting\n          if (data['@type'] === 'JobPosting' || data.title || data.jobTitle) {\n            console.log('Found JSON-LD JobPosting');\n            return { content: JSON.stringify(data, null, 2), strategy: 'JSON-LD' };\n          }\n          // Check for array format\n          if (Array.isArray(data)) {\n            const job = data.find((item: any) => item['@type'] === 'JobPosting');\n            if (job) {\n              return { content: JSON.stringify(job, null, 2), strategy: 'JSON-LD' };\n            }\n          }\n          // Check for @graph format\n          if (data['@graph']) {\n            const job = data['@graph'].find((item: any) => item['@type'] === 'JobPosting');\n            if (job) {\n              return { content: JSON.stringify(job, null, 2), strategy: 'JSON-LD' };\n            }\n          }\n        } catch (e) {}\n      }\n      \n      // STRATEGY 2: Job-specific selectors\n      const jobSelectors = [\n        '.job-description', \n        '#jobDescriptionText', \n        '.description__text', \n        '.show-more-less-html__markup', \n        '.jobs-description__content',\n        '.jobs-box__html-content',\n        '[data-testid=\"job-description\"]', \n        '.job-details',\n        '.jobsearch-JobComponent-description',\n        '#job-details'\n      ];\n      \n      for (const sel of jobSelectors) {\n        const el = document.querySelector(sel);\n        if (el && el.textContent && el.textContent.length > 300) {\n          return { content: getCleanText(el), strategy: `Selector: ${sel}` };\n        }\n      }\n      \n      // STRATEGY 3: Semantic HTML tags\n      const semanticEls = document.querySelectorAll('main, article, [role=\"main\"]');\n      for (const el of semanticEls) {\n        if (el.textContent && el.textContent.length > 500) {\n          return { content: getCleanText(el), strategy: 'Semantic' };\n        }\n      }\n      \n      // STRATEGY 4: Find largest content block\n      const divs = Array.from(document.querySelectorAll('div, section'));\n      const blocks = divs\n        .map(el => ({ el, text: getCleanText(el), len: el.textContent?.length || 0 }))\n        .filter(b => b.len > 500 && b.len < 50000)\n        .sort((a, b) => b.len - a.len);\n      \n      if (blocks.length > 0) {\n        return { content: blocks[0].text, strategy: 'Density' };\n      }\n\n      // STRATEGY 5: Full body (last resort)\n      const bodyText = getCleanText(document.body);\n      if (bodyText.length > 300) {\n        return { content: bodyText.substring(0, 15000), strategy: 'Body' };\n      }\n      \n      return { content: '', strategy: 'Empty' };\n    });\n\n    console.log(`Scraper: Extracted using ${result.strategy}, length: ${result.content.length}`);\n    return { content: result.content, strategyUsed: result.strategy };\n    \n  } catch (error: any) {\n    console.error('Scraper Error:', error.message);\n    return { content: '', strategyUsed: 'Failed: ' + error.message };\n  } finally {\n    if (browser) {\n      await browser.close();\n    }\n  }\n}\n\n/**\n * SCRAPE JOB LISTING URLS FROM SEARCH RESULTS\n */\nexport async function scrapeJobs(baseUrl: string, query: string, location: string, credentials?: any, userId?: number, callAI?: Function): Promise<string[]> {\n  let browser: Browser | null = null;\n  const jobUrls: string[] = [];\n  \n  try {\n    console.log(`Scraper: Searching for \"${query}\" in \"${location}\" on ${baseUrl}`);\n    \n    browser = await launchBrowser({ headless: false, args: ['--start-maximized'] });\n    \n    const page = await browser.newPage();\n    await page.setViewport({ width: 1280, height: 800 });\n    await page.setUserAgent('Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36');\n    \n    // Hide webdriver\n    await page.evaluateOnNewDocument(() => {\n      Object.defineProperty(navigator, 'webdriver', { get: () => false });\n    });\n    \n    // Build search URL based on website\n    let searchUrl: string;\n    if (baseUrl.includes('linkedin.com')) {\n      searchUrl = `https://www.linkedin.com/jobs/search/?keywords=${encodeURIComponent(query)}&location=${encodeURIComponent(location)}`;\n    } else if (baseUrl.includes('indeed')) {\n      searchUrl = `https://de.indeed.com/jobs?q=${encodeURIComponent(query)}&l=${encodeURIComponent(location)}`;\n    } else if (baseUrl.includes('glassdoor')) {\n      searchUrl = `https://www.glassdoor.com/Job/jobs.htm?sc.keyword=${encodeURIComponent(query)}&locT=C&locKeyword=${encodeURIComponent(location)}`;\n    } else if (baseUrl.includes('xing')) {\n      searchUrl = `https://www.xing.com/jobs/search?keywords=${encodeURIComponent(query)}&location=${encodeURIComponent(location)}`;\n    } else {\n      searchUrl = baseUrl;\n    }\n    \n    console.log(`Scraper: Navigating to ${searchUrl}`);\n    await page.goto(searchUrl, { waitUntil: 'networkidle2', timeout: 60000 });\n    \n    // Handle cookies\n    if (callAI && userId) {\n      await handleCookieRoadblock(page, userId, callAI);\n    }\n    \n    // Human-like behavior - wait and scroll\n    await randomDelay(2000, 4000);\n    await page.evaluate(() => window.scrollBy(0, 400));\n    await randomDelay(1000, 2000);\n    await page.evaluate(() => window.scrollBy(0, 400));\n    await randomDelay(2000, 4000);\n    \n    // Check if blocked\n    if (await isPageBlocked(page)) {\n      console.log('Scraper: Search page blocked');\n      if (userId) {\n        await logAction(userId, 'ai_hunter', 'üö´ Search page blocked by bot detection', 'failed', false);\n      }\n      return [];\n    }\n    \n    // Extract job URLs\n    const links = await page.evaluate(() => {\n      const selectors = [\n        // LinkedIn\n        'a.job-card-container__link',\n        'a.base-card__full-link',\n        'a[data-tracking-control-name=\"public_jobs_jserp-result_search-card\"]',\n        '.jobs-search__results-list a',\n        // Indeed\n        'a.jcs-JobTitle',\n        'h2.jobTitle a',\n        '.job_seen_beacon a[data-jk]',\n        '.jobsearch-ResultsList a.tapItem',\n        // Glassdoor\n        'a.job-title',\n        '.react-job-listing a',\n        // Xing\n        'a[data-testid=\"job-posting-link\"]',\n        '.jobs-list a',\n        // Generic\n        'a[href*=\"/job/\"]',\n        'a[href*=\"/jobs/\"]',\n        'a[href*=\"jobPosting\"]'\n      ];\n      \n      const foundLinks: string[] = [];\n      \n      selectors.forEach(selector => {\n        document.querySelectorAll(selector).forEach(el => {\n          const href = (el as HTMLAnchorElement).href;\n          if (href && \n              href.startsWith('http') && \n              !foundLinks.includes(href) &&\n              !href.includes('/login') &&\n              !href.includes('/signup') &&\n              !href.includes('/register')) {\n            foundLinks.push(href);\n          }\n        });\n      });\n      \n      return foundLinks;\n    });\n    \n    // Limit to first 15 unique URLs\n    const uniqueLinks = [...new Set(links)].slice(0, 15);\n    jobUrls.push(...uniqueLinks);\n    \n    console.log(`Scraper: Found ${jobUrls.length} job URLs`);\n    \n  } catch (error: any) { \n    console.error('Scraper Error:', error.message); \n  } finally { \n    if (browser) {\n      await browser.close();\n    }\n  }\n  \n  return jobUrls;\n}\n\n/**\n * Open browser for manual login warm-up\n */\nexport async function openLinkedIn(userId: number, url: string) {\n  activeBrowser = await launchBrowser({ headless: false, args: ['--start-maximized'] });\n  const page = await activeBrowser.newPage();\n  await page.goto(url, { waitUntil: 'domcontentloaded' });\n  return { success: true };\n}\n\n/**\n * SEARCH AND SCRAPE COMPANY INFO\n */\nexport async function getCompanyInfo(companyName: string, userId: number, callAI: Function): Promise<string> {\n  let browser: Browser | null = null;\n  try {\n    console.log(`Scraper: Researching company: ${companyName}`);\n    await logAction(userId, 'ai_observer', `üîç Researching company: ${companyName}`, 'in_progress');\n\n    browser = await launchBrowser({ headless: true });\n    const page = await browser.newPage();\n    await page.setUserAgent('Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36');\n\n    // Step 1: Find official website\n    const siteSearchUrl = `https://www.google.com/search?q=${encodeURIComponent(companyName + \" official website\")}`;\n    await page.goto(siteSearchUrl, { waitUntil: 'networkidle2' });\n    const officialSite = await page.evaluate(() => document.querySelector('div.g a')?.getAttribute('href'));\n    \n    // Step 2: Search for mission/about\n    const searchUrl = officialSite \n      ? `https://www.google.com/search?q=site:${new URL(officialSite).hostname} mission history about`\n      : `https://www.google.com/search?q=${encodeURIComponent(companyName + \" company mission history news\")}`;\n\n    await page.goto(searchUrl, { waitUntil: 'networkidle2' });\n\n    // Get the first few organic results\n    const links = await page.evaluate(() => {\n      return Array.from(document.querySelectorAll('div.g a'))\n        .map(a => (a as HTMLAnchorElement).href)\n        .filter(href => href && !href.includes('google.com'))\n        .slice(0, 2);\n    });\n\n    let combinedInfo = \"\";\n    for (const link of links) {\n      try {\n        await page.goto(link, { waitUntil: 'networkidle2', timeout: 30000 });\n        const text = await page.evaluate(() => {\n          const body = document.body.innerText;\n          return body.substring(0, 5000).replace(/\\s+/g, ' ').trim();\n        });\n        combinedInfo += `\\n--- Source: ${link} ---\\n${text}\\n`;\n      } catch (e) {\n        console.log(`Failed to scrape ${link}:`, e);\n      }\n    }\n\n    return combinedInfo || \"No specific company info found.\";\n  } catch (error: any) {\n    console.error('Company Research Error:', error.message);\n    return \"Error researching company: \" + error.message;\n  } finally {\n    if (browser) await browser.close();\n  }\n}\n\n/**\n * CAPTURE SCREENSHOT FOR AI OBSERVER\n */\nexport async function capturePageScreenshot(page: Page): Promise<string> {\n  const screenshot = await page.screenshot({ encoding: 'base64' });\n  return `data:image/png;base64,${screenshot}`;\n}\n\n/**\n * EXECUTE MOUSE ACTION BASED ON COORDINATES\n */\nexport async function executeMouseAction(page: Page, action: { type: 'click' | 'type' | 'upload', x: number, y: number, text?: string, filePath?: string }) {\n  console.log(`AI Mouse: Executing ${action.type} at (${action.x}, ${action.y})`);\n  \n  // Move mouse with jitter\n  await page.mouse.move(action.x + Math.random() * 5, action.y + Math.random() * 5, { steps: 10 });\n  await randomDelay(200, 500);\n\n  if (action.type === 'click') {\n    await page.mouse.click(action.x, action.y);\n  } else if (action.type === 'type' && action.text) {\n    await page.mouse.click(action.x, action.y);\n    await randomDelay(100, 300);\n    await page.keyboard.type(action.text, { delay: Math.random() * 100 + 50 });\n  } else if (action.type === 'upload' && action.filePath) {\n    // For upload, we often need to click the button first to trigger the file picker, \n    // but Puppeteer's fileChooser is more reliable if we can find the input.\n    // Fallback: click the coordinates and hope for the best, or use fileChooser.\n    const [fileChooser] = await Promise.all([\n      page.waitForFileChooser(),\n      page.mouse.click(action.x, action.y),\n    ]);\n    await fileChooser.accept([action.filePath]);\n  }\n}\n\n/**\n * GET FORM COORDINATES VIA AI OBSERVER\n */\nexport async function getFormCoordinates(page: Page, userId: number, observerModel: any, callAI: Function): Promise<any[]> {\n  await logAction(userId, 'ai_observer', 'üì∏ Analyzing page layout visually...', 'in_progress');\n  \n  const screenshot = await capturePageScreenshot(page);\n  const prompt = `\n    Analyze this screenshot of a job application form. \n    Identify the (x, y) coordinates for the following fields:\n    - First Name\n    - Last Name\n    - Email\n    - Phone Number\n    - Upload CV/Resume button\n    - Submit button\n    \n    Return ONLY a JSON array of objects:\n    [{\"field\": \"first_name\", \"x\": 123, \"y\": 456}, ...]\n    \n    The coordinates should be relative to the top-left of the image (1280x800).\n  `;\n\n  const response = await callAI(observerModel, prompt, screenshot);\n  try {\n    const cleaned = response.replace(/```json/gi, '').replace(/```/g, '').trim();\n    return JSON.parse(cleaned);\n  } catch (e) {\n    console.error(\"Failed to parse observer response:\", e);\n    return [];\n  }\n}","import { getAllQuery, runQuery, getDatabase } from '../database';\n\ninterface SkillMatch {\n  skill: string;\n  weight: number;\n  matched: boolean;\n}\n\ninterface CompatibilityResult {\n  score: number;\n  level: 'red' | 'yellow' | 'green' | 'gold';\n  matchedSkills: string[];\n  missingSkills: string[];\n  experienceMatch: number;\n  educationMatch: number;\n  locationMatch: boolean;\n  profileSource?: string; // Which profile source was used\n  breakdown: {\n    skills: number;\n    experience: number;\n    education: number;\n    location: number;\n  };\n}\n\n/**\n * Get the profile data based on Auditor's source setting\n */\nasync function getProfileBySource(userId: number): Promise<{ profile: any; source: string }> {\n  // Get Auditor settings\n  const models = await getAllQuery('SELECT * FROM ai_models');\n  const auditor = models.find((m: any) => m.role === 'Auditor' && m.status === 'active');\n  const source = auditor?.auditor_source || 'all';\n  \n  // Get profiles based on source\n  const profiles = await getAllQuery('SELECT * FROM user_profile');\n  const linkedinProfile = profiles.find((p: any) => p.source === 'linkedin');\n  const manualProfile = profiles.find((p: any) => p.source === 'manual');\n  const baseProfile = profiles[0];\n  \n  // Get uploaded CVs\n  const db = getDatabase();\n  const documents = db.documents || [];\n  const uploadedCvs = documents.filter((d: any) => d.doc_type === 'uploaded_cv');\n  \n  let selectedProfile = baseProfile;\n  let usedSource = 'combined';\n  \n  switch (source) {\n    case 'linkedin':\n      if (linkedinProfile) {\n        selectedProfile = linkedinProfile;\n        usedSource = 'LinkedIn Profile';\n      }\n      break;\n    case 'manual':\n      if (manualProfile) {\n        selectedProfile = manualProfile;\n        usedSource = 'Manual Profile';\n      }\n      break;\n    case 'uploaded_cv':\n      // For uploaded CVs, we'd need to extract text - for now use base profile with CV note\n      if (uploadedCvs.length > 0) {\n        usedSource = 'Uploaded CV: ' + (uploadedCvs[0].file_name || 'CV Document');\n      }\n      selectedProfile = baseProfile;\n      break;\n    case 'all':\n    default:\n      // Combine all sources (default behavior)\n      usedSource = 'All Sources (Combined)';\n      break;\n  }\n  \n  return { profile: selectedProfile, source: usedSource };\n}\n\n/**\n * Calculate compatibility score between user profile and job\n * Score: 0-100\n * - Red: 0-25 (Poor match)\n * - Yellow: 26-50 (Fair match)\n * - Green: 51-75 (Good match)\n * - Gold: 76-100 (Excellent match)\n * \n * IMPORTANT AUDITOR RULES:\n * 1. Soft skills should NEVER be exclusion factors\n * 2. Experience is transferable - 5+ years in one role indicates potential for transition\n * 3. Language proficiency from Search Profile bypasses language scoring\n */\nexport async function calculateCompatibility(userId: number, jobId: number): Promise<CompatibilityResult> {\n  // Get user profile based on Auditor source setting\n  const { profile, source } = await getProfileBySource(userId);\n  \n  // Get search profiles for language proficiency override\n  const searchProfiles = await getAllQuery('SELECT * FROM search_profiles');\n  const activeProfile = searchProfiles.find((p: any) => p.is_active === 1) || searchProfiles[0];\n  let languageProficiencies: Record<string, string> = {};\n  try {\n    if (activeProfile?.language_proficiencies) {\n      languageProficiencies = JSON.parse(activeProfile.language_proficiencies);\n    }\n  } catch (e) {}\n  \n  // Get job listing\n  const jobs = await getAllQuery('SELECT * FROM job_listings');\n  const job = jobs.find((j: any) => j.id === jobId);\n  \n  if (!profile || !job) {\n    return createEmptyResult();\n  }\n  \n  // Calculate each component (soft skills are NOT exclusion factors)\n  const skillsScore = calculateSkillsMatch(profile, job);\n  const experienceScore = calculateExperienceMatch(profile, job);\n  const educationScore = calculateEducationMatch(profile, job);\n  const locationScore = calculateLocationMatch(profile, job);\n  const languageScore = calculateLanguageMatch(profile, job, languageProficiencies);\n  \n  // Weighted average:\n  // - Hard skills: 35% (reduced from 40%)\n  // - Experience: 30% (includes transferability bonus)\n  // - Education: 15% (reduced from 20%)\n  // - Location: 10%\n  // - Language: 10% (new - can be bypassed with proficiency)\n  const totalScore = Math.round(\n    skillsScore.score * 0.35 +\n    experienceScore * 0.30 +\n    educationScore * 0.15 +\n    locationScore * 0.10 +\n    languageScore * 0.10\n  );\n  \n  // Determine level\n  let level: 'red' | 'yellow' | 'green' | 'gold';\n  if (totalScore >= 76) level = 'gold';\n  else if (totalScore >= 51) level = 'green';\n  else if (totalScore >= 26) level = 'yellow';\n  else level = 'red';\n  \n  // Update job with compatibility score, source, and detailed breakdown\n  await runQuery('UPDATE job_listings', {\n    id: jobId,\n    compatibility_score: totalScore,\n    compatibility_source: source,\n    compatibility_matched_skills: JSON.stringify(skillsScore.matched),\n    compatibility_missing_skills: JSON.stringify(skillsScore.missing),\n    compatibility_breakdown: JSON.stringify({\n      skills: skillsScore.score,\n      experience: experienceScore,\n      education: educationScore,\n      location: locationScore,\n      language: languageScore\n    })\n  });\n  \n  return {\n    score: totalScore,\n    level,\n    matchedSkills: skillsScore.matched,\n    missingSkills: skillsScore.missing,\n    experienceMatch: experienceScore,\n    educationMatch: educationScore,\n    locationMatch: locationScore > 50,\n    profileSource: source,\n    breakdown: {\n      skills: skillsScore.score,\n      experience: experienceScore,\n      education: educationScore,\n      location: locationScore\n    }\n  };\n}\n\n/**\n * Calculate skills match score\n * IMPORTANT: Soft skills should NEVER be exclusion factors\n */\nfunction calculateSkillsMatch(profile: any, job: any): { score: number; matched: string[]; missing: string[] } {\n  const userSkills = extractSkills(profile);\n  const { hardSkills, softSkills } = extractJobSkillsWithType(job);\n  \n  // Only consider hard skills for matching - soft skills are bonus, not requirements\n  const requiredSkills = hardSkills;\n  \n  if (requiredSkills.length === 0) {\n    return { score: 60, matched: [], missing: [] }; // Higher neutral if no hard requirements\n  }\n  \n  const matched: string[] = [];\n  const missing: string[] = [];\n  \n  for (const required of requiredSkills) {\n    const found = userSkills.some(skill => \n      skill.toLowerCase().includes(required.toLowerCase()) ||\n      required.toLowerCase().includes(skill.toLowerCase()) ||\n      areSimilarSkills(skill, required)\n    );\n    \n    if (found) {\n      matched.push(required);\n    } else {\n      missing.push(required);\n    }\n  }\n  \n  // Calculate base score from hard skills\n  let score = requiredSkills.length > 0 \n    ? Math.round((matched.length / requiredSkills.length) * 100)\n    : 60;\n  \n  // Bonus for soft skills (they're positive, not exclusionary)\n  const softSkillsMatched = softSkills.filter(soft => \n    userSkills.some(skill => \n      skill.toLowerCase().includes(soft.toLowerCase()) ||\n      soft.toLowerCase().includes(skill.toLowerCase())\n    )\n  );\n  \n  // Add up to 15% bonus for soft skills matches\n  if (softSkills.length > 0 && softSkillsMatched.length > 0) {\n    const softBonus = Math.round((softSkillsMatched.length / softSkills.length) * 15);\n    score = Math.min(100, score + softBonus);\n  }\n  \n  return { score, matched, missing };\n}\n\n/**\n * Extract skills from user profile\n */\nfunction extractSkills(profile: any): string[] {\n  const skills: string[] = [];\n  \n  // From skills field\n  if (profile.skills) {\n    if (typeof profile.skills === 'string') {\n      skills.push(...profile.skills.split(',').map((s: string) => s.trim()));\n    } else if (Array.isArray(profile.skills)) {\n      skills.push(...profile.skills);\n    }\n  }\n  \n  // From certifications\n  if (profile.certifications) {\n    if (typeof profile.certifications === 'string') {\n      skills.push(...profile.certifications.split(',').map((s: string) => s.trim()));\n    } else if (Array.isArray(profile.certifications)) {\n      skills.push(...profile.certifications);\n    }\n  }\n  \n  // From summary/headline\n  if (profile.summary) {\n    const technicalTerms = extractTechnicalTerms(profile.summary);\n    skills.push(...technicalTerms);\n  }\n  \n  return [...new Set(skills.filter(s => s.length > 1))];\n}\n\n/**\n * Extract required skills from job listing - separate hard and soft skills\n */\nfunction extractJobSkillsWithType(job: any): { hardSkills: string[]; softSkills: string[] } {\n  const hardSkills: string[] = [];\n  const softSkills: string[] = [];\n  \n  // List of common soft skills that should NOT be exclusion factors\n  const softSkillPatterns = [\n    'communication', 'teamwork', 'team player', 'leadership', 'problem solving',\n    'problem-solving', 'critical thinking', 'time management', 'adaptability',\n    'creativity', 'interpersonal', 'collaboration', 'flexibility', 'motivation',\n    'self-motivated', 'detail oriented', 'detail-oriented', 'organizational',\n    'multitasking', 'work ethic', 'positive attitude', 'customer service',\n    'presentation skills', 'negotiation', 'conflict resolution', 'empathy',\n    'emotional intelligence', 'stress management', 'decision making', 'initiative',\n    'punctuality', 'reliability', 'accountability', 'enthusiasm', 'patience',\n    'resilience', 'open minded', 'open-minded', 'proactive', 'self starter',\n    'self-starter', 'strong work ethic', 'analytical thinking', 'attention to detail'\n  ];\n  \n  const allSkills: string[] = [];\n  \n  // From required_skills field\n  if (job.required_skills) {\n    if (typeof job.required_skills === 'string') {\n      allSkills.push(...job.required_skills.split(',').map((s: string) => s.trim()));\n    } else if (Array.isArray(job.required_skills)) {\n      allSkills.push(...job.required_skills);\n    }\n  }\n  \n  // From description\n  if (job.description) {\n    const technicalTerms = extractTechnicalTerms(job.description);\n    allSkills.push(...technicalTerms);\n  }\n  \n  // Categorize skills\n  const uniqueSkills = [...new Set(allSkills.filter(s => s.length > 1))];\n  \n  for (const skill of uniqueSkills) {\n    const skillLower = skill.toLowerCase();\n    const isSoftSkill = softSkillPatterns.some(pattern => \n      skillLower.includes(pattern) || pattern.includes(skillLower)\n    );\n    \n    if (isSoftSkill) {\n      softSkills.push(skill);\n    } else {\n      hardSkills.push(skill);\n    }\n  }\n  \n  return { \n    hardSkills: hardSkills.slice(0, 20), // Limit to top 20 hard skills\n    softSkills: softSkills.slice(0, 10)  // Limit to top 10 soft skills\n  };\n}\n\n/**\n * Extract required skills from job listing (legacy - kept for compatibility)\n */\nfunction extractJobSkills(job: any): string[] {\n  const { hardSkills, softSkills } = extractJobSkillsWithType(job);\n  return [...hardSkills, ...softSkills];\n}\n\n/**\n * Extract technical terms from text\n */\nfunction extractTechnicalTerms(text: string): string[] {\n  const technicalPatterns = [\n    // Programming languages\n    /\\b(JavaScript|TypeScript|Python|Java|C\\+\\+|C#|Ruby|Go|Rust|PHP|Swift|Kotlin|Scala)\\b/gi,\n    // Frameworks\n    /\\b(React|Angular|Vue|Node\\.js|Express|Django|Flask|Spring|\\.NET|Laravel|Rails)\\b/gi,\n    // Tools & Technologies\n    /\\b(AWS|Azure|GCP|Docker|Kubernetes|Git|Jenkins|CI\\/CD|Terraform|Ansible)\\b/gi,\n    // Databases\n    /\\b(SQL|PostgreSQL|MySQL|MongoDB|Redis|Elasticsearch|Oracle|DynamoDB)\\b/gi,\n    // Methodologies\n    /\\b(Agile|Scrum|Kanban|PMP|Six Sigma|Lean|DevOps|ITIL)\\b/gi,\n    // Soft skills (common in job postings)\n    /\\b(Leadership|Communication|Problem.solving|Team.?work|Project Management)\\b/gi,\n  ];\n  \n  const terms: string[] = [];\n  \n  for (const pattern of technicalPatterns) {\n    const matches = text.match(pattern);\n    if (matches) {\n      terms.push(...matches.map(m => m.trim()));\n    }\n  }\n  \n  return [...new Set(terms)];\n}\n\n/**\n * Check if two skills are similar (accounting for variations)\n */\nfunction areSimilarSkills(skill1: string, skill2: string): boolean {\n  const s1 = skill1.toLowerCase().replace(/[^a-z0-9]/g, '');\n  const s2 = skill2.toLowerCase().replace(/[^a-z0-9]/g, '');\n  \n  // Exact match after normalization\n  if (s1 === s2) return true;\n  \n  // One contains the other\n  if (s1.includes(s2) || s2.includes(s1)) return true;\n  \n  // Common skill variations\n  const variations: Record<string, string[]> = {\n    'javascript': ['js', 'ecmascript'],\n    'typescript': ['ts'],\n    'python': ['py'],\n    'kubernetes': ['k8s'],\n    'postgresql': ['postgres', 'psql'],\n    'mongodb': ['mongo'],\n    'nodejs': ['node', 'expressjs'],\n    'reactjs': ['react', 'reactnative'],\n    'projectmanagement': ['pm', 'projectmanager'],\n    'machinelearning': ['ml', 'ai', 'deeplearning'],\n  };\n  \n  for (const [base, alts] of Object.entries(variations)) {\n    if ((s1 === base || alts.includes(s1)) && (s2 === base || alts.includes(s2))) {\n      return true;\n    }\n  }\n  \n  return false;\n}\n\n/**\n * Calculate experience match score\n * IMPORTANT: Experience is TRANSFERABLE - 5+ years in any role indicates transition potential\n */\nfunction calculateExperienceMatch(profile: any, job: any): number {\n  // Get user's total years of experience\n  let userYears = 0;\n  let longestRoleYears = 0;\n  \n  if (profile.experiences && Array.isArray(profile.experiences)) {\n    for (const exp of profile.experiences) {\n      if (exp.start_date && exp.end_date) {\n        const start = new Date(exp.start_date);\n        const end = exp.end_date === 'Present' ? new Date() : new Date(exp.end_date);\n        const roleYears = (end.getTime() - start.getTime()) / (1000 * 60 * 60 * 24 * 365);\n        userYears += roleYears;\n        longestRoleYears = Math.max(longestRoleYears, roleYears);\n      }\n    }\n  }\n  \n  // Parse required experience from job\n  let requiredYears = 0;\n  const description = (job.description || '').toLowerCase();\n  const experienceLevel = (job.experience_level || '').toLowerCase();\n  \n  // Check experience level field\n  if (experienceLevel.includes('entry') || experienceLevel.includes('junior')) {\n    requiredYears = 1;\n  } else if (experienceLevel.includes('mid') || experienceLevel.includes('intermediate')) {\n    requiredYears = 3;\n  } else if (experienceLevel.includes('senior')) {\n    requiredYears = 5;\n  } else if (experienceLevel.includes('lead') || experienceLevel.includes('principal')) {\n    requiredYears = 7;\n  }\n  \n  // Parse from description\n  const yearsMatch = description.match(/(\\d+)\\+?\\s*years?\\s*(of)?\\s*(experience|exp)/i);\n  if (yearsMatch) {\n    requiredYears = Math.max(requiredYears, parseInt(yearsMatch[1]));\n  }\n  \n  // Calculate score\n  if (requiredYears === 0) return 70; // Neutral if not specified\n  \n  // TRANSITIONAL EXPERIENCE BONUS:\n  // If user has 5+ years in ANY role, they have demonstrated commitment and can transition\n  const transitionBonus = longestRoleYears >= 5 ? 15 : (longestRoleYears >= 3 ? 10 : 0);\n  \n  if (userYears >= requiredYears) {\n    // Full score if meets requirements, bonus for exceeding\n    const exceedBonus = Math.min((userYears - requiredYears) * 5, 15);\n    return Math.min(85 + exceedBonus, 100);\n  } else {\n    // Partial score based on how close, plus transition bonus\n    const ratio = userYears / requiredYears;\n    const baseScore = Math.round(ratio * 70);\n    return Math.min(baseScore + transitionBonus, 85);\n  }\n}\n\n/**\n * Calculate education match score\n */\nfunction calculateEducationMatch(profile: any, job: any): number {\n  const description = (job.description || '').toLowerCase();\n  const userEducation = profile.education || [];\n  \n  // Education level hierarchy\n  const levels: Record<string, number> = {\n    'high school': 1,\n    'associate': 2,\n    'bachelor': 3,\n    'master': 4,\n    'phd': 5,\n    'doctorate': 5\n  };\n  \n  // Determine required level from job\n  let requiredLevel = 0;\n  if (description.includes('phd') || description.includes('doctorate')) requiredLevel = 5;\n  else if (description.includes('master') || description.includes('mba') || description.includes('m.sc')) requiredLevel = 4;\n  else if (description.includes('bachelor') || description.includes('b.sc') || description.includes('degree')) requiredLevel = 3;\n  else if (description.includes('associate')) requiredLevel = 2;\n  \n  if (requiredLevel === 0) return 70; // Neutral if not specified\n  \n  // Get user's highest education level\n  let userLevel = 0;\n  if (Array.isArray(userEducation)) {\n    for (const edu of userEducation) {\n      const degree = (edu.degree || '').toLowerCase();\n      for (const [key, value] of Object.entries(levels)) {\n        if (degree.includes(key)) {\n          userLevel = Math.max(userLevel, value);\n        }\n      }\n    }\n  }\n  \n  // Calculate score\n  if (userLevel >= requiredLevel) {\n    return 100;\n  } else if (userLevel === requiredLevel - 1) {\n    return 70; // One level below is acceptable\n  } else {\n    return Math.max(30, userLevel * 15);\n  }\n}\n\n/**\n * Calculate location match score\n */\nfunction calculateLocationMatch(profile: any, job: any): number {\n  const userLocation = (profile.location || '').toLowerCase();\n  const jobLocation = (job.location || '').toLowerCase();\n  const jobType = (job.job_type || '').toLowerCase();\n  \n  // Remote jobs are always a match\n  if (jobType.includes('remote') || jobLocation.includes('remote')) {\n    return 100;\n  }\n  \n  // If no locations specified\n  if (!userLocation || !jobLocation) {\n    return 50; // Neutral\n  }\n  \n  // Extract city and country\n  const userParts = userLocation.split(',').map(p => p.trim());\n  const jobParts = jobLocation.split(',').map(p => p.trim());\n  \n  // Check for city match\n  for (const userPart of userParts) {\n    for (const jobPart of jobParts) {\n      if (userPart.includes(jobPart) || jobPart.includes(userPart)) {\n        return 100;\n      }\n    }\n  }\n  \n  // Check for country/region match (partial score)\n  const userCountry = userParts[userParts.length - 1];\n  const jobCountry = jobParts[jobParts.length - 1];\n  \n  if (userCountry === jobCountry) {\n    return 70; // Same country\n  }\n  \n  return 30; // Different location\n}\n\n/**\n * Create empty result for missing data\n */\nfunction createEmptyResult(): CompatibilityResult {\n  return {\n    score: 0,\n    level: 'red',\n    matchedSkills: [],\n    missingSkills: [],\n    experienceMatch: 0,\n    educationMatch: 0,\n    locationMatch: false,\n    breakdown: {\n      skills: 0,\n      experience: 0,\n      education: 0,\n      location: 0\n    }\n  };\n}\n\n/**\n * Calculate language match score\n * IMPORTANT: If user has set language proficiency in Search Profile, this bypasses job language requirements\n */\nfunction calculateLanguageMatch(profile: any, job: any, languageProficiencies: Record<string, string>): number {\n  const jobDescription = (job.description || '').toLowerCase();\n  const jobLanguages = (job.languages || '').toLowerCase();\n  \n  // Extract required languages from job\n  const requiredLanguages: string[] = [];\n  const commonLanguages = ['english', 'german', 'french', 'spanish', 'italian', 'dutch', 'portuguese', 'chinese', 'japanese', 'korean', 'russian', 'arabic', 'hindi', 'polish', 'swedish', 'norwegian', 'danish', 'finnish', 'czech', 'hungarian', 'turkish', 'greek', 'hebrew', 'thai', 'vietnamese', 'indonesian', 'malay'];\n  \n  for (const lang of commonLanguages) {\n    if (jobDescription.includes(lang) || jobLanguages.includes(lang)) {\n      requiredLanguages.push(lang);\n    }\n  }\n  \n  // Also check for \"native speaker\" requirements\n  const hasNativeRequirement = jobDescription.includes('native speaker') || \n                                jobDescription.includes('mother tongue') ||\n                                jobDescription.includes('fluent');\n  \n  // If no language requirements found, return high score\n  if (requiredLanguages.length === 0) {\n    return 80;\n  }\n  \n  // Get user's languages from profile\n  const userLanguages = profile.languages || [];\n  const userLanguagesLower = (Array.isArray(userLanguages) ? userLanguages : []).map((l: string) => l.toLowerCase());\n  \n  // Check proficiency levels from Search Profile (this BYPASSES job requirements)\n  const userProficienciesLower: Record<string, string> = {};\n  for (const [lang, level] of Object.entries(languageProficiencies)) {\n    userProficienciesLower[lang.toLowerCase()] = level;\n  }\n  \n  let matchedCount = 0;\n  \n  for (const required of requiredLanguages) {\n    // Check if user has this language\n    const hasLanguage = userLanguagesLower.some(l => l.includes(required) || required.includes(l));\n    \n    // Check if user has proficiency set (this gives automatic match)\n    const hasProficiency = Object.keys(userProficienciesLower).some(l => \n      l.includes(required) || required.includes(l)\n    );\n    \n    if (hasLanguage || hasProficiency) {\n      matchedCount++;\n      \n      // Extra credit for high proficiency\n      const profLevel = Object.entries(userProficienciesLower).find(([l]) => \n        l.includes(required) || required.includes(l)\n      )?.[1];\n      \n      if (profLevel && ['C1', 'C2'].includes(profLevel)) {\n        matchedCount += 0.2; // Bonus for high proficiency\n      }\n    }\n  }\n  \n  // Calculate score\n  const matchRatio = matchedCount / requiredLanguages.length;\n  let score = Math.round(matchRatio * 100);\n  \n  // Apply native speaker penalty only if absolutely required and not met\n  if (hasNativeRequirement && matchRatio < 1) {\n    score = Math.max(score - 10, 0);\n  }\n  \n  return score;\n}\n\n/**\n * Calculate compatibility for all jobs\n */\nexport async function calculateAllCompatibility(userId: number): Promise<void> {\n  const jobs = await getAllQuery('SELECT * FROM job_listings');\n  \n  for (const job of jobs) {\n    if (!job.compatibility_score || job.compatibility_score === 0) {\n      await calculateCompatibility(userId, job.id);\n    }\n  }\n}\n\n/**\n * Get jobs filtered by minimum compatibility\n */\nexport async function getJobsByCompatibility(userId: number, minLevel: 'red' | 'yellow' | 'green' | 'gold'): Promise<any[]> {\n  const jobs = await getAllQuery('SELECT * FROM job_listings');\n  \n  const minScore = {\n    'red': 0,\n    'yellow': 26,\n    'green': 51,\n    'gold': 76\n  }[minLevel];\n  \n  return jobs.filter((job: any) => (job.compatibility_score || 0) >= minScore);\n}\n","import { runQuery, getDatabase, getAllQuery, logAction } from '../database';\nimport { scrapeJobs, getJobPageContent } from '../scraper-service';\nimport { reportGhostJob as reportGhostJobNetwork, isGhostJob as isGhostJobNetwork } from './ghost-job-network';\nimport * as CompatibilityService from './compatibility-service';\n\n// Cancellation flag for Hunter search\nlet hunterCancelled = false;\n\n// Track if hunter is currently searching\nexport let isSearching = false;\n\nexport function setSearchingState(state: boolean) {\n  isSearching = state;\n}\n\nexport function cancelHunterSearch() {\n  hunterCancelled = true;\n  console.log('Hunter search cancellation requested');\n}\n\nexport function isHunterCancelled(): boolean {\n  return hunterCancelled;\n}\n\nexport async function analyzeJobUrl(jobId: number, userId: number, url: string, hunter: any, auditor: any, callAI: Function) {\n  console.log(`\\n========== ANALYZING JOB ${jobId} ==========`);\n  console.log(`URL: ${url}`);\n  console.log(`Hunter model:`, hunter ? hunter.model_name : 'MISSING!');\n  \n  await logAction(userId, 'ai_hunter', `üîç Analyzing: ${url}`, 'in_progress');\n  \n  // Step 1: Get page content\n  console.log('Step 1: Getting page content...');\n  const pageData = await getJobPageContent(url, userId, callAI);\n  \n  console.log(`Scraper result: strategy=\"${pageData.strategyUsed}\", contentLength=${pageData.content.length}`);\n  \n  // Check if blocked or failed\n  if (pageData.strategyUsed.includes('Blocked') || pageData.strategyUsed.includes('Failed')) {\n    console.log('‚ùå Page was blocked or failed');\n    await logAction(userId, 'ai_auditor', `‚ùå Blocked: ${url}`, 'failed', false);\n    await runQuery('DELETE FROM job_listings', { id: jobId });\n    return;\n  }\n\n  // Check minimum content\n  if (!pageData.content || pageData.content.length < 100) {\n    console.log('‚ùå Content too short:', pageData.content.length);\n    await logAction(userId, 'ai_auditor', `‚ùå Empty content: ${url}`, 'failed', false);\n    await runQuery('DELETE FROM job_listings', { id: jobId });\n    return;\n  }\n\n  console.log('‚úÖ Got content, first 500 chars:', pageData.content.substring(0, 500));\n  await logAction(userId, 'ai_hunter', `üìÑ Got ${pageData.content.length} chars via ${pageData.strategyUsed}`, 'in_progress');\n\n  // Step 2: Check if we have a valid Hunter AI model\n  if (!hunter || !hunter.api_key) {\n    console.log('‚ùå No Hunter AI model or missing API key!');\n    await logAction(userId, 'ai_hunter', `‚ùå No Hunter AI configured!`, 'failed', false);\n    \n    // FALLBACK: Try to extract basic info without AI\n    console.log('Attempting fallback extraction...');\n    const fallbackData = extractBasicInfo(pageData.content, url);\n    if (fallbackData.jobTitle) {\n      await runQuery('UPDATE job_listings', { \n        id: jobId, \n        ...fallbackData,\n        status: 'analyzed', \n        date_imported: new Date().toLocaleDateString() \n      });\n      console.log('‚úÖ Saved with fallback data:', fallbackData);\n    }\n    return;\n  }\n\n  // Step 3: Build prompt for AI\n  const isJsonLd = pageData.strategyUsed.includes('JSON-LD');\n  console.log('Is JSON-LD:', isJsonLd);\n  \n  let prompt: string;\n  if (isJsonLd) {\n    prompt = `You are a job data extractor. Extract job details from this JSON-LD data.\n\nReturn ONLY a valid JSON object (no markdown, no explanation):\n{\"jobTitle\":\"exact job title\",\"companyName\":\"company name\",\"location\":\"city, country\",\"jobType\":\"Full-time/Part-time/Contract\",\"experienceLevel\":\"Junior/Mid/Senior\",\"salaryRange\":\"salary or N/A\",\"description\":\"2-3 sentence summary\",\"requiredSkills\":\"comma separated\",\"remoteOnsite\":\"Remote/Hybrid/Onsite\"}\n\nJSON-LD:\n${pageData.content.substring(0, 6000)}`;\n  } else {\n    prompt = `You are a job data extractor. Extract job details from this job listing text.\n\nReturn ONLY a valid JSON object (no markdown, no explanation):\n{\"jobTitle\":\"exact job title\",\"companyName\":\"company name\",\"location\":\"city, country\",\"jobType\":\"Full-time/Part-time/Contract\",\"experienceLevel\":\"Junior/Mid/Senior\",\"salaryRange\":\"salary or N/A\",\"description\":\"2-3 sentence summary\",\"requiredSkills\":\"comma separated\",\"remoteOnsite\":\"Remote/Hybrid/Onsite\"}\n\nJob listing:\n${pageData.content.substring(0, 6000)}`;\n  }\n\n  console.log('Step 3: Calling AI...');\n  console.log('Prompt length:', prompt.length);\n  \n  // Step 4: Call AI\n  let aiResponse: string;\n  try {\n    aiResponse = await callAI(hunter, prompt);\n    console.log('AI Response:', aiResponse);\n  } catch (aiError: any) {\n    console.log('‚ùå AI call failed:', aiError.message);\n    await logAction(userId, 'ai_hunter', `‚ùå AI error: ${aiError.message}`, 'failed', false);\n    \n    // Try fallback\n    const fallbackData = extractBasicInfo(pageData.content, url);\n    if (fallbackData.jobTitle) {\n      await runQuery('UPDATE job_listings', { id: jobId, ...fallbackData, status: 'analyzed', date_imported: new Date().toLocaleDateString() });\n    } else {\n      await runQuery('UPDATE job_listings', { id: jobId, status: 'manual_review' });\n    }\n    return;\n  }\n\n  // Check for AI errors in response\n  if (aiResponse.toLowerCase().includes('error:') || aiResponse.toLowerCase().includes('invalid api')) {\n    console.log('‚ùå AI returned error:', aiResponse);\n    await logAction(userId, 'ai_hunter', `‚ùå AI error: ${aiResponse.substring(0, 100)}`, 'failed', false);\n    await runQuery('UPDATE job_listings', { id: jobId, status: 'manual_review' });\n    return;\n  }\n\n  // Step 5: Parse AI response\n  console.log('Step 5: Parsing AI response...');\n  try {\n    // Clean the response\n    let cleanedResponse = aiResponse\n      .replace(/```json/gi, '')\n      .replace(/```/g, '')\n      .replace(/^[^{]*/, '')  // Remove anything before first {\n      .replace(/[^}]*$/, '')  // Remove anything after last }\n      .trim();\n    \n    // Try to find JSON\n    const jsonMatch = cleanedResponse.match(/\\{[\\s\\S]*\\}/);\n    if (!jsonMatch) {\n      console.log('‚ùå No JSON found in response');\n      throw new Error('No JSON in response');\n    }\n    \n    const data = JSON.parse(jsonMatch[0]);\n    console.log('Parsed data:', data);\n    \n    // Validate required fields\n    const jobTitle = data.jobTitle || data.title || data.job_title || '';\n    const companyName = data.companyName || data.company || data.company_name || data.hiringOrganization?.name || '';\n    \n    if (!jobTitle || jobTitle.toLowerCase() === 'n/a' || jobTitle.toLowerCase() === 'unknown') {\n      console.log('‚ùå Missing job title');\n      await logAction(userId, 'ai_auditor', `‚ùå Missing job title`, 'failed', false);\n      const fallbackData = extractBasicInfo(pageData.content, url);\n      if (fallbackData.jobTitle) {\n        await runQuery('UPDATE job_listings', { id: jobId, ...fallbackData, status: 'analyzed', date_imported: new Date().toLocaleDateString() });\n      } else {\n        await runQuery('DELETE FROM job_listings', { id: jobId });\n      }\n      return;\n    }\n\n    // Step 6: Save to database\n    console.log('Step 6: Saving to database...');\n    const updateData = {\n      id: jobId,\n      job_title: jobTitle,\n      company_name: companyName || 'Unknown Company',\n      location: data.location || data.jobLocation || 'N/A',\n      job_type: data.jobType || data.employmentType || 'N/A',\n      experience_level: data.experienceLevel || 'N/A',\n      salary_range: data.salaryRange || data.salary || data.baseSalary || 'N/A',\n      description: data.description || '',\n      required_skills: data.requiredSkills || data.skills || 'N/A',\n      remote_onsite: data.remoteOnsite || data.jobLocationType || 'N/A',\n      posted_date: data.postedDate || data.datePosted || 'N/A',\n      application_url: data.applicationUrl || data.url || url,\n      status: 'analyzed',\n      date_imported: new Date().toLocaleDateString()\n    };\n    \n    console.log('Update data:', updateData);\n    await runQuery('UPDATE job_listings', updateData);\n    \n    // Step 7: Calculate compatibility score (always, regardless of auto-apply setting)\n    console.log('Step 7: Calculating compatibility score...');\n    try {\n      const compatResult = await CompatibilityService.calculateCompatibility(userId, jobId);\n      console.log(`Compatibility: ${compatResult.score}% (${compatResult.level})`);\n      await logAction(userId, 'ai_auditor', `üìä Match: ${compatResult.level.toUpperCase()} (${compatResult.score}%)`, 'completed', true);\n    } catch (compatError: any) {\n      console.log('Compatibility calculation error:', compatError.message);\n    }\n    \n    await logAction(userId, 'ai_auditor', `‚úÖ Extracted: ${jobTitle} at ${companyName}`, 'completed', true);\n    console.log(`‚úÖ SUCCESS: ${jobTitle} at ${companyName}`);\n    \n  } catch (parseError: any) {\n    console.log('‚ùå Parse error:', parseError.message);\n    await logAction(userId, 'ai_auditor', `‚ùå Parse failed`, 'failed', false);\n\n    // Final fallback\n    const fallbackData = extractBasicInfo(pageData.content, url);\n    if (fallbackData.jobTitle) {\n      await runQuery('UPDATE job_listings', { id: jobId, ...fallbackData, status: 'analyzed', date_imported: new Date().toLocaleDateString() });\n      console.log('‚úÖ Saved with fallback:', fallbackData);\n      \n      // Calculate compatibility even for fallback data\n      try {\n        await CompatibilityService.calculateCompatibility(userId, jobId);\n      } catch (e) {}\n    } else {\n      await runQuery('UPDATE job_listings', { id: jobId, status: 'manual_review' });\n    }\n  }\n}\n\n/**\n * CHECK IF JOB IS A GHOST JOB\n * Uses heuristics: age, company reputation, and description patterns.\n */\nexport async function isGhostJob(jobData: any, userId: number): Promise<{ isGhost: boolean, reason: string }> {\n  console.log(`GJN: Checking reputation for ${jobData.company_name}...`);\n\n  // 1. Check Age (Heuristic)\n  if (jobData.posted_date && jobData.posted_date !== 'N/A') {\n    try {\n      const posted = new Date(jobData.posted_date);\n      const now = new Date();\n      const diffDays = (now.getTime() - posted.getTime()) / (1000 * 60 * 60 * 24);\n      if (diffDays > 30) {\n        return { isGhost: true, reason: \"Job posted more than 30 days ago.\" };\n      }\n    } catch (e) {}\n  }\n\n  // 2. Check Company Reputation\n  const db = getDatabase();\n  const flaggedCompanies = (db.company_monitoring || [])\n    .filter((c: any) => c.status === 'flagged')\n    .map((c: any) => c.name.toLowerCase());\n  \n  if (flaggedCompanies.includes(jobData.company_name.toLowerCase())) {\n    return { isGhost: true, reason: \"Company is flagged in your monitoring list.\" };\n  }\n\n  // 3. Check for \"Ghost\" patterns in description\n  const ghostKeywords = ['evergreen', 'pipeline', 'future opportunities', 'not a specific opening', 'general application'];\n  const desc = (jobData.description || '').toLowerCase();\n  if (ghostKeywords.some(k => desc.includes(k))) {\n    return { isGhost: true, reason: \"Description matches 'Evergreen/Pipeline' patterns.\" };\n  }\n\n  return { isGhost: false, reason: \"\" };\n}\n\nexport async function reportGhostJobLocal(jobId: number, userId: number, reason: string) {\n  console.log(`GJN: Flagging job ${jobId} as Ghost. Reason: ${reason}`);\n  await runQuery('UPDATE job_listings', { id: jobId, status: 'ghost_job_detected', ghost_reason: reason });\n}\n\n/**\n * FALLBACK: Extract basic info without AI\n */\nfunction extractBasicInfo(content: string, url: string): any {\n  console.log('Running fallback extraction...');\n  \n  const data: any = {\n    application_url: url\n  };\n  \n  // Try to extract from JSON-LD\n  try {\n    if (content.startsWith('{')) {\n      const json = JSON.parse(content);\n      data.job_title = json.title || json.jobTitle || json.name || '';\n      data.company_name = json.hiringOrganization?.name || json.companyName || json.company || '';\n      data.location = json.jobLocation?.address?.addressLocality || json.location || '';\n      data.job_type = json.employmentType || '';\n      data.description = json.description?.substring(0, 500) || '';\n      console.log('Extracted from JSON:', data);\n      return data;\n    }\n  } catch (e) {}\n  \n  // Try regex patterns on text\n  const lines = content.split('\\n').map(l => l.trim()).filter(l => l);\n  \n  // Job title is often in first few lines or after specific keywords\n  for (const line of lines.slice(0, 10)) {\n    if (line.length > 5 && line.length < 100 && !line.includes('cookie') && !line.includes('Sign')) {\n      if (!data.job_title) {\n        data.job_title = line;\n        break;\n      }\n    }\n  }\n  \n  // Look for company name patterns\n  const companyPatterns = [\n    /(?:at|@|by|company[:\\s]+)([A-Z][A-Za-z0-9\\s&.-]+)/i,\n    /([A-Z][A-Za-z0-9\\s&.-]+)(?:\\s+is hiring|\\s+jobs)/i\n  ];\n  \n  for (const pattern of companyPatterns) {\n    const match = content.match(pattern);\n    if (match && match[1]) {\n      data.company_name = match[1].trim();\n      break;\n    }\n  }\n  \n  // Location patterns\n  const locationPatterns = [\n    /(?:location|located in|based in)[:\\s]+([A-Za-z\\s,]+)/i,\n    /(Berlin|Munich|Hamburg|Frankfurt|London|Paris|Amsterdam|Remote)/i\n  ];\n  \n  for (const pattern of locationPatterns) {\n    const match = content.match(pattern);\n    if (match && match[1]) {\n      data.location = match[1].trim();\n      break;\n    }\n  }\n  \n  console.log('Fallback extracted:', data);\n  return data;\n}\n\nexport async function startHunterSearch(userId: number, callAI: Function) {\n  console.log('\\n========== STARTING HUNTER SEARCH ==========');\n  \n  // Reset cancellation flag at start\n  hunterCancelled = false;\n  \n  // Set searching state\n  isSearching = true;\n  \n  try {\n    await logAction(userId, 'ai_hunter', 'üöÄ Starting job hunt...', 'in_progress');\n    \n    const db = getDatabase();\n    const profiles = db.search_profiles.filter((p: any) => p.is_active === 1);\n    const websites = db.job_websites.filter((w: any) => w.is_active === 1);\n    const models = await getAllQuery('SELECT * FROM ai_models');\n    \n    console.log('Search profiles:', profiles.length);\n    console.log('Job websites:', websites.length);\n    console.log('AI models:', models.length);\n    \n    const hunter = models.find((m: any) => m.role === 'Hunter' && m.status === 'active');\n    const auditor = models.find((m: any) => m.role === 'Auditor' && m.status === 'active');\n\n    console.log('Hunter:', hunter ? `${hunter.model_name} (key: ${hunter.api_key?.substring(0, 10)}...)` : 'NOT FOUND');\n    console.log('Auditor:', auditor ? auditor.model_name : 'NOT FOUND (will use Hunter)');\n\n    if (!hunter) {\n      const errorMsg = 'No active Hunter AI model. Go to Settings > AI Models and add one with role \"Hunter\".';\n      console.log('‚ùå', errorMsg);\n      await logAction(userId, 'ai_hunter', `‚ùå ${errorMsg}`, 'failed', false);\n      isSearching = false;\n      return { success: false, error: errorMsg };\n    }\n    \n    if (profiles.length === 0) {\n      const errorMsg = 'No active search profiles. Go to Search Profiles and create one.';\n      console.log('‚ùå', errorMsg);\n      await logAction(userId, 'ai_hunter', `‚ùå ${errorMsg}`, 'failed', false);\n      isSearching = false;\n      return { success: false, error: errorMsg };\n    }\n    \n    if (websites.length === 0) {\n      const errorMsg = 'No active job websites. Go to Job Websites and add one.';\n      console.log('‚ùå', errorMsg);\n      await logAction(userId, 'ai_hunter', `‚ùå ${errorMsg}`, 'failed', false);\n      isSearching = false;\n      return { success: false, error: errorMsg };\n    }\n\n    let totalJobsFound = 0;\n\n    for (const profile of profiles) {\n      // Check for cancellation\n      if (hunterCancelled) {\n        console.log('Hunter search cancelled by user');\n        await logAction(userId, 'ai_hunter', `‚èπÔ∏è Search cancelled. Found ${totalJobsFound} jobs before stopping.`, 'completed', true);\n        isSearching = false;\n        return { success: true, jobsFound: totalJobsFound, cancelled: true };\n      }\n      \n      console.log(`\\nProfile: ${profile.job_title} in ${profile.location}`);\n      \n      for (const website of websites) {\n        // Check for cancellation\n        if (hunterCancelled) {\n          console.log('Hunter search cancelled by user');\n          await logAction(userId, 'ai_hunter', `‚èπÔ∏è Search cancelled. Found ${totalJobsFound} jobs before stopping.`, 'completed', true);\n          isSearching = false;\n          return { success: true, jobsFound: totalJobsFound, cancelled: true };\n        }\n        \n        console.log(`Website: ${website.website_name} (${website.website_url})`);\n        \n        await logAction(userId, 'ai_hunter', `üåê Searching ${website.website_name}...`, 'in_progress');\n        \n        // Simple search query (don't waste AI tokens on this)\n        const query = profile.job_title;\n        console.log(`Search query: \"${query}\"`);\n        \n        // Scrape job URLs\n        const jobUrls = await scrapeJobs(\n          website.website_url, \n          query, \n          profile.location || '', \n          { email: website.email, password: website.password }, \n          userId, \n          callAI\n        );\n        \n        console.log(`Found ${jobUrls.length} URLs`);\n        await logAction(userId, 'ai_hunter', `üì• Found ${jobUrls.length} jobs on ${website.website_name}`, 'completed', true);\n        \n        // Process each URL\n        for (const url of jobUrls) {\n          // Check for cancellation before each job\n          if (hunterCancelled) {\n            console.log('Hunter search cancelled by user');\n            await logAction(userId, 'ai_hunter', `‚èπÔ∏è Search cancelled. Found ${totalJobsFound} jobs before stopping.`, 'completed', true);\n            return { success: true, jobsFound: totalJobsFound, cancelled: true };\n          }\n          \n          // Skip duplicates\n          const existing = db.job_listings.find((j: any) => j.url === url);\n          if (existing) {\n            console.log(`Skipping duplicate: ${url}`);\n            continue;\n          }\n          \n          // Create job entry\n          const jobId = Date.now() + Math.floor(Math.random() * 1000);\n          await runQuery('INSERT INTO job_listings', { \n            id: jobId, \n            url, \n            source: website.website_name, \n            status: 'analyzing' \n          });\n          \n          totalJobsFound++;\n          console.log(`Added job ${jobId}: ${url}`);\n          \n          // Analyze immediately (wait for it to complete)\n          await analyzeJobUrl(jobId, userId, url, hunter, auditor || hunter, callAI);\n          \n          // Small delay\n          await new Promise(resolve => setTimeout(resolve, 2000));\n        }\n      }\n    }\n    \n    await logAction(userId, 'ai_hunter', `‚úÖ Done! Processed ${totalJobsFound} jobs.`, 'completed', true);\n    console.log(`\\n========== HUNT COMPLETE: ${totalJobsFound} jobs ==========\\n`);\n    isSearching = false;\n    return { success: true, jobsFound: totalJobsFound };\n    \n  } catch (error: any) { \n    console.error('Hunt error:', error);\n    await logAction(userId, 'ai_hunter', `‚ùå Error: ${error.message}`, 'failed', false);\n    isSearching = false;\n    return { success: false, error: error.message }; \n  } finally {\n    // Always reset searching state when done\n    isSearching = false;\n  }\n}","import { runQuery, getDatabase, logAction, getAllQuery } from '../database';\nimport { getCompanyInfo } from '../scraper-service';\nimport * as fs from 'fs';\nimport * as path from 'path';\nlet app: any;\ntry { app = require('electron').app; } catch (e) { app = (global as any).electronApp; }\n\n// Get base documents directory in user data\nconst getBaseDocsDir = () => {\n  const docsPath = path.join(app.getPath('userData'), 'generated_docs');\n  if (!fs.existsSync(docsPath)) {\n    fs.mkdirSync(docsPath, { recursive: true });\n  }\n  return docsPath;\n};\n\n// Get organized documents directory: Company/Position/\nconst getOrganizedDocsDir = (companyName: string, position: string) => {\n  // Sanitize folder names (remove invalid characters)\n  const sanitize = (str: string) => str.replace(/[<>:\"/\\\\|?*]/g, '_').trim().substring(0, 50);\n  \n  const company = sanitize(companyName || 'Unknown_Company');\n  const pos = sanitize(position || 'Unknown_Position');\n  \n  const docsPath = path.join(getBaseDocsDir(), company, pos);\n  if (!fs.existsSync(docsPath)) {\n    fs.mkdirSync(docsPath, { recursive: true });\n  }\n  return docsPath;\n};\n\n// Legacy: Get simple documents directory (for backwards compatibility)\nconst getDocsDir = () => {\n  return getBaseDocsDir();\n};\n\n/**\n * Get the profile data based on Thinker's source setting\n */\nasync function getProfileByThinkerSource(userId: number, thinker: any): Promise<any> {\n  const source = thinker?.thinker_source || 'all';\n  const db = getDatabase();\n  \n  // Get all profiles\n  const profiles = db.user_profile || [];\n  const linkedinProfile = profiles.find((p: any) => p.source === 'linkedin');\n  const manualProfile = profiles.find((p: any) => p.source === 'manual');\n  const baseProfile = profiles[0];\n  \n  // Get uploaded CVs\n  const documents = db.documents || [];\n  const uploadedCvs = documents.filter((d: any) => d.doc_type === 'uploaded_cv');\n  \n  let selectedProfile = baseProfile;\n  \n  switch (source) {\n    case 'linkedin':\n      if (linkedinProfile) {\n        selectedProfile = linkedinProfile;\n      }\n      break;\n    case 'manual':\n      if (manualProfile) {\n        selectedProfile = manualProfile;\n      }\n      break;\n    case 'uploaded_cv':\n      // For uploaded CVs, use base profile with CV data integrated\n      if (uploadedCvs.length > 0) {\n        selectedProfile = baseProfile;\n        // Note: CV content could be parsed and integrated here\n      }\n      break;\n    case 'all':\n    default:\n      // Combine all sources (default behavior)\n      selectedProfile = baseProfile;\n      break;\n  }\n  \n  return selectedProfile;\n}\n\n/**\n * Build verification prompt for Auditor to check forced documents\n */\nfunction buildVerificationPrompt(docKey: string, docLabel: string, content: string, userProfile: any): string {\n  return `You are the \"Auditor\" agent. A document was forcefully generated by user override. Your job is to verify it doesn't contain FABRICATED information.\n\nDOCUMENT TYPE: ${docLabel}\n\nUSER'S ACTUAL PROFILE DATA:\nName: ${userProfile?.name || 'Unknown'}\nTitle: ${userProfile?.title || 'Unknown'}\nSkills: ${userProfile?.skills || 'Not provided'}\nExperiences: ${JSON.stringify(userProfile?.experiences || []).substring(0, 500)}\n\nGENERATED CONTENT TO VERIFY:\n${content}\n\nCHECK FOR:\n1. Are there any job titles, companies, or dates mentioned that are NOT in the user's profile?\n2. Are there any specific achievements or metrics that seem fabricated?\n3. Are there any skills or certifications not mentioned in the profile?\n\nRESPONSE FORMAT:\nIf the content appears accurate to the profile data: \"VERIFIED: Content matches profile data\"\nIf fabrications are detected: \"FABRICATION DETECTED: [list specific fabricated items]\"`;\n}\n\n// Clean AI output - remove JSON artifacts and meta-text\nfunction cleanAIOutput(content: string): string {\n  let cleaned = content;\n  \n  // Remove JSON wrapper patterns\n  cleaned = cleaned.replace(/^\\s*\\{\\s*\"(coverLetter|motivationLetter|cv|letter)\"\\s*:\\s*\"/i, '');\n  cleaned = cleaned.replace(/\"\\s*\\}\\s*$/i, '');\n  \n  // Remove markdown code blocks\n  cleaned = cleaned.replace(/```[a-z]*\\n?/gi, '');\n  cleaned = cleaned.replace(/```/g, '');\n  \n  // Remove meta-commentary at the start\n  cleaned = cleaned.replace(/^Here is (the|your|a) (motivation letter|cover letter|CV|resume)[:\\s]*/i, '');\n  cleaned = cleaned.replace(/^(Below is|I've created|I have written)[^.]*\\.\\s*/i, '');\n  \n  // Remove em-dashes and replace with regular dashes\n  cleaned = cleaned.replace(/‚Äî/g, '-');\n  cleaned = cleaned.replace(/‚Äì/g, '-');\n  \n  // Remove escaped newlines and fix formatting\n  cleaned = cleaned.replace(/\\\\n/g, '\\n');\n  cleaned = cleaned.replace(/\\\\\"/g, '\"');\n  \n  // Remove any remaining JSON artifacts\n  cleaned = cleaned.replace(/^\\s*[\\[{]/, '');\n  cleaned = cleaned.replace(/[\\]}]\\s*$/, '');\n  \n  // Trim whitespace\n  cleaned = cleaned.trim();\n  \n  return cleaned;\n}\n\n// Document type definitions\nconst DOC_TYPES = [\n  { key: 'cv', label: 'CV', optionKey: 'cv' },\n  { key: 'motivation_letter', label: 'Motivation Letter', optionKey: 'motivationLetter' },\n  { key: 'cover_letter', label: 'Cover Letter', optionKey: 'coverLetter' },\n  { key: 'portfolio', label: 'Portfolio', optionKey: 'portfolio' },\n  { key: 'proposal', label: 'Proposal', optionKey: 'proposal' }\n];\n\n// Generate HTML template for document\nfunction generateDocumentHTML(content: string, docType: string, userProfile: any, job: any): string {\n  const title = `${docType} - ${userProfile?.name || 'Applicant'} - ${job?.company_name || 'Company'}`;\n  \n  return `<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>${title}</title>\n  <style>\n    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');\n    \n    * {\n      margin: 0;\n      padding: 0;\n      box-sizing: border-box;\n    }\n    \n    body {\n      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n      line-height: 1.6;\n      color: #1a1a1a;\n      max-width: 800px;\n      margin: 0 auto;\n      padding: 40px;\n      background: #fff;\n    }\n    \n    .header {\n      margin-bottom: 30px;\n      padding-bottom: 20px;\n      border-bottom: 2px solid #0077b5;\n    }\n    \n    .name {\n      font-size: 28px;\n      font-weight: 700;\n      color: #0077b5;\n      margin-bottom: 5px;\n    }\n    \n    .title {\n      font-size: 16px;\n      color: #666;\n      margin-bottom: 10px;\n    }\n    \n    .contact {\n      font-size: 13px;\n      color: #444;\n    }\n    \n    .contact span {\n      margin-right: 15px;\n    }\n    \n    .section {\n      margin-bottom: 25px;\n    }\n    \n    .section-title {\n      font-size: 14px;\n      font-weight: 600;\n      color: #0077b5;\n      text-transform: uppercase;\n      letter-spacing: 1px;\n      margin-bottom: 10px;\n      padding-bottom: 5px;\n      border-bottom: 1px solid #e0e0e0;\n    }\n    \n    .content {\n      font-size: 14px;\n      text-align: justify;\n      white-space: pre-wrap;\n    }\n    \n    .content p {\n      margin-bottom: 12px;\n    }\n    \n    .experience-item, .education-item {\n      margin-bottom: 15px;\n    }\n    \n    .item-header {\n      display: flex;\n      justify-content: space-between;\n      align-items: baseline;\n    }\n    \n    .item-title {\n      font-weight: 600;\n      font-size: 15px;\n    }\n    \n    .item-company {\n      color: #666;\n      font-size: 14px;\n    }\n    \n    .item-date {\n      color: #888;\n      font-size: 13px;\n    }\n    \n    .item-description {\n      font-size: 13px;\n      color: #444;\n      margin-top: 5px;\n    }\n    \n    .skills-list {\n      display: flex;\n      flex-wrap: wrap;\n      gap: 8px;\n    }\n    \n    .skill-tag {\n      background: #e3f2fd;\n      color: #0077b5;\n      padding: 4px 12px;\n      border-radius: 15px;\n      font-size: 12px;\n    }\n    \n    @media print {\n      body {\n        padding: 20px;\n      }\n    }\n  </style>\n</head>\n<body>\n  <div class=\"header\">\n    <div class=\"name\">${userProfile?.name || 'Your Name'}</div>\n    <div class=\"title\">${userProfile?.title || 'Professional Title'}</div>\n    <div class=\"contact\">\n      ${userProfile?.email ? `<span>üìß ${userProfile.email}</span>` : ''}\n      ${userProfile?.phone ? `<span>üì± ${userProfile.phone}</span>` : ''}\n      ${userProfile?.location ? `<span>üìç ${userProfile.location}</span>` : ''}\n    </div>\n  </div>\n  \n  <div class=\"section\">\n    <div class=\"content\">${content.replace(/\\n/g, '<br>')}</div>\n  </div>\n</body>\n</html>`;\n}\n\n// Generate CV HTML with full profile\nfunction generateCVHTML(content: string, userProfile: any, job: any): string {\n  const experiences = userProfile?.experiences || [];\n  const educations = userProfile?.educations || [];\n  const skills = userProfile?.skills || [];\n  const certifications = userProfile?.licenses || [];\n  \n  let experiencesHTML = '';\n  if (Array.isArray(experiences)) {\n    experiencesHTML = experiences.map((exp: any) => `\n      <div class=\"experience-item\">\n        <div class=\"item-header\">\n          <div>\n            <span class=\"item-title\">${exp.title || exp}</span>\n            ${exp.company ? `<span class=\"item-company\"> at ${exp.company}</span>` : ''}\n          </div>\n          <span class=\"item-date\">${exp.startDate || ''} - ${exp.endDate || 'Present'}</span>\n        </div>\n        ${exp.location ? `<div style=\"color: #666; font-size: 13px;\">${exp.location}</div>` : ''}\n        ${exp.description ? `<div class=\"item-description\">${exp.description}</div>` : ''}\n      </div>\n    `).join('');\n  }\n  \n  let educationsHTML = '';\n  if (Array.isArray(educations)) {\n    educationsHTML = educations.map((edu: any) => `\n      <div class=\"education-item\">\n        <div class=\"item-header\">\n          <div>\n            <span class=\"item-title\">${edu.degree || edu}</span>\n            ${edu.field ? `<span class=\"item-company\"> in ${edu.field}</span>` : ''}\n          </div>\n          <span class=\"item-date\">${edu.startYear || ''} - ${edu.endYear || ''}</span>\n        </div>\n        ${edu.school ? `<div style=\"color: #666; font-size: 13px;\">${edu.school}</div>` : ''}\n      </div>\n    `).join('');\n  }\n  \n  let skillsHTML = '';\n  if (Array.isArray(skills) && skills.length > 0) {\n    skillsHTML = `<div class=\"skills-list\">${skills.map((s: string) => `<span class=\"skill-tag\">${s}</span>`).join('')}</div>`;\n  }\n  \n  let certsHTML = '';\n  if (Array.isArray(certifications) && certifications.length > 0) {\n    certsHTML = `<div class=\"skills-list\">${certifications.map((c: string) => `<span class=\"skill-tag\" style=\"background: #fff3e0; color: #ef6c00;\">${c}</span>`).join('')}</div>`;\n  }\n\n  return `<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>CV - ${userProfile?.name || 'Applicant'}</title>\n  <style>\n    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');\n    \n    * { margin: 0; padding: 0; box-sizing: border-box; }\n    \n    body {\n      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n      line-height: 1.5;\n      color: #1a1a1a;\n      max-width: 850px;\n      margin: 0 auto;\n      padding: 30px 40px;\n      background: #fff;\n    }\n    \n    .header {\n      display: flex;\n      gap: 20px;\n      align-items: center;\n      margin-bottom: 25px;\n      padding-bottom: 20px;\n      border-bottom: 3px solid #0077b5;\n    }\n    \n    .header-photo {\n      width: 100px;\n      height: 100px;\n      border-radius: 50%;\n      object-fit: cover;\n      border: 3px solid #0077b5;\n    }\n    \n    .header-info { flex: 1; }\n    .name { font-size: 32px; font-weight: 700; color: #0077b5; }\n    .title { font-size: 18px; color: #444; margin: 5px 0; }\n    .contact { font-size: 13px; color: #666; display: flex; flex-wrap: wrap; gap: 15px; margin-top: 8px; }\n    \n    .main { display: grid; grid-template-columns: 1fr 300px; gap: 30px; }\n    .left-column { }\n    .right-column { }\n    \n    .section { margin-bottom: 20px; }\n    .section-title {\n      font-size: 13px;\n      font-weight: 700;\n      color: #0077b5;\n      text-transform: uppercase;\n      letter-spacing: 1.5px;\n      margin-bottom: 12px;\n      padding-bottom: 5px;\n      border-bottom: 2px solid #e0e0e0;\n    }\n    \n    .summary { font-size: 14px; color: #333; text-align: justify; }\n    \n    .experience-item, .education-item { margin-bottom: 18px; }\n    .item-header { display: flex; justify-content: space-between; flex-wrap: wrap; }\n    .item-title { font-weight: 600; font-size: 15px; color: #1a1a1a; }\n    .item-company { color: #666; font-size: 14px; }\n    .item-date { color: #888; font-size: 12px; }\n    .item-description { font-size: 13px; color: #444; margin-top: 5px; }\n    \n    .skills-list { display: flex; flex-wrap: wrap; gap: 6px; }\n    .skill-tag {\n      background: #e3f2fd;\n      color: #0077b5;\n      padding: 4px 10px;\n      border-radius: 12px;\n      font-size: 11px;\n      font-weight: 500;\n    }\n    \n    @media print {\n      body { padding: 15px; font-size: 12px; }\n      .section-title { font-size: 11px; }\n      .name { font-size: 24px; }\n    }\n  </style>\n</head>\n<body>\n  <div class=\"header\">\n    ${userProfile?.photo ? `<img src=\"${userProfile.photo}\" class=\"header-photo\" alt=\"Photo\">` : ''}\n    <div class=\"header-info\">\n      <div class=\"name\">${userProfile?.name || 'Your Name'}</div>\n      <div class=\"title\">${userProfile?.title || 'Professional Title'}</div>\n      <div class=\"contact\">\n        ${userProfile?.email ? `<span>üìß ${userProfile.email}</span>` : ''}\n        ${userProfile?.phone ? `<span>üì± ${userProfile.phone}</span>` : ''}\n        ${userProfile?.location ? `<span>üìç ${userProfile.location}</span>` : ''}\n      </div>\n    </div>\n  </div>\n  \n  <div class=\"main\">\n    <div class=\"left-column\">\n      ${userProfile?.summary ? `\n        <div class=\"section\">\n          <div class=\"section-title\">Professional Summary</div>\n          <div class=\"summary\">${userProfile.summary}</div>\n        </div>\n      ` : ''}\n      \n      ${experiencesHTML ? `\n        <div class=\"section\">\n          <div class=\"section-title\">Work Experience</div>\n          ${experiencesHTML}\n        </div>\n      ` : ''}\n      \n      ${educationsHTML ? `\n        <div class=\"section\">\n          <div class=\"section-title\">Education</div>\n          ${educationsHTML}\n        </div>\n      ` : ''}\n    </div>\n    \n    <div class=\"right-column\">\n      ${skillsHTML ? `\n        <div class=\"section\">\n          <div class=\"section-title\">Skills</div>\n          ${skillsHTML}\n        </div>\n      ` : ''}\n      \n      ${certsHTML ? `\n        <div class=\"section\">\n          <div class=\"section-title\">Certifications</div>\n          ${certsHTML}\n        </div>\n      ` : ''}\n      \n      ${userProfile?.languages?.length > 0 ? `\n        <div class=\"section\">\n          <div class=\"section-title\">Languages</div>\n          <div class=\"skills-list\">\n            ${userProfile.languages.map((l: string) => `<span class=\"skill-tag\" style=\"background: #e8f5e9; color: #388e3c;\">${l}</span>`).join('')}\n          </div>\n        </div>\n      ` : ''}\n    </div>\n  </div>\n</body>\n</html>`;\n}\n\n// Save document to file with organized directory structure\nfunction saveDocumentFile(content: string, jobId: number, docType: string, format: 'html' | 'txt' = 'html', companyName?: string, position?: string): string {\n  // Use organized directory if company/position available, otherwise use base directory\n  const docsDir = (companyName && position) \n    ? getOrganizedDocsDir(companyName, position)\n    : getDocsDir();\n    \n  const timestamp = Date.now();\n  const fileName = `${docType}_job${jobId}_${timestamp}.${format}`;\n  const filePath = path.join(docsDir, fileName);\n  \n  fs.writeFileSync(filePath, content, 'utf-8');\n  console.log(`Document saved: ${filePath}`);\n  \n  return filePath;\n}\n\n// Main document generation function\nexport async function generateTailoredDocs(job: any, userId: number, thinker: any, auditor: any, options: any, callAI: Function) {\n  const db = getDatabase();\n  \n  // Get profile based on Thinker's source settings\n  const userProfile = await getProfileByThinkerSource(userId, thinker);\n  \n  if (!userProfile) {\n    await logAction(userId, 'ai_thinker', '‚ùå No user profile found. Please create your profile first.', 'failed', false);\n    return;\n  }\n\n  // Get word limits from Thinker settings\n  const motivationLetterWordLimit = thinker?.motivation_letter_word_limit || '450';\n  const coverLetterWordLimit = thinker?.cover_letter_word_limit || '280';\n\n  // Step 0: Research Company\n  let companyResearch = \"\";\n  try {\n    await logAction(userId, 'ai_thinker', `üîç Researching ${job.company_name} mission and history...`, 'in_progress');\n    companyResearch = await getCompanyInfo(job.company_name, userId, callAI);\n  } catch (e) {\n    console.error(\"Research failed:\", e);\n    companyResearch = \"Research unavailable.\";\n  }\n\n  for (const type of DOC_TYPES) {\n    if (options[type.optionKey]) {\n      try {\n        await logAction(userId, 'ai_thinker', `‚úçÔ∏è Generating tailored ${type.label} for ${job.company_name}`, 'in_progress');\n        await runQuery('UPDATE job_listings', { id: job.id, [`${type.key}_status`]: 'generating' });\n\n        // Check for force override (bypass Auditor rejection)\n        const forceOverride = options.forceOverride === true;\n\n        let attempts = 0;\n        let approved = false;\n        let content = '';\n        let feedback = '';\n        const maxAttempts = forceOverride ? 1 : 2; // Only 1 attempt if forced\n\n        while (attempts < maxAttempts && !approved) {\n          attempts++;\n          \n          // Build the prompt based on document type with custom word limits\n          const thinkerPrompt = buildThinkerPrompt(\n            type.key, \n            type.label, \n            userProfile, \n            job, \n            companyResearch, \n            feedback,\n            { motivationLetterWordLimit, coverLetterWordLimit }\n          );\n          \n          let rawContent = await callAI(thinker, thinkerPrompt);\n          \n          // Clean the AI output to remove JSON artifacts and meta-text\n          content = cleanAIOutput(rawContent);\n          \n          if (forceOverride) {\n            // Skip Auditor verification for forced generation\n            approved = true;\n            await logAction(userId, 'ai_thinker', `‚ö° ${type.label} generated (force override - Auditor bypassed)`, 'completed', true);\n          } else {\n            await logAction(userId, 'ai_auditor', `üßê Auditing ${type.label} (Attempt ${attempts})`, 'in_progress');\n            \n            const auditorPrompt = buildAuditorPrompt(type.key, type.label, content, job);\n            const auditResponse = await callAI(auditor, auditorPrompt);\n            \n            if (auditResponse.toUpperCase().includes('APPROVED')) {\n              approved = true;\n              await logAction(userId, 'ai_auditor', `‚úÖ ${type.label} approved`, 'completed', true);\n            } else {\n              feedback = auditResponse.replace(/REJECTED:/i, '').trim();\n              await logAction(userId, 'ai_auditor', `‚ùå ${type.label} rejected: ${feedback}`, 'in_progress', false);\n            }\n          }\n        }\n\n        // After generation, if forceOverride was used, run Auditor verification check (but don't block)\n        if (forceOverride && content) {\n          try {\n            await logAction(userId, 'ai_auditor', `üîç Verifying forced ${type.label} for accuracy...`, 'in_progress');\n            const verificationPrompt = buildVerificationPrompt(type.key, type.label, content, userProfile);\n            const verificationResult = await callAI(auditor, verificationPrompt);\n            \n            if (verificationResult.toUpperCase().includes('FABRICATION') || verificationResult.toUpperCase().includes('HALLUCINATION')) {\n              await logAction(userId, 'ai_auditor', `‚ö†Ô∏è Warning: ${type.label} may contain fabricated information. Please review carefully.`, 'completed', false);\n            } else {\n              await logAction(userId, 'ai_auditor', `‚úÖ ${type.label} verification passed - no fabrications detected`, 'completed', true);\n            }\n          } catch (e) {\n            console.error('Verification error:', e);\n          }\n          approved = true; // Still save the document\n        }\n\n        if (approved) {\n          // Generate HTML file\n          let htmlContent: string;\n          if (type.key === 'cv') {\n            htmlContent = generateCVHTML(content, userProfile, job);\n          } else {\n            htmlContent = generateDocumentHTML(content, type.label, userProfile, job);\n          }\n          \n          // Save to file system with organized directory structure (Company/Position/Files)\n          const filePath = saveDocumentFile(htmlContent, job.id, type.key, 'html', job.company_name, job.job_title);\n          \n          // Save to documents table\n          const docId = Date.now() + Math.floor(Math.random() * 1000);\n          await runQuery('INSERT INTO documents', {\n            id: docId,\n            job_id: job.id,\n            user_id: userId,\n            document_type: type.key,\n            content: content,\n            file_path: filePath,\n            version: 1,\n            status: forceOverride ? 'forced' : 'final',\n            created_at: new Date().toISOString()\n          });\n\n          await runQuery('UPDATE job_listings', { \n            id: job.id, \n            [`${type.key}_status`]: 'auditor_done',\n            [`${type.key}_path`]: filePath,\n            [`${type.key}_rejection_reason`]: null\n          });\n          \n          await logAction(userId, 'ai_thinker', `üìÑ ${type.label} saved to: ${filePath}`, 'completed', true);\n        } else {\n          // Document rejected - save reason for user\n          const rejectionMessage = `The document was rejected after 2 generation attempts. Reason: ${feedback}\\n\\nThis may indicate:\\n- Profile data doesn't match job requirements well enough\\n- Missing key experiences or skills for this role\\n- The AI couldn't find enough relevant information to create a compelling document`;\n          \n          await runQuery('UPDATE job_listings', { \n            id: job.id, \n            [`${type.key}_status`]: 'rejected',\n            [`${type.key}_rejection_reason`]: rejectionMessage\n          });\n          await logAction(userId, 'ai_thinker', `‚ùå Failed to generate acceptable ${type.label} after 2 attempts: ${feedback}`, 'failed', false);\n        }\n\n      } catch (e: any) {\n        console.error(`Error generating ${type.key}:`, e);\n        await runQuery('UPDATE job_listings', { id: job.id, [`${type.key}_status`]: 'failed' });\n        await logAction(userId, 'ai_thinker', `‚ùå Error: ${e.message}`, 'failed', false);\n      }\n    }\n  }\n}\n\n// Build Thinker prompt based on document type\nfunction buildThinkerPrompt(\n  docKey: string, \n  docLabel: string, \n  userProfile: any, \n  job: any, \n  companyResearch: string, \n  feedback: string,\n  wordLimits?: { motivationLetterWordLimit: string; coverLetterWordLimit: string }\n): string {\n  const motivationWordLimit = wordLimits?.motivationLetterWordLimit || '450';\n  const coverWordLimit = wordLimits?.coverLetterWordLimit || '280';\n  \n  const baseContext = `\nUSER PROFILE:\nName: ${userProfile?.name || 'N/A'}\nTitle: ${userProfile?.title || 'N/A'}\nLocation: ${userProfile?.location || 'N/A'}\nEmail: ${userProfile?.email || 'N/A'}\nPhone: ${userProfile?.phone || 'N/A'}\nSummary: ${userProfile?.summary || 'N/A'}\nExperiences: ${JSON.stringify(userProfile?.experiences || [])}\nSkills: ${JSON.stringify(userProfile?.skills || [])}\nEducation: ${JSON.stringify(userProfile?.educations || [])}\nCertifications: ${JSON.stringify(userProfile?.licenses || [])}\nLanguages: ${JSON.stringify(userProfile?.languages || [])}\n\nJOB DETAILS:\nTitle: ${job.job_title}\nCompany: ${job.company_name}\nLocation: ${job.location || 'N/A'}\nType: ${job.job_type || 'N/A'}\nDescription: ${job.description || 'N/A'}\nRequired Skills: ${job.required_skills || 'N/A'}\n\nCOMPANY RESEARCH:\n${companyResearch || 'No additional company research available. Focus on what can be inferred from the job description.'}\n\n${feedback ? `PREVIOUS FEEDBACK FROM AUDITOR: ${feedback}\\nPlease fix these issues in the new version.` : ''}\n`;\n\n  const prompts: Record<string, string> = {\n    cv: `You are a professional CV/Resume writer. Create a tailored CV for this job application.\n\n${baseContext}\n\nCRITICAL RULES - VIOLATIONS WILL CAUSE REJECTION:\n1. DO NOT fabricate or hallucinate any information - use ONLY data from the provided profile\n2. DO NOT invent job titles, companies, dates, or achievements not in the profile\n3. DO NOT include any JSON formatting or markdown code blocks\n4. DO NOT add meta-commentary like \"Here is your CV\"\n\nNOTE: CV generation is NOT subject to word limits. Use the full profile data.\n\nREQUIREMENTS:\n1. Tailor the CV specifically to the job requirements\n2. Highlight relevant experiences and skills that match the job description - but ONLY from the provided profile\n3. Use action verbs and quantify achievements where the data exists in the profile\n4. Keep it ATS-friendly (no tables, columns, graphics)\n5. Include contact information at the top (from the profile)\n6. Language: Match the job description language\n7. Structure: Contact Info, Professional Summary, Work Experience, Education, Skills, Certifications, Languages\n\nATS OPTIMIZATION:\n- IMPORTANT: Include relevant KEYWORDS from the job description in your CV where they genuinely apply\n- If the job mentions specific tools, technologies, or skills that relate to your experience, use those exact terms\n- Mirror the language and terminology used in the job posting where appropriate\n- If there are skill gaps, don't fabricate - instead, emphasize transferable skills and related experience\n\nSTRUCTURE:\n- CONTACT: Name, Title, Email, Phone, Location (from profile)\n- PROFESSIONAL SUMMARY: 3-4 sentences summarizing experience relevant to this role. If there's a skill gap, briefly mention eagerness to apply existing skills to new challenges.\n- WORK EXPERIENCE: List jobs from profile with title, company, dates, and bullet points\n- EDUCATION: List degrees from profile\n- SKILLS: List skills from profile, prioritizing those matching job requirements\n- CERTIFICATIONS: List certifications from profile\n- LANGUAGES: List languages from profile\n\nOUTPUT FORMAT: Return ONLY the CV content in clean text format. Use clear section headings.`,\n\n    motivation_letter: `You are an expert Motivation Letter writer. Create a compelling, HUMAN-SOUNDING motivation letter.\n\n${baseContext}\n\nWORD LIMIT: ${motivationWordLimit} words (this is configurable by the user)\n\nCRITICAL RULES - VIOLATIONS WILL CAUSE REJECTION:\n1. DO NOT start with \"Here is the motivation letter:\" or any similar meta-text\n2. DO NOT include JSON formatting like { \"motivationLetter\": ... }\n3. DO NOT mention \"I could not find...\" or \"Research was unavailable\"\n4. DO NOT use long em-dashes (‚Äî), use regular dashes (-) only\n5. DO NOT use clich√©s: \"I am thrilled\", \"passionate professional\", \"fast-paced world\"\n6. DO NOT start sentences with \"I have...\" or \"I am...\" repeatedly\n7. DO NOT fabricate or hallucinate information - use ONLY data from the provided profile\n8. DO NOT invent company facts not mentioned in the research - if unsure, focus on what's in the job posting\n9. Output ONLY the letter content, starting with the date and recipient\n10. MUST end with proper sign-off: \"Kind regards,\" followed by the applicant's full name\n\nHANDLING SKILL GAPS (IMPORTANT):\n- If the candidate's profile doesn't perfectly match all job requirements, DO NOT reject or avoid the task\n- Instead, express genuine enthusiasm to learn and adapt to the role's requirements\n- Highlight transferable skills that relate to the missing requirements\n- Show willingness to grow: phrases like \"I am eager to expand my expertise in...\" or \"I look forward to developing my skills in...\"\n- Frame any gaps as growth opportunities, not weaknesses\n\nSTRUCTURE (follow exactly):\n1. HEADER: Date, Company Address, \"Dear Hiring Manager,\"\n2. OPENING (1 paragraph): State who you are, what position, and ONE compelling reason why this company\n3. COMPANY CONNECTION (1 paragraph): Reference something specific about the company - their products, services, recent news, or values. If research is limited, focus on what's clear from the job posting\n4. YOUR VALUE (2 paragraphs): \n   - First: Your most relevant experience with SPECIFIC metrics/achievements FROM YOUR ACTUAL PROFILE\n   - Second: How your skills directly solve their needs OR how your transferable skills and eagerness to learn make you a strong candidate\n5. WHY THIS ROLE (1 paragraph): Personal motivation - career goals, growth opportunity, alignment. EXPRESS ENTHUSIASM to learn any skills you may be developing.\n6. CLOSING: Thank them, express enthusiasm for an interview\n7. SIGN-OFF: \"Kind regards,\" + new line + \"${userProfile?.name || '[Your Name]'}\"\n\nMUST INCLUDE:\n- At least 2 specific achievements with numbers/metrics FROM THE PROVIDED PROFILE\n- At least 1 specific reference to the company (product, service, or value)\n- Smooth transitions between paragraphs\n- Professional but warm tone\n- Proper sign-off with full name\n- If skill gaps exist: Express enthusiasm to learn and adapt\n\nLength: Approximately ${motivationWordLimit} words. This is a formal document.\nLanguage: Match the job description language.\n\nReturn ONLY the motivation letter content, starting directly with the date and ending with the sign-off.`,\n\n    cover_letter: `You are an expert Cover Letter writer. Create a concise, professional cover letter.\n\n${baseContext}\n\nWORD LIMIT: ${coverWordLimit} words (this is configurable by the user)\n\nCRITICAL RULES - VIOLATIONS WILL CAUSE REJECTION:\n1. DO NOT include any JSON formatting like { \"coverLetter\": ... }\n2. DO NOT start with meta-text like \"Here is the cover letter:\"\n3. DO NOT use long em-dashes (‚Äî), use regular dashes (-) only\n4. DO NOT fabricate or hallucinate information not provided in the profile\n5. Output ONLY the letter content, starting with \"Dear Hiring Manager\" or similar\n\nHANDLING SKILL GAPS:\n- If there are gaps between the job requirements and the candidate's profile, highlight transferable skills\n- Express genuine enthusiasm to learn and adapt\n- Frame gaps as growth opportunities: \"I am eager to develop my expertise in...\"\n\nREQUIREMENTS:\n1. Be concise (approximately ${coverWordLimit} words)\n2. Address the hiring manager professionally\n3. Highlight 2-3 most relevant qualifications with specific examples FROM THE PROVIDED PROFILE ONLY\n4. Show enthusiasm for the specific role AND for learning/growing\n5. Include a clear call to action\n6. No clich√©s or AI-sounding phrases\n7. Language: Match the job description\n8. MUST end with proper sign-off: \"Kind regards,\" followed by the applicant's full name\n\nSTRUCTURE:\n- Opening: \"Dear Hiring Manager,\" then state the position and express interest (1-2 sentences)\n- Middle (2 paragraphs): Your relevant qualifications and why you're a great fit\n- Closing: Thank them, suggest next steps\n- Sign-off: \"Kind regards,\" + new line + \"${userProfile?.name || '[Your Name]'}\"\n\nReturn ONLY the cover letter content, starting with \"Dear Hiring Manager,\" and ending with the sign-off.`,\n\n    portfolio: `You are a Portfolio Description writer. Create a portfolio summary for this job application.\n\n${baseContext}\n\nREQUIREMENTS:\n1. Highlight 3-5 most relevant projects or achievements\n2. For each project:\n   - Brief description (2-3 sentences)\n   - Technologies/skills used\n   - Measurable impact/results\n3. Tailor selection to the job requirements\n4. Include links placeholders [Project Link] where appropriate\n\nReturn ONLY the portfolio description content.`,\n\n    proposal: `You are a professional Proposal writer. Create a proposal for this job application.\n\n${baseContext}\n\nREQUIREMENTS:\n1. Executive Summary: What you propose to do for them\n2. Understanding: Show you understand their challenges\n3. Approach: How you would tackle the role\n4. Value Proposition: What unique value you bring\n5. Next Steps: Suggest a meeting or discussion\n6. Professional tone, business-focused\n\nReturn ONLY the proposal content.`\n  };\n\n  return prompts[docKey] || prompts['motivation_letter'];\n}\n\n// Build Auditor prompt\nfunction buildAuditorPrompt(docKey: string, docLabel: string, content: string, job: any): string {\n  // Get compatibility score and missing skills from job\n  const compatScore = job.compatibility_score || 0;\n  const missingSkills = job.compatibility_missing_skills ? \n    JSON.parse(job.compatibility_missing_skills) : [];\n  \n  // Determine if this is a \"reach\" job (Yellow or higher) where user wants to apply despite gaps\n  const isReachJob = compatScore >= 26 && compatScore < 76; // Yellow or Green range\n  \n  let flexibilityNote = '';\n  if (isReachJob && missingSkills.length > 0) {\n    flexibilityNote = `\n**SPECIAL NOTE - REACH APPLICATION:**\nThis is a \"reach\" job where the applicant is applying despite some skill gaps. The following skills are listed as requirements but the applicant may not have direct experience:\n- ${missingSkills.slice(0, 5).join('\\n- ')}\n\nFOR THESE CASES:\n- Allow the applicant to highlight TRANSFERABLE skills and RELATED experience\n- Allow honest statements about willingness to learn\n- Do NOT reject simply because the applicant can't claim direct experience with missing skills\n- DO reject if the document FABRICATES experience the applicant doesn't have\n`;\n  }\n  \n  return `You are the \"Auditor\" agent. Your job is to review this ${docLabel} for accuracy, quality, and FACTUAL CORRECTNESS.\n\nJOB: ${job.job_title} at ${job.company_name}\n\nCONTENT TO REVIEW:\n${content}\n${flexibilityNote}\nEVALUATION CRITERIA:\n\n**CRITICAL - HALLUCINATION CHECK:**\n1. FACTUAL ACCURACY: Does the document contain any information that seems fabricated or not from the applicant's actual profile? Look for:\n   - Specific company names, dates, or achievements that seem invented\n   - Metrics or percentages that appear made up (e.g., \"increased sales by 47%\" without context)\n   - Job titles or responsibilities that seem inconsistent\n   - Skills or certifications not typically mentioned together\n2. COMPANY FACTS: Are any company facts stated that could be false? (If unsure, flag as potentially fabricated)\n\n**IMPORTANT - NOT GROUNDS FOR REJECTION:**\n- Soft skills (communication, teamwork, leadership) - these are subjective and acceptable\n- Transferable experience from different but related roles\n- Statements of willingness to learn or grow\n- General industry knowledge without specific metrics\n- Experience in related fields that could transfer to the target role\n\n**FORMAT & QUALITY:**\n3. LANGUAGE: Is it in the same language as the job description?\n4. HUMAN-LIKE: Does it avoid AI clich√©s (thrilled, passionate, fast-paced world)?\n5. NO LONG HYPHENS: Are there any ‚Äî or ‚Äì characters? (Should use - instead)\n6. PROPER GREETING: Does it start with \"Dear Hiring Manager,\" or similar?\n7. PROPER SIGN-OFF: Does it end with \"Kind regards,\" followed by the applicant's name?\n8. ATS FRIENDLY: Is the structure clear and professional?\n9. TAILORED: Does it specifically reference the company or role?\n10. NO PLACEHOLDERS: Are there any \"[Insert...]\", \"XYZ\", or \"N/A\" in critical fields?\n11. LENGTH: Is it appropriate? (Motivation letter: 400-500 words, Cover letter: 250-300 words)\n12. NO JSON/META: Does it start cleanly without JSON formatting or meta-text like \"Here is...\"?\n13. NO APOLOGIES: Does it avoid phrases like \"I could not find\", \"research unavailable\"?\n\nRESPONSE FORMAT:\nIf it passes ALL criteria, respond with exactly: \"APPROVED\"\nIf it fails any criteria (especially FABRICATED facts), respond with: \"REJECTED: \" followed by specific feedback on what to fix.\n\nREMEMBER: Only reject for FABRICATED information or format issues, NOT for skill gaps or experience differences.`;\n}\n\n// Export individual document generator for direct calls\nexport async function generateSingleDocument(\n  jobId: number, \n  userId: number, \n  docType: string, \n  thinker: any, \n  auditor: any, \n  callAI: Function\n): Promise<{ success: boolean; filePath?: string; error?: string }> {\n  const db = getDatabase();\n  const job = db.job_listings?.find((j: any) => j.id === jobId);\n  const userProfile = db.user_profile?.find((p: any) => p.id === userId) || db.user_profile?.[0];\n  \n  if (!job) return { success: false, error: 'Job not found' };\n  if (!userProfile) return { success: false, error: 'User profile not found' };\n  \n  const options: any = {};\n  const typeConfig = DOC_TYPES.find(t => t.key === docType);\n  if (typeConfig) {\n    options[typeConfig.optionKey] = true;\n  }\n  \n  await generateTailoredDocs(job, userId, thinker, auditor, options, callAI);\n  \n  // Refresh job data to get file path\n  const updatedJob = db.job_listings?.find((j: any) => j.id === jobId);\n  const filePath = updatedJob?.[`${docType}_path`];\n  \n  if (filePath) {\n    return { success: true, filePath };\n  }\n  \n  return { success: false, error: 'Document generation failed' };\n}\n","import Imap from 'imap';\nimport { simpleParser } from 'mailparser';\nimport { getAllQuery, logAction, runQuery } from '../database';\n\n/**\n * WAIT FOR AND FETCH LATEST OTP\n * Monitors the inbox for a security code (4-8 digits).\n * Retries every 15 seconds for up to 3 minutes.\n */\nexport async function fetchLatestOTP(userId: number): Promise<string | null> {\n  console.log('Secretary: Monitoring inbox for security code...');\n  await logAction(userId, 'ai_secretary', 'üìß Monitoring inbox for security code...', 'in_progress');\n\n  const configRes = await getAllQuery('SELECT * FROM email_config');\n  const config = configRes[0];\n  \n  if (!config || !config.email_user || !config.email_password || !config.imap_host) {\n    await logAction(userId, 'ai_secretary', '‚ùå Email configuration is missing in Settings', 'failed', false);\n    return null;\n  }\n\n  // Retry logic: check every 15 seconds for up to 12 attempts (3 minutes total)\n  for (let attempt = 0; attempt < 12; attempt++) {\n    const otp = await performImapSearch(config, ['UNSEEN'], (text: string) => {\n      // Regex to match 4 to 8 digit numeric codes\n      const match = text.match(/\\b\\d{4,8}\\b/);\n      return match ? match[0] : null;\n    });\n\n    if (otp) {\n      await logAction(userId, 'ai_secretary', `‚úÖ Security code found: ${otp}`, 'completed', true);\n      return otp;\n    }\n\n    console.log(`Secretary: OTP not found yet (Attempt ${attempt + 1}/12). Waiting 15s...`);\n    await new Promise(resolve => setTimeout(resolve, 15000));\n  }\n\n  await logAction(userId, 'ai_secretary', '‚ùå Timed out waiting for security code after 3 minutes', 'failed', false);\n  return null;\n}\n\n/**\n * MONITOR FOR APPLICATION CONFIRMATIONS\n * Scans for emails indicating a successful submission.\n */\nexport async function monitorConfirmations(userId: number) {\n  const configRes = await getAllQuery('SELECT * FROM email_config');\n  const config = configRes[0];\n  if (!config || !config.email_user || !config.email_password) return;\n\n  const confirmation = await performImapSearch(config, ['UNSEEN'], (text: string, subject: string) => {\n    const keywords = ['application received', 'thank you for applying', 'confirmation', 'received your application'];\n    const combined = (text + ' ' + subject).toLowerCase();\n    \n    if (keywords.some(k => combined.includes(k))) {\n      return { subject, snippet: text.substring(0, 200) };\n    }\n    return null;\n  });\n\n  if (confirmation) {\n    await logAction(userId, 'ai_secretary', `üì¨ Received confirmation: ${confirmation.subject}`, 'completed', true);\n    await runQuery('INSERT INTO email_alerts', {\n      user_id: userId,\n      alert_type: 'confirmation',\n      subject: confirmation.subject,\n      snippet: confirmation.snippet,\n      timestamp: new Date().toISOString()\n    });\n  }\n}\n\n/**\n * INTERNAL HELPER: PERFORM IMAP SEARCH\n */\nasync function performImapSearch(config: any, criteria: any[], extractor: (text: string, subject: string) => any): Promise<any> {\n  return new Promise((resolve) => {\n    const imap = new Imap({\n      user: config.email_user,\n      password: config.email_password,\n      host: config.imap_host,\n      port: config.imap_port || 993,\n      tls: true,\n      tlsOptions: { rejectUnauthorized: false }\n    });\n\n    imap.once('ready', () => {\n      imap.openBox('INBOX', false, (err) => {\n        if (err) {\n          console.error('IMAP: Could not open inbox', err);\n          imap.end();\n          resolve(null);\n          return;\n        }\n        \n        imap.search(criteria, (err, results) => {\n          if (err || !results || results.length === 0) {\n            imap.end();\n            resolve(null);\n            return;\n          }\n          \n          // Fetch the most recent matching message\n          const f = imap.fetch(results[results.length - 1], { bodies: '' });\n          \n          f.on('message', (msg) => {\n            msg.on('body', async (stream: any) => {\n              const parsed: any = await simpleParser(stream);\n              const result = extractor(parsed.text || '', parsed.subject || '');\n              resolve(result);\n            });\n          });\n          \n          f.once('end', () => imap.end());\n        });\n      });\n    });\n\n    imap.once('error', (err) => {\n      console.error('IMAP Connection Error:', err);\n      resolve(null);\n    });\n\n    imap.connect();\n  });\n}","import { getDatabase, runQuery } from '../database';\nimport * as SecretaryService from './secretary-service';\n\n// Global flag to track if scheduler is enabled\nlet schedulerEnabled = false;\n\n/**\n * Enable/disable the scheduler\n */\nexport function setSchedulerEnabled(enabled: boolean) {\n  schedulerEnabled = enabled;\n  console.log(`Scheduler: ${enabled ? 'ENABLED' : 'DISABLED'}`);\n}\n\n/**\n * MAIN SCHEDULER\n * Runs every 60 seconds to check for scheduled tasks.\n * IMPORTANT: Only runs if explicitly enabled via settings\n */\nexport function startHuntingScheduler(userId: number, startHunterSearch: Function, callAI: Function) {\n  return setInterval(async () => {\n    const db = getDatabase();\n    \n    // 1. Check global setting for Job Hunting\n    // CRITICAL: Only proceed if job_hunting_active is explicitly set to 1\n    // This prevents auto-scraping without user consent\n    const settings = db.settings[0];\n    \n    // Double-check: Must have settings AND job_hunting_active must be exactly 1\n    if (!settings || settings.job_hunting_active !== 1) {\n      // Silently skip - don't log every minute to avoid spam\n      return;\n    }\n\n    // Additional safety check: scheduler must be explicitly enabled\n    if (!schedulerEnabled) {\n      console.log('Scheduler: Skipping - not explicitly enabled');\n      return;\n    }\n\n    const websites = db.job_websites.filter((w: any) => w.is_active === 1);\n    const now = new Date();\n    \n    for (const website of websites) {\n      const lastChecked = website.last_checked ? new Date(website.last_checked) : new Date(0);\n      const hoursSinceLastCheck = (now.getTime() - lastChecked.getTime()) / (1000 * 60 * 60);\n      \n      // Career pages check every 24h, others use custom frequency (default 4h)\n      const frequency = website.site_type === 'career_page' ? 24 : (website.check_frequency || 4);\n      \n      if (hoursSinceLastCheck >= frequency) {\n        console.log(`Scheduler: Checking ${website.website_name}...`);\n        await startHunterSearch(userId, callAI);\n        await runQuery('UPDATE job_websites', { id: website.id, last_checked: now.toISOString() });\n      }\n    }\n\n    // 2. Always run Secretary monitoring for confirmations\n    // This runs independently of the job hunting toggle\n    try {\n      await SecretaryService.monitorConfirmations(userId);\n    } catch (e) {\n      console.error('Scheduler: Secretary monitoring failed', e);\n    }\n\n  }, 60000); // Check every minute\n}","import { getDatabase, logAction, runQuery, getAllQuery } from '../database';\nimport puppeteer, { Browser, Page } from 'puppeteer';\nimport path from 'path';\nimport * as fs from 'fs';\nimport * as SecretaryService from './secretary-service';\nlet app: any;\ntry { app = require('electron').app; } catch (e) { app = (global as any).electronApp; }\n\nconst getUserDataDir = () => path.join(app.getPath('userData'), 'browser_data');\nconst getDocsDir = () => path.join(app.getPath('userData'), 'generated_docs');\n\n// Question types that the AI might need to ask\ntype QuestionCategory = 'personal' | 'experience' | 'availability' | 'salary' | 'visa' | 'education' | 'skills' | 'other';\n\ninterface UserQuestion {\n  id: number;\n  job_id?: number;\n  question: string;\n  answer: string;\n  category: QuestionCategory;\n  created_at: string;\n  updated_at: string;\n}\n\ninterface ApplicationState {\n  jobId: number;\n  userId: number;\n  status: 'started' | 'form_filling' | 'questions_pending' | 'uploading' | 'reviewing' | 'submitted' | 'failed';\n  currentStep: string;\n  pendingQuestions: Array<{ field: string; question: string; options?: string[] }>;\n  browser?: Browser;\n  page?: Page;\n}\n\n// Global state for active applications\nconst activeApplications: Map<number, ApplicationState> = new Map();\n\n/**\n * Find similar questions from the Q&A database\n */\nasync function findSimilarAnswer(question: string, category: QuestionCategory): Promise<string | null> {\n  const db = getDatabase();\n  const questions = db.questions || [];\n  \n  // Simple keyword matching (can be enhanced with AI similarity)\n  const questionLower = question.toLowerCase();\n  const keywords = questionLower.split(/\\s+/).filter(w => w.length > 3);\n  \n  for (const q of questions) {\n    if (q.category === category) {\n      const storedLower = q.question.toLowerCase();\n      const matchCount = keywords.filter(k => storedLower.includes(k)).length;\n      if (matchCount >= keywords.length * 0.5) {\n        return q.answer;\n      }\n    }\n  }\n  \n  return null;\n}\n\n/**\n * Save a question-answer pair to the database\n */\nasync function saveQuestionAnswer(\n  question: string, \n  answer: string, \n  category: QuestionCategory,\n  jobId?: number\n): Promise<void> {\n  const db = getDatabase();\n  \n  // Check if similar question exists\n  const existingIndex = db.questions.findIndex((q: any) => \n    q.question.toLowerCase() === question.toLowerCase()\n  );\n  \n  if (existingIndex >= 0) {\n    // Update existing\n    db.questions[existingIndex].answer = answer;\n    db.questions[existingIndex].updated_at = new Date().toISOString();\n  } else {\n    // Add new\n    db.questions.push({\n      id: Date.now(),\n      job_id: jobId,\n      question,\n      answer,\n      category,\n      created_at: new Date().toISOString(),\n      updated_at: new Date().toISOString()\n    });\n  }\n  \n  // Trigger DB save\n  await runQuery('UPDATE settings', { id: 1, last_qa_update: new Date().toISOString() });\n}\n\n/**\n * Get all saved Q&A pairs\n */\nexport async function getAllQuestions(): Promise<UserQuestion[]> {\n  const db = getDatabase();\n  return db.questions || [];\n}\n\n/**\n * Update a Q&A answer\n */\nexport async function updateQuestionAnswer(questionId: number, newAnswer: string): Promise<{ success: boolean }> {\n  const db = getDatabase();\n  const index = db.questions.findIndex((q: any) => q.id === questionId);\n  \n  if (index >= 0) {\n    db.questions[index].answer = newAnswer;\n    db.questions[index].updated_at = new Date().toISOString();\n    await runQuery('UPDATE settings', { id: 1, last_qa_update: new Date().toISOString() });\n    return { success: true };\n  }\n  \n  return { success: false };\n}\n\n/**\n * Delete a Q&A pair\n */\nexport async function deleteQuestion(questionId: number): Promise<{ success: boolean }> {\n  const db = getDatabase();\n  const initialLength = db.questions.length;\n  db.questions = db.questions.filter((q: any) => q.id !== questionId);\n  \n  if (db.questions.length < initialLength) {\n    await runQuery('UPDATE settings', { id: 1, last_qa_update: new Date().toISOString() });\n    return { success: true };\n  }\n  \n  return { success: false };\n}\n\n/**\n * Analyze form fields and determine what information is needed\n */\nasync function analyzeFormFields(page: Page, observerModel: any, callAI: Function): Promise<any[]> {\n  // Take screenshot\n  const screenshot = await page.screenshot({ encoding: 'base64' });\n  \n  // Also get DOM information\n  const formInfo = await page.evaluate(() => {\n    const fields: any[] = [];\n    \n    // Find all input fields\n    document.querySelectorAll('input, select, textarea').forEach((el: any) => {\n      const rect = el.getBoundingClientRect();\n      if (rect.width > 0 && rect.height > 0) {\n        const label = el.labels?.[0]?.textContent || \n                      el.placeholder || \n                      el.name || \n                      el.id ||\n                      el.getAttribute('aria-label') || '';\n        \n        fields.push({\n          type: el.type || el.tagName.toLowerCase(),\n          name: el.name,\n          id: el.id,\n          label: label.trim(),\n          required: el.required,\n          x: rect.left + rect.width / 2,\n          y: rect.top + rect.height / 2,\n          options: el.tagName === 'SELECT' ? Array.from(el.options).map((o: any) => o.text) : undefined\n        });\n      }\n    });\n    \n    // Find file upload buttons\n    document.querySelectorAll('input[type=\"file\"], button[class*=\"upload\"], [data-testid*=\"upload\"]').forEach((el: any) => {\n      const rect = el.getBoundingClientRect();\n      if (rect.width > 0) {\n        fields.push({\n          type: 'file',\n          label: el.textContent?.trim() || 'Upload',\n          x: rect.left + rect.width / 2,\n          y: rect.top + rect.height / 2\n        });\n      }\n    });\n    \n    // Find submit button\n    const submitBtn = document.querySelector('button[type=\"submit\"], input[type=\"submit\"], button[class*=\"submit\"], button:contains(\"Submit\"), button:contains(\"Apply\")');\n    if (submitBtn) {\n      const rect = (submitBtn as HTMLElement).getBoundingClientRect();\n      fields.push({\n        type: 'submit',\n        label: (submitBtn as HTMLElement).textContent?.trim() || 'Submit',\n        x: rect.left + rect.width / 2,\n        y: rect.top + rect.height / 2\n      });\n    }\n    \n    return fields;\n  });\n  \n  // If we have an AI model, enhance with vision\n  if (observerModel && callAI) {\n    try {\n      const prompt = `Analyze this job application form screenshot. Identify all form fields and their purpose.\n      \nReturn a JSON array of objects with:\n- field: field name/purpose (e.g., \"first_name\", \"email\", \"resume_upload\", \"cover_letter\", \"salary_expectation\")\n- type: input type (text, email, file, select, textarea, checkbox, submit)\n- required: true/false\n- x: approximate x coordinate (0-1280)\n- y: approximate y coordinate (0-800)\n- question: if this is a question that needs user input (e.g., \"What are your salary expectations?\")\n- category: personal|experience|availability|salary|visa|education|skills|other\n\nCurrent DOM fields detected: ${JSON.stringify(formInfo.slice(0, 10))}`;\n\n      const response = await callAI(observerModel, prompt, `data:image/png;base64,${screenshot}`);\n      \n      // Try to parse AI response\n      const jsonMatch = response.match(/\\[[\\s\\S]*\\]/);\n      if (jsonMatch) {\n        const aiFields = JSON.parse(jsonMatch[0]);\n        return [...formInfo, ...aiFields.filter((f: any) => !formInfo.find((df: any) => \n          Math.abs(df.x - f.x) < 50 && Math.abs(df.y - f.y) < 50\n        ))];\n      }\n    } catch (e) {\n      console.log('AI field analysis failed, using DOM only');\n    }\n  }\n  \n  return formInfo;\n}\n\n/**\n * Map user profile data to form fields\n */\nfunction mapProfileToField(fieldLabel: string, fieldType: string, userProfile: any): string | null {\n  const label = fieldLabel.toLowerCase();\n  \n  // Name fields\n  if (label.includes('first name') || label === 'firstname' || label === 'vorname') {\n    return userProfile.name?.split(' ')[0] || '';\n  }\n  if (label.includes('last name') || label === 'lastname' || label === 'nachname' || label.includes('surname')) {\n    return userProfile.name?.split(' ').slice(1).join(' ') || '';\n  }\n  if (label.includes('full name') || label === 'name') {\n    return userProfile.name || '';\n  }\n  \n  // Contact fields\n  if (label.includes('email') || label.includes('e-mail')) {\n    return userProfile.email || '';\n  }\n  if (label.includes('phone') || label.includes('tel') || label.includes('mobile')) {\n    return userProfile.phone || '';\n  }\n  \n  // Location fields\n  if (label.includes('city') || label.includes('stadt')) {\n    return userProfile.location?.split(',')[0]?.trim() || '';\n  }\n  if (label.includes('country') || label.includes('land')) {\n    return userProfile.location?.split(',').pop()?.trim() || '';\n  }\n  if (label.includes('address') || label.includes('location') || label.includes('adresse')) {\n    return userProfile.location || '';\n  }\n  \n  // Professional fields\n  if (label.includes('current title') || label.includes('job title') || label.includes('position')) {\n    return userProfile.title || '';\n  }\n  if (label.includes('linkedin')) {\n    return userProfile.linkedin_url || '';\n  }\n  if (label.includes('website') || label.includes('portfolio')) {\n    return userProfile.website || '';\n  }\n  \n  // Summary/About\n  if (label.includes('summary') || label.includes('about') || label.includes('introduction')) {\n    return userProfile.summary || '';\n  }\n  \n  return null;\n}\n\n/**\n * Determine field category for Q&A\n */\nfunction categorizeField(label: string): QuestionCategory {\n  const l = label.toLowerCase();\n  if (l.includes('salary') || l.includes('compensation') || l.includes('gehalt')) return 'salary';\n  if (l.includes('visa') || l.includes('work permit') || l.includes('authorization')) return 'visa';\n  if (l.includes('experience') || l.includes('years') || l.includes('erfahrung')) return 'experience';\n  if (l.includes('education') || l.includes('degree') || l.includes('university')) return 'education';\n  if (l.includes('available') || l.includes('start date') || l.includes('notice')) return 'availability';\n  if (l.includes('skill') || l.includes('proficiency') || l.includes('language')) return 'skills';\n  if (l.includes('name') || l.includes('email') || l.includes('phone') || l.includes('address')) return 'personal';\n  return 'other';\n}\n\n/**\n * Main application submission function\n */\nexport async function submitApplication(\n  jobId: number, \n  userId: number, \n  observerModel: any, \n  callAI: Function\n): Promise<{ success: boolean; status: string; pendingQuestions?: any[]; error?: string }> {\n  \n  console.log(`\\n========== SMART APPLICATION SUBMISSION FOR JOB ${jobId} ==========`);\n  \n  let browser: Browser | null = null;\n  \n  try {\n    const db = getDatabase();\n    const job = db.job_listings.find((j: any) => j.id === jobId);\n    const userProfile = db.user_profile.find((p: any) => p.id === userId) || db.user_profile[0];\n    \n    if (!job) {\n      return { success: false, status: 'failed', error: 'Job not found' };\n    }\n    \n    if (!userProfile) {\n      return { success: false, status: 'failed', error: 'User profile not found. Please create your profile first.' };\n    }\n    \n    const applicationUrl = job.application_url || job.url;\n    if (!applicationUrl) {\n      return { success: false, status: 'failed', error: 'No application URL found' };\n    }\n    \n    await logAction(userId, 'ai_applicant', `üöÄ Starting smart application for ${job.company_name}`, 'in_progress');\n    \n    // Initialize application state\n    const appState: ApplicationState = {\n      jobId,\n      userId,\n      status: 'started',\n      currentStep: 'Opening application page',\n      pendingQuestions: []\n    };\n    activeApplications.set(jobId, appState);\n    \n    // Launch browser\n    browser = await puppeteer.launch({\n      headless: false,\n      userDataDir: getUserDataDir(),\n      args: ['--no-sandbox', '--start-maximized', '--disable-blink-features=AutomationControlled']\n    });\n    \n    const page = await browser.newPage();\n    await page.setViewport({ width: 1280, height: 800 });\n    await page.setUserAgent('Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36');\n    \n    // Hide webdriver\n    await page.evaluateOnNewDocument(() => {\n      Object.defineProperty(navigator, 'webdriver', { get: () => false });\n      Object.defineProperty(navigator, 'plugins', { get: () => [1, 2, 3, 4, 5] });\n    });\n    \n    appState.browser = browser;\n    appState.page = page;\n    \n    // Navigate to application\n    await logAction(userId, 'ai_applicant', `üìÑ Opening: ${applicationUrl}`, 'in_progress');\n    await page.goto(applicationUrl, { waitUntil: 'networkidle2', timeout: 60000 });\n    \n    // Random delay\n    await new Promise(r => setTimeout(r, 2000 + Math.random() * 2000));\n    \n    // Check if we need to login/register\n    const needsAuth = await checkIfNeedsAuthentication(page);\n    \n    if (needsAuth.needsLogin) {\n      await logAction(userId, 'ai_applicant', 'üîë Login required. Attempting to login...', 'in_progress');\n      const loginResult = await handleLogin(page, userId, userProfile, callAI);\n      \n      if (!loginResult.success) {\n        if (loginResult.needsRegistration) {\n          await logAction(userId, 'ai_applicant', 'üìù Registration required...', 'in_progress');\n          const regResult = await handleRegistration(page, userId, userProfile, callAI);\n          \n          if (!regResult.success) {\n            return { success: false, status: 'failed', error: 'Registration failed: ' + regResult.error };\n          }\n        } else {\n          return { success: false, status: 'failed', error: 'Login failed: ' + loginResult.error };\n        }\n      }\n    }\n    \n    // Start form filling\n    appState.status = 'form_filling';\n    await logAction(userId, 'ai_applicant', 'üìù Analyzing application form...', 'in_progress');\n    \n    // Analyze form fields\n    const formFields = await analyzeFormFields(page, observerModel, callAI);\n    console.log(`Found ${formFields.length} form fields`);\n    \n    const pendingQuestions: any[] = [];\n    \n    // Process each field\n    for (const field of formFields) {\n      if (field.type === 'submit') continue;\n      \n      // Try to get value from profile\n      let value = mapProfileToField(field.label, field.type, userProfile);\n      \n      // If no direct mapping, check Q&A database\n      if (!value && field.label) {\n        const category = categorizeField(field.label);\n        value = await findSimilarAnswer(field.label, category);\n        \n        if (value) {\n          await logAction(userId, 'ai_applicant', `üí° Found answer from Q&A database for \"${field.label}\"`, 'in_progress');\n        }\n      }\n      \n      // Handle file uploads\n      if (field.type === 'file') {\n        const uploadResult = await handleFileUpload(page, field, jobId, userId);\n        if (!uploadResult.success) {\n          await logAction(userId, 'ai_applicant', `‚ö†Ô∏è File upload issue: ${uploadResult.error}`, 'in_progress');\n        }\n        continue;\n      }\n      \n      // If we have a value, fill it\n      if (value) {\n        await fillField(page, field, value);\n        await logAction(userId, 'ai_applicant', `‚úì Filled: ${field.label}`, 'in_progress');\n        await new Promise(r => setTimeout(r, 300 + Math.random() * 500));\n      } else if (field.required || field.question) {\n        // Need user input for this field\n        const category = categorizeField(field.label);\n        pendingQuestions.push({\n          field: field.name || field.id || field.label,\n          label: field.label,\n          question: field.question || `What is your ${field.label}?`,\n          type: field.type,\n          category,\n          options: field.options,\n          x: field.x,\n          y: field.y\n        });\n      }\n    }\n    \n    // If we have pending questions, return them\n    if (pendingQuestions.length > 0) {\n      appState.status = 'questions_pending';\n      appState.pendingQuestions = pendingQuestions;\n      \n      await logAction(userId, 'ai_applicant', `‚ùì ${pendingQuestions.length} questions need your input`, 'in_progress');\n      \n      // Save state and return\n      return {\n        success: true,\n        status: 'questions_pending',\n        pendingQuestions\n      };\n    }\n    \n    // All fields filled, proceed to upload documents\n    appState.status = 'uploading';\n    await logAction(userId, 'ai_applicant', 'üìé Uploading application documents...', 'in_progress');\n    \n    // Final review before submission\n    appState.status = 'reviewing';\n    await logAction(userId, 'ai_applicant', 'üîç Final review before submission...', 'in_progress');\n    \n    // Take screenshot for user review\n    const reviewScreenshot = await page.screenshot({ encoding: 'base64' });\n    \n    // Submit application\n    const submitBtn = formFields.find(f => f.type === 'submit');\n    if (submitBtn) {\n      await page.mouse.click(submitBtn.x, submitBtn.y);\n      await new Promise(r => setTimeout(r, 3000));\n      \n      // Check for success indicators\n      const pageText = await page.evaluate(() => document.body.innerText.toLowerCase());\n      const isSuccess = pageText.includes('thank you') || \n                       pageText.includes('submitted') || \n                       pageText.includes('application received') ||\n                       pageText.includes('erfolgreich');\n      \n      if (isSuccess) {\n        appState.status = 'submitted';\n        await logAction(userId, 'ai_applicant', `‚úÖ Application submitted successfully to ${job.company_name}!`, 'completed', true);\n        await runQuery('UPDATE job_listings', { id: jobId, status: 'applied' });\n        \n        // Start monitoring for confirmation email\n        SecretaryService.monitorConfirmations(userId).catch(console.error);\n        \n        return { success: true, status: 'submitted' };\n      }\n    }\n    \n    // If we got here without clear success, ask for user review\n    return {\n      success: true,\n      status: 'review_needed',\n      pendingQuestions: [{\n        field: 'manual_submit',\n        question: 'Please review the form and click Submit manually. The form appears ready.',\n        type: 'action'\n      }]\n    };\n    \n  } catch (error: any) {\n    console.error('Application submission error:', error);\n    await logAction(userId, 'ai_applicant', `‚ùå Application failed: ${error.message}`, 'failed', false);\n    return { success: false, status: 'failed', error: error.message };\n    \n  } finally {\n    // Don't close browser immediately - user might need to review\n    setTimeout(async () => {\n      if (browser && activeApplications.get(jobId)?.status === 'submitted') {\n        await browser.close();\n        activeApplications.delete(jobId);\n      }\n    }, 30000);\n  }\n}\n\n/**\n * Continue application after user answers questions\n */\nexport async function continueApplicationWithAnswers(\n  jobId: number,\n  userId: number,\n  answers: Array<{ field: string; answer: string; saveForLater: boolean }>\n): Promise<{ success: boolean; status: string; error?: string }> {\n  \n  const appState = activeApplications.get(jobId);\n  \n  if (!appState || !appState.page) {\n    return { success: false, status: 'failed', error: 'Application session expired. Please start again.' };\n  }\n  \n  try {\n    const page = appState.page;\n    \n    // Fill in the answers\n    for (const ans of answers) {\n      const pendingQ = appState.pendingQuestions.find(q => q.field === ans.field);\n      \n      if (pendingQ) {\n        await fillField(page, pendingQ, ans.answer);\n        await new Promise(r => setTimeout(r, 300 + Math.random() * 500));\n        \n        // Save to Q&A database if requested\n        if (ans.saveForLater) {\n          await saveQuestionAnswer(\n            pendingQ.question || pendingQ.label,\n            ans.answer,\n            pendingQ.category || 'other',\n            jobId\n          );\n          await logAction(userId, 'ai_applicant', `üíæ Saved answer for future use: \"${pendingQ.label}\"`, 'in_progress');\n        }\n      }\n    }\n    \n    // Clear pending questions\n    appState.pendingQuestions = [];\n    \n    // Re-analyze form to check if more questions are needed\n    const db = getDatabase();\n    const models = await getAllQuery('SELECT * FROM ai_models');\n    const observer = models.find((m: any) => m.role === 'Observer' && m.status === 'active');\n    \n    // Continue with submission\n    return await submitApplication(jobId, userId, observer, (global as any).callAI);\n    \n  } catch (error: any) {\n    return { success: false, status: 'failed', error: error.message };\n  }\n}\n\n/**\n * Check if page requires authentication\n */\nasync function checkIfNeedsAuthentication(page: Page): Promise<{ needsLogin: boolean; needsRegistration?: boolean }> {\n  const url = page.url().toLowerCase();\n  const pageText = await page.evaluate(() => document.body.innerText.toLowerCase());\n  \n  const loginIndicators = ['sign in', 'log in', 'login', 'anmelden', 'einloggen'];\n  const registerIndicators = ['sign up', 'register', 'create account', 'registrieren'];\n  \n  const needsLogin = loginIndicators.some(i => url.includes(i) || pageText.includes(i));\n  const needsRegistration = registerIndicators.some(i => pageText.includes(i));\n  \n  return { needsLogin, needsRegistration };\n}\n\n/**\n * Handle login process\n */\nasync function handleLogin(\n  page: Page, \n  userId: number, \n  userProfile: any,\n  callAI: Function\n): Promise<{ success: boolean; needsRegistration?: boolean; error?: string }> {\n  \n  try {\n    // Look for email/username and password fields\n    const emailField = await page.$('input[type=\"email\"], input[name*=\"email\"], input[name*=\"user\"], input[id*=\"email\"]');\n    const passwordField = await page.$('input[type=\"password\"]');\n    \n    if (emailField && passwordField) {\n      // Try to use stored credentials or profile email\n      await emailField.type(userProfile.email || '', { delay: 50 + Math.random() * 50 });\n      \n      // For password, we need to ask user or use stored credential\n      // For now, indicate that login is needed\n      await logAction(userId, 'ai_applicant', 'üîë Please enter your password to continue', 'in_progress');\n      \n      return { success: false, error: 'Password required. Please login manually in the browser window.' };\n    }\n    \n    return { success: false, needsRegistration: true };\n    \n  } catch (error: any) {\n    return { success: false, error: error.message };\n  }\n}\n\n/**\n * Handle registration process\n */\nasync function handleRegistration(\n  page: Page,\n  userId: number,\n  userProfile: any,\n  callAI: Function\n): Promise<{ success: boolean; error?: string }> {\n  \n  try {\n    await logAction(userId, 'ai_applicant', 'üìù Attempting automatic registration...', 'in_progress');\n    \n    // Find registration form fields\n    const fields = await page.$$eval('input, select', (inputs: any[]) => \n      inputs.map(input => ({\n        type: input.type,\n        name: input.name,\n        id: input.id,\n        placeholder: input.placeholder\n      }))\n    );\n    \n    // Fill in registration fields\n    for (const field of fields) {\n      const selector = field.id ? `#${field.id}` : `[name=\"${field.name}\"]`;\n      \n      if (field.type === 'email' || field.name?.includes('email')) {\n        await page.type(selector, userProfile.email || '');\n      } else if (field.name?.includes('first') || field.name?.includes('vorname')) {\n        await page.type(selector, userProfile.name?.split(' ')[0] || '');\n      } else if (field.name?.includes('last') || field.name?.includes('nachname')) {\n        await page.type(selector, userProfile.name?.split(' ').slice(1).join(' ') || '');\n      }\n      \n      await new Promise(r => setTimeout(r, 200 + Math.random() * 300));\n    }\n    \n    // Password field - generate or ask user\n    const passwordField = await page.$('input[type=\"password\"]');\n    if (passwordField) {\n      await logAction(userId, 'ai_applicant', 'üîê Please create a password in the browser window', 'in_progress');\n      return { success: false, error: 'Please complete registration manually and create a password.' };\n    }\n    \n    return { success: true };\n    \n  } catch (error: any) {\n    return { success: false, error: error.message };\n  }\n}\n\n/**\n * Fill a form field with a value\n */\nasync function fillField(page: Page, field: any, value: string): Promise<void> {\n  try {\n    // Try multiple selector strategies\n    let selector = '';\n    if (field.id) selector = `#${field.id}`;\n    else if (field.name) selector = `[name=\"${field.name}\"]`;\n    else if (field.x && field.y) {\n      // Click by coordinates\n      await page.mouse.click(field.x, field.y);\n      await page.keyboard.type(value, { delay: 30 + Math.random() * 50 });\n      return;\n    }\n    \n    if (selector) {\n      const element = await page.$(selector);\n      if (element) {\n        await element.click();\n        await element.type(value, { delay: 30 + Math.random() * 50 });\n      }\n    }\n  } catch (e) {\n    console.log(`Could not fill field: ${field.label || field.name}`);\n  }\n}\n\n/**\n * Handle file upload\n */\nasync function handleFileUpload(\n  page: Page, \n  field: any, \n  jobId: number,\n  userId: number\n): Promise<{ success: boolean; error?: string }> {\n  \n  try {\n    const db = getDatabase();\n    const job = db.job_listings.find((j: any) => j.id === jobId);\n    \n    // Determine which file to upload based on field label\n    const label = (field.label || '').toLowerCase();\n    let docPath = '';\n    \n    if (label.includes('cv') || label.includes('resume') || label.includes('lebenslauf')) {\n      docPath = job?.cv_path;\n    } else if (label.includes('cover') || label.includes('anschreiben')) {\n      docPath = job?.cover_letter_path;\n    } else if (label.includes('motivation')) {\n      docPath = job?.motivation_letter_path;\n    } else if (label.includes('portfolio')) {\n      docPath = job?.portfolio_path;\n    }\n    \n    if (!docPath || !fs.existsSync(docPath)) {\n      // Check for PDF version\n      const pdfPath = docPath?.replace('.html', '.pdf');\n      if (pdfPath && fs.existsSync(pdfPath)) {\n        docPath = pdfPath;\n      } else {\n        return { success: false, error: `Document not found: ${label}` };\n      }\n    }\n    \n    // Find file input\n    const fileInput = await page.$('input[type=\"file\"]');\n    if (fileInput) {\n      const [fileChooser] = await Promise.all([\n        page.waitForFileChooser(),\n        field.x && field.y ? page.mouse.click(field.x, field.y) : fileInput.click()\n      ]);\n      \n      await fileChooser.accept([docPath]);\n      await logAction(userId, 'ai_applicant', `üìé Uploaded: ${path.basename(docPath)}`, 'in_progress');\n      return { success: true };\n    }\n    \n    return { success: false, error: 'No file input found' };\n    \n  } catch (error: any) {\n    return { success: false, error: error.message };\n  }\n}\n\n/**\n * Cancel an active application\n */\nexport async function cancelApplication(jobId: number): Promise<void> {\n  const appState = activeApplications.get(jobId);\n  if (appState?.browser) {\n    await appState.browser.close();\n  }\n  activeApplications.delete(jobId);\n}\n","import puppeteer from 'puppeteer';\nimport * as fs from 'fs';\nimport * as path from 'path';\nimport { logAction, getDatabase } from '../database';\nlet app: any;\ntry { app = require('electron').app; } catch (e) { app = (global as any).electronApp; }\n\nconst getDocsDir = () => {\n  const docsPath = path.join(app.getPath('userData'), 'generated_docs');\n  if (!fs.existsSync(docsPath)) {\n    fs.mkdirSync(docsPath, { recursive: true });\n  }\n  return docsPath;\n};\n\n/**\n * Convert HTML file to PDF\n */\nexport async function convertHtmlToPdf(htmlPath: string, userId: number): Promise<{ success: boolean; pdfPath?: string; error?: string }> {\n  let browser: any = null;\n  \n  try {\n    await logAction(userId, 'pdf', `üìÑ Converting to PDF: ${path.basename(htmlPath)}`, 'in_progress');\n    \n    // Read HTML content\n    if (!fs.existsSync(htmlPath)) {\n      return { success: false, error: 'HTML file not found' };\n    }\n    \n    const htmlContent = fs.readFileSync(htmlPath, 'utf-8');\n    \n    // Launch browser for PDF generation\n    browser = await puppeteer.launch({\n      headless: true,\n      args: ['--no-sandbox', '--disable-setuid-sandbox']\n    });\n    \n    const page = await browser.newPage();\n    \n    // Set content\n    await page.setContent(htmlContent, { waitUntil: 'networkidle0' });\n    \n    // Wait for fonts to load\n    await page.evaluateHandle('document.fonts.ready');\n    \n    // Generate PDF\n    const pdfPath = htmlPath.replace('.html', '.pdf');\n    \n    await page.pdf({\n      path: pdfPath,\n      format: 'A4',\n      printBackground: true,\n      margin: {\n        top: '20mm',\n        right: '15mm',\n        bottom: '20mm',\n        left: '15mm'\n      }\n    });\n    \n    await browser.close();\n    \n    await logAction(userId, 'pdf', `‚úÖ PDF created: ${path.basename(pdfPath)}`, 'completed', true);\n    \n    return { success: true, pdfPath };\n    \n  } catch (error: any) {\n    console.error('PDF conversion error:', error);\n    if (browser) await browser.close();\n    await logAction(userId, 'pdf', `‚ùå PDF conversion failed: ${error.message}`, 'failed', false);\n    return { success: false, error: error.message };\n  }\n}\n\n/**\n * Convert all HTML documents for a job to PDF\n */\nexport async function convertAllJobDocsToPdf(jobId: number, userId: number): Promise<{ success: boolean; pdfs: string[]; errors: string[] }> {\n  const db = getDatabase();\n  const job = db.job_listings?.find((j: any) => j.id === jobId);\n  \n  if (!job) {\n    return { success: false, pdfs: [], errors: ['Job not found'] };\n  }\n  \n  const docTypes = ['cv', 'motivation_letter', 'cover_letter', 'portfolio', 'proposal'];\n  const pdfs: string[] = [];\n  const errors: string[] = [];\n  \n  for (const docType of docTypes) {\n    const htmlPath = job[`${docType}_path`];\n    if (htmlPath && fs.existsSync(htmlPath)) {\n      const result = await convertHtmlToPdf(htmlPath, userId);\n      if (result.success && result.pdfPath) {\n        pdfs.push(result.pdfPath);\n      } else if (result.error) {\n        errors.push(`${docType}: ${result.error}`);\n      }\n    }\n  }\n  \n  return { success: pdfs.length > 0, pdfs, errors };\n}\n\n/**\n * Generate PDF directly from content (without saving HTML first)\n */\nexport async function generatePdfFromContent(\n  content: string, \n  fileName: string, \n  userId: number,\n  options?: {\n    title?: string;\n    headerName?: string;\n    headerTitle?: string;\n    headerContact?: string;\n  }\n): Promise<{ success: boolean; pdfPath?: string; error?: string }> {\n  let browser: any = null;\n  \n  try {\n    const htmlContent = `<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n  <meta charset=\"UTF-8\">\n  <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n  <title>${options?.title || 'Document'}</title>\n  <style>\n    @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');\n    \n    * { margin: 0; padding: 0; box-sizing: border-box; }\n    \n    body {\n      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;\n      line-height: 1.6;\n      color: #1a1a1a;\n      padding: 0;\n      background: #fff;\n    }\n    \n    .header {\n      margin-bottom: 25px;\n      padding-bottom: 15px;\n      border-bottom: 2px solid #0077b5;\n    }\n    \n    .name {\n      font-size: 24px;\n      font-weight: 700;\n      color: #0077b5;\n      margin-bottom: 3px;\n    }\n    \n    .title {\n      font-size: 14px;\n      color: #666;\n      margin-bottom: 5px;\n    }\n    \n    .contact {\n      font-size: 11px;\n      color: #444;\n    }\n    \n    .content {\n      font-size: 12px;\n      text-align: justify;\n      white-space: pre-wrap;\n      line-height: 1.7;\n    }\n    \n    .content p {\n      margin-bottom: 10px;\n    }\n    \n    @page {\n      size: A4;\n      margin: 20mm 15mm;\n    }\n  </style>\n</head>\n<body>\n  ${options?.headerName ? `\n  <div class=\"header\">\n    <div class=\"name\">${options.headerName}</div>\n    ${options.headerTitle ? `<div class=\"title\">${options.headerTitle}</div>` : ''}\n    ${options.headerContact ? `<div class=\"contact\">${options.headerContact}</div>` : ''}\n  </div>\n  ` : ''}\n  \n  <div class=\"content\">${content.replace(/\\n/g, '<br>')}</div>\n</body>\n</html>`;\n    \n    browser = await puppeteer.launch({\n      headless: true,\n      args: ['--no-sandbox', '--disable-setuid-sandbox']\n    });\n    \n    const page = await browser.newPage();\n    await page.setContent(htmlContent, { waitUntil: 'networkidle0' });\n    await page.evaluateHandle('document.fonts.ready');\n    \n    const pdfPath = path.join(getDocsDir(), `${fileName}.pdf`);\n    \n    await page.pdf({\n      path: pdfPath,\n      format: 'A4',\n      printBackground: true,\n      margin: { top: '20mm', right: '15mm', bottom: '20mm', left: '15mm' }\n    });\n    \n    await browser.close();\n    \n    await logAction(userId, 'pdf', `‚úÖ PDF generated: ${fileName}.pdf`, 'completed', true);\n    return { success: true, pdfPath };\n    \n  } catch (error: any) {\n    if (browser) await browser.close();\n    return { success: false, error: error.message };\n  }\n}\n","import { app, BrowserWindow, Menu, MenuItem } from 'electron';\nimport path from 'path';\nimport isDev from 'electron-is-dev';\nimport { initializeDatabase } from './src/main/database';\nimport { setupIpcHandlers } from './src/main/ipc-handlers';\n\n// FIX: Resolve GPU process crashes on Windows\napp.disableHardwareAcceleration();\n\n// FIX: Prevent multiple instances\nconst gotTheLock = app.requestSingleInstanceLock();\nif (!gotTheLock) {\n  app.quit();\n}\n\nlet mainWindow: BrowserWindow | null = null;\n\nfunction createWindow() {\n  mainWindow = new BrowserWindow({\n    width: 1400,\n    height: 900,\n    minWidth: 1000,\n    minHeight: 700,\n    webPreferences: {\n      preload: path.join(__dirname, \"preload.cjs\"),\n      contextIsolation: true,\n      nodeIntegration: false\n    },\n  });\n\n  const startUrl = isDev ? 'http://localhost:5173' : `file://${path.join(__dirname, '../dist/index.html')}`;\n  mainWindow.loadURL(startUrl);\n\n  if (isDev) mainWindow.webContents.openDevTools();\n\n  mainWindow.webContents.on('context-menu', (event, params) => {\n    const menu = new Menu();\n    menu.append(new MenuItem({ label: 'Cut', role: 'cut', enabled: params.editFlags.canCut }));\n    menu.append(new MenuItem({ label: 'Copy', role: 'copy', enabled: params.editFlags.canCopy }));\n    menu.append(new MenuItem({ label: 'Paste', role: 'paste', enabled: params.editFlags.canPaste }));\n    menu.append(new MenuItem({ type: 'separator' }));\n    menu.append(new MenuItem({ label: 'Select All', role: 'selectAll', enabled: params.editFlags.canSelectAll }));\n    menu.popup({ window: mainWindow! });\n  });\n\n  mainWindow.on('closed', () => { mainWindow = null; });\n}\n\napp.on('ready', async () => {\n  await initializeDatabase();\n  setupIpcHandlers();\n  createWindow();\n});\n\napp.on('window-all-closed', () => { if (process.platform !== 'darwin') app.quit(); });\n\napp.on('second-instance', () => {\n  if (mainWindow) {\n    if (mainWindow.isMinimized()) mainWindow.restore();\n    mainWindow.focus();\n  }\n});","import { ipcMain } from 'electron';\n\n// Import all handler registrations\nimport { registerSettingsHandlers } from './settings-handlers';\nimport { registerUserHandlers } from './user-handlers';\nimport { registerProfilesHandlers } from './profiles-handlers';\nimport { registerJobsHandlers } from './jobs-handlers';\nimport { registerAIHandlers } from './ai-handlers';\nimport { registerDocsHandlers } from './docs-handlers';\nimport { registerWebsitesHandlers } from './websites-handlers';\nimport { registerAIModelsHandlers } from './ai-models-handlers';\nimport { registerSystemHandlers } from './system-handlers';\nimport { registerServicesHandlers } from './services-handlers';\n\n/**\n * Setup all IPC handlers for the application.\n * This is the main entry point for IPC handler registration.\n */\nexport function setupIpcHandlers(): void {\n  // Collect all channel names for cleanup\n  const allChannels: string[] = [];\n\n  // Register each handler module and collect channels\n  const handlerModules = [\n    registerSettingsHandlers,\n    registerUserHandlers,\n    registerProfilesHandlers,\n    registerJobsHandlers,\n    registerAIHandlers,\n    registerDocsHandlers,\n    registerWebsitesHandlers,\n    registerAIModelsHandlers,\n    registerSystemHandlers,\n    registerServicesHandlers\n  ];\n\n  // First, remove any existing handlers to prevent duplication on hot reload\n  const knownChannels = [\n    'settings:get', 'settings:update', 'user:get-profile', 'user:update-profile',\n    'user:open-linkedin', 'user:capture-linkedin', 'user:save-linkedin-profile',\n    'profiles:get-all', 'profiles:save', 'profiles:update', 'profiles:delete',\n    'jobs:get-all', 'jobs:delete', 'jobs:add-manual', 'jobs:update-doc-confirmation',\n    'hunter:start-search', 'hunter:cancel-search', 'ai:process-application', 'ai:generate-tailored-docs',\n    'ai:smart-apply', 'ai:continue-application', 'ai:cancel-application',\n    'ai:fetch-models', 'ai:test-model', 'ai:generate-interview-prep', 'ai:ask-custom-question', 'ai:ask-about-cv',\n    'docs:get-all', 'docs:save', 'docs:delete', 'docs:open-file', 'docs:convert-to-pdf', \n    'docs:convert-all-pdf', 'docs:reprocess',\n    'websites:get-all', 'websites:add', 'websites:delete', 'websites:toggle-active',\n    'ai-models:get-all', 'ai-models:add', 'ai-models:update', 'ai-models:delete',\n    'logs:get-recent-actions', 'apps:get-all',\n    'scheduler:toggle', 'scheduler:get-status',\n    'qa:get-all', 'qa:update', 'qa:delete',\n    'email:test-config', 'email:send', 'email:send-notification', 'email:test-inbox', 'email:fetch-inbox', 'email:oauth-start', 'email:oauth-callback', 'email:oauth-test',\n    'compatibility:calculate', 'compatibility:calculate-all', 'compatibility:get-by-level',\n    'secretary:setup-pin', 'secretary:verify-pin', 'secretary:change-pin', \n    'secretary:reset-pin', 'secretary:is-pin-set', 'secretary:get-settings', 'secretary:update-permissions'\n  ];\n\n  // Remove existing handlers\n  knownChannels.forEach(channel => {\n    try { \n      ipcMain.removeHandler(channel); \n    } catch (e) { \n      /* ignore if not exists */ \n    }\n  });\n\n  // Register all handlers\n  handlerModules.forEach(registerFn => {\n    const channels = registerFn();\n    allChannels.push(...channels);\n  });\n\n  console.log(`‚úÖ IPC Handlers registered successfully (${allChannels.length} channels)`);\n  console.log('   Handler modules loaded: settings, user, profiles, jobs, ai, docs, websites, ai-models, system, services');\n}\n","import { ipcMain } from 'electron';\nimport { runQuery, getAllQuery, getDatabase } from '../database';\n\nexport function registerSettingsHandlers(): string[] {\n  const channels = ['settings:get', 'settings:update'];\n\n  // --- SETTINGS ---\n  ipcMain.handle('settings:get', async () => {\n    try {\n      const data = await getAllQuery('SELECT * FROM settings');\n      return { success: true, data: data[0] || null };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('settings:update', async (_, data) => {\n    try {\n      await runQuery('UPDATE settings', data);\n      return { success: true };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  return channels;\n}\n","import { ipcMain, shell, BrowserWindow, session } from 'electron';\nimport { runQuery, getAllQuery, getDatabase } from '../database';\nimport path from 'path';\nlet app: any;\ntry { app = require('electron').app; } catch (e) { app = (global as any).electronApp; }\n\nexport function registerUserHandlers(): string[] {\n  const channels = [\n    'user:get-profile', \n    'user:update-profile',\n    'user:open-linkedin', \n    'user:capture-linkedin', \n    'user:save-linkedin-profile',\n    'user:open-linkedin-login'\n  ];\n\n  // --- USER PROFILE ---\n  ipcMain.handle('user:get-profile', async () => {\n    try {\n      const data = await getAllQuery('SELECT * FROM user_profile');\n      return { success: true, data: data[0] || null };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('user:update-profile', async (_, data) => {\n    try {\n      const db = getDatabase();\n      if (db.user_profile.length > 0) {\n        await runQuery('UPDATE user_profile', { ...data, id: db.user_profile[0].id });\n      } else {\n        await runQuery('INSERT INTO user_profile', [{ ...data, id: 1 }]);\n      }\n      return { success: true };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  // --- LINKEDIN HELPERS ---\n  ipcMain.handle('user:open-linkedin', async (_, url) => {\n    try {\n      const linkedinUrl = url || 'https://www.linkedin.com/in/';\n      await shell.openExternal(linkedinUrl);\n      return { success: true };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  // Open LinkedIn login using Puppeteer with persistent session\n  ipcMain.handle('user:open-linkedin-login', async (_, data) => {\n    try {\n      const LinkedInScraper = require('../features/linkedin-scraper');\n      const userId = data?.userId || 1;\n      \n      // Use the shared browser session from linkedin-scraper\n      const result = await LinkedInScraper.openLinkedInForLogin(userId);\n      return result;\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('user:capture-linkedin', async (_, data) => {\n    try {\n      const LinkedInScraper = require('../features/linkedin-scraper');\n      const { userId, profileUrl } = data || {};\n      \n      // If no profileUrl, this is a request to open browser for login\n      if (!profileUrl && !data?.profileUrl) {\n        // Check if we should open login or just scrape\n        // For scraping, always try to scrape with the persistent session\n        return await LinkedInScraper.scrapeLinkedInProfile(userId || 1, null);\n      }\n      \n      return await LinkedInScraper.scrapeLinkedInProfile(userId || 1, profileUrl);\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('user:save-linkedin-profile', async (_, data) => {\n    try {\n      const LinkedInScraper = require('../features/linkedin-scraper');\n      return await LinkedInScraper.saveLinkedInProfile(data.userId, data.profileData);\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  return channels;\n}\n","import { ipcMain } from 'electron';\nimport { runQuery, getAllQuery } from '../database';\n\nexport function registerProfilesHandlers(): string[] {\n  const channels = ['profiles:get-all', 'profiles:save', 'profiles:update', 'profiles:delete'];\n\n  // --- SEARCH PROFILES ---\n  ipcMain.handle('profiles:get-all', async () => {\n    try {\n      const data = await getAllQuery('SELECT * FROM search_profiles');\n      return { success: true, data };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('profiles:save', async (_, data) => {\n    try {\n      const result = await runQuery('INSERT INTO search_profiles', [data]);\n      return { success: true, id: result.id };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('profiles:update', async (_, data) => {\n    try {\n      await runQuery('UPDATE search_profiles', data);\n      return { success: true };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('profiles:delete', async (_, id) => {\n    try {\n      await runQuery('DELETE FROM search_profiles', { id });\n      return { success: true };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  return channels;\n}\n","import { ipcMain } from 'electron';\nimport { runQuery, getAllQuery, getDatabase } from '../database';\nimport * as aiService from '../ai-service';\n\nexport function registerJobsHandlers(): string[] {\n  const channels = [\n    'jobs:get-all', \n    'jobs:delete', \n    'jobs:add-manual', \n    'jobs:update-doc-confirmation',\n    'jobs:archive',\n    'jobs:clear-old'\n  ];\n\n  // --- JOBS ---\n  ipcMain.handle('jobs:get-all', async () => {\n    try {\n      const data = await getAllQuery('SELECT * FROM job_listings');\n      return { success: true, data };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('jobs:delete', async (_, id) => {\n    try {\n      const deleteId = typeof id === 'object' ? id.id : id;\n      await runQuery('DELETE FROM job_listings', { id: deleteId });\n      return { success: true };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('jobs:add-manual', async (_, data) => {\n    try {\n      const result = await runQuery('INSERT INTO job_listings', { \n        ...data, \n        source: 'Manual', \n        status: 'analyzing' \n      });\n      // Start analysis in background\n      aiService.analyzeJobUrl(result.id, data.userId, data.url).catch(console.error);\n      return { success: true, id: result.id };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('jobs:update-doc-confirmation', async (_, data) => {\n    try {\n      await runQuery('UPDATE job_listings', { \n        id: data.jobId, \n        user_confirmed_docs: data.confirmed \n      });\n      return { success: true };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  // Archive/Unarchive a job\n  ipcMain.handle('jobs:archive', async (_, data) => {\n    try {\n      await runQuery('UPDATE job_listings', { \n        id: data.jobId, \n        archived: data.archived \n      });\n      return { success: true };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  // Clear old/expired jobs (archive them in bulk)\n  ipcMain.handle('jobs:clear-old', async (_, data) => {\n    try {\n      const { daysOld = 14 } = data || {};\n      const db = getDatabase();\n      const jobs = db.job_listings || [];\n      \n      const cutoffDate = new Date();\n      cutoffDate.setDate(cutoffDate.getDate() - daysOld);\n      \n      let archivedCount = 0;\n      \n      for (const job of jobs) {\n        // Skip already archived or applied jobs\n        if (job.archived === 1 || job.status === 'applied') continue;\n        \n        let shouldArchive = false;\n        \n        // Check if deadline has passed\n        if (job.deadline) {\n          const deadline = new Date(job.deadline);\n          if (deadline < new Date()) shouldArchive = true;\n        }\n        \n        // Check if posted date is older than cutoff\n        if (job.posted_date) {\n          const postedDate = new Date(job.posted_date);\n          if (postedDate < cutoffDate) shouldArchive = true;\n        }\n        \n        // Check if imported older than cutoff and not applied\n        if (job.date_imported) {\n          const importedDate = new Date(job.date_imported);\n          if (importedDate < cutoffDate) shouldArchive = true;\n        }\n        \n        if (shouldArchive) {\n          await runQuery('UPDATE job_listings', { id: job.id, archived: 1 });\n          archivedCount++;\n        }\n      }\n      \n      return { success: true, archivedCount };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  return channels;\n}\n","import { getDatabase, runQuery, getAllQuery, logAction } from './database';\nimport axios from 'axios';\n\n// Import Feature Modules\nimport * as HunterEngine from './features/Hunter-engine';\nimport * as DocGenerator from './features/doc-generator';\nimport * as GhostJobNetwork from './features/ghost-job-network';\nimport * as SecretaryService from './features/secretary-service';\nimport { startHuntingScheduler as initScheduler } from './features/scheduler';\nimport * as AppSubmitter from './features/application-submitter';\n\nlet huntingInterval: NodeJS.Timeout | null = null;\n\nexport async function callAI(model: any, prompt: string, fileData?: string): Promise<string> {\n  console.log('\\n----- CALL AI -----');\n  console.log('Model:', model?.model_name);\n  console.log('Prompt length:', prompt.length);\n  \n  try {\n    if (!model) {\n      console.log('‚ùå No model provided');\n      return \"Error: No AI model provided\";\n    }\n    \n    let apiKey = model.api_key ? model.api_key.trim() : '';\n    let modelName = model.model_name || 'gpt-3.5-turbo';\n    \n    // If no API key in model, try to find from database by role\n    if (!apiKey && model.role) {\n      console.log(`Looking for API key by role: ${model.role}`);\n      const models = await getAllQuery('SELECT * FROM ai_models');\n      const dbModel = models.find((m: any) => m.role === model.role && m.status === 'active');\n      if (dbModel) {\n        apiKey = dbModel.api_key?.trim() || '';\n        modelName = dbModel.model_name || modelName;\n        console.log(`Found model: ${modelName}, key: ${apiKey?.substring(0, 15)}...`);\n      }\n    }\n    \n    if (!apiKey) {\n      console.log('‚ùå No API key found');\n      return \"Error: No API key configured. Go to Settings > AI Models and add your API key.\";\n    }\n    \n    // Determine endpoint\n    let endpoint = 'https://api.openai.com/v1/chat/completions';\n    \n    if (model.model_type === 'local' || model.api_endpoint?.includes('localhost')) {\n      endpoint = model.api_endpoint || 'http://localhost:11434/v1/chat/completions';\n    } else if (apiKey.startsWith('tgp_v1_')) {\n      endpoint = 'https://api.together.xyz/v1/chat/completions';\n    }\n    \n    console.log('Endpoint:', endpoint);\n    console.log('Model name:', modelName);\n    \n    // Build request\n    const requestBody: any = {\n      model: modelName,\n      messages: [\n        { role: 'system', content: 'You are a helpful assistant that extracts job information. Always respond with valid JSON only.' },\n        { role: 'user', content: prompt }\n      ],\n      max_tokens: 1500,\n      temperature: 0.3\n    };\n    \n    // Add image if provided (for vision models)\n    if (fileData && modelName.includes('vision') || modelName.includes('gpt-4o')) {\n      requestBody.messages[1] = {\n        role: 'user',\n        content: [\n          { type: 'text', text: prompt },\n          { type: 'image_url', image_url: { url: fileData } }\n        ]\n      };\n    }\n    \n    console.log('Making API request...');\n    \n    const response = await axios.post(endpoint, requestBody, {\n      headers: { \n        'Authorization': `Bearer ${apiKey}`, \n        'Content-Type': 'application/json' \n      },\n      timeout: 60000\n    });\n    \n    const content = response.data.choices[0].message.content;\n    console.log('AI Response (first 500 chars):', content?.substring(0, 500));\n    console.log('----- END CALL AI -----\\n');\n    \n    return content;\n    \n  } catch (err: any) {\n    const errorMsg = err.response?.data?.error?.message || err.message;\n    console.log('‚ùå AI Error:', errorMsg);\n    console.log('Full error:', err.response?.data || err.message);\n    return \"Error: \" + errorMsg;\n  }\n}\n\nexport async function startHunterSearch(userId: number) {\n  console.log('startHunterSearch called with userId:', userId);\n  return await HunterEngine.startHunterSearch(userId, callAI);\n}\n\nexport async function analyzeJobUrl(jobId: number, userId: number, url: string) {\n  console.log('analyzeJobUrl called:', { jobId, userId, url });\n  const models = await getAllQuery('SELECT * FROM ai_models');\n  const hunter = models.find((m: any) => m.role === 'Hunter' && m.status === 'active');\n  const auditor = models.find((m: any) => m.role === 'Auditor' && m.status === 'active');\n  return await HunterEngine.analyzeJobUrl(jobId, userId, url, hunter, auditor || hunter, callAI);\n}\n\nexport async function processApplication(jobId: number, userId: number, userConsentGiven: boolean = false) {\n  try {\n    const db = getDatabase();\n    const job = db.job_listings.find((j: any) => j.id === jobId);\n    if (!job) return { success: false, error: 'Job not found' };\n\n    const models = await getAllQuery('SELECT * FROM ai_models');\n    const thinker = models.find((m: any) => m.role === 'Thinker' && m.status === 'active');\n    const auditor = models.find((m: any) => m.role === 'Auditor' && m.status === 'active');\n    const observer = models.find((m: any) => m.role === 'Observer' && m.status === 'active') || thinker;\n\n    // Step 1: Generate Docs (The \"Skeleton\" call)\n    if (thinker && auditor) {\n      await DocGenerator.generateTailoredDocs(job, userId, thinker, auditor, { cv: true, coverLetter: true }, callAI);\n    }\n\n    // Step 2: Trigger AI Mouse Submission (The \"Skeleton\" link)\n    console.log(`AI Service: Docs ready for job ${jobId}. Handing over to AI Mouse...`);\n    return await AppSubmitter.submitApplication(jobId, userId, observer, callAI);\n\n  } catch (error: any) {\n    return { success: false, error: error.message };\n  }\n}\n\nexport function startHuntingScheduler(userId: number) {\n  if (huntingInterval) clearInterval(huntingInterval);\n  huntingInterval = initScheduler(userId, startHunterSearch, callAI);\n}\n\nexport async function submitApplication(jobId: number, userId: number) {\n  const models = await getAllQuery('SELECT * FROM ai_models');\n  const observer = models.find((m: any) => m.role === 'Observer' && m.status === 'active') || \n                   models.find((m: any) => m.role === 'Hunter' && m.status === 'active');\n  \n  return await AppSubmitter.submitApplication(jobId, userId, observer, callAI);\n}\n\n/**\n * Process uploaded document with Librarian AI\n */\nexport async function processDocumentWithLibrarian(docId: number, userId: number): Promise<{ success: boolean; error?: string }> {\n  try {\n    // Get the document\n    const docs = await getAllQuery('SELECT * FROM documents');\n    const doc = docs.find((d: any) => d.id === docId);\n    \n    if (!doc) {\n      return { success: false, error: 'Document not found' };\n    }\n    \n    // Get Librarian AI model\n    const models = await getAllQuery('SELECT * FROM ai_models');\n    const librarian = models.find((m: any) => m.role === 'Librarian' && m.status === 'active');\n    \n    if (!librarian) {\n      // Update document status to show no Librarian configured\n      await runQuery('UPDATE documents', { id: docId, ai_status: 'failed: No Librarian AI configured' });\n      return { success: false, error: 'No Librarian AI model configured. Add one in Settings > AI Team.' };\n    }\n    \n    // Update status to reading\n    await runQuery('UPDATE documents', { id: docId, ai_status: 'reading' });\n    \n    // Build prompt based on file type - USER FRIENDLY OUTPUT\n    let prompt = '';\n    const fileType = doc.file_type || '';\n    const fileName = doc.file_name || 'document';\n    \n    const userFriendlyPrompt = `You are a document analysis assistant helping a job seeker organize their application materials.\n\nIMPORTANT: Respond in a friendly, conversational way - NOT in JSON, code, or technical format.\nWrite as if you're a helpful career advisor talking to the user.\n\nDocument: \"${fileName}\"\n\nAnalyze this document and provide:\n1. A brief description of what this document is (1 sentence)\n2. How it will be used in job applications (1-2 sentences)\n3. A \"ready status\" - is this document suitable for applications?\n\nFormat your response like this:\nüìÑ [Document Type]: [Brief description]\n‚ú® Use in Applications: [How the app will use this]\n${fileName.toLowerCase().includes('cv') || fileName.toLowerCase().includes('resume') ? '‚úÖ Ready to use for applications!' : '‚úÖ Saved and ready!'}\n\nKeep it short and encouraging - max 3-4 lines total.`;\n\n    if (fileType.includes('image')) {\n      // For images, we need a vision-capable model\n      prompt = userFriendlyPrompt + `\\n\\nThis is an image file - likely a certificate, diploma, or credential photo.`;\n      \n      // Update status to analyzing\n      await runQuery('UPDATE documents', { id: docId, ai_status: 'analyzing' });\n      \n      // Call AI with image data\n      const summary = await callAI(librarian, prompt, doc.content);\n      \n      // Clean up any JSON or code artifacts from response\n      const cleanedSummary = cleanLibrarianResponse(summary, fileName);\n      \n      // Update document with AI summary\n      await runQuery('UPDATE documents', { \n        id: docId, \n        ai_status: 'verified', \n        ai_summary: cleanedSummary \n      });\n      \n    } else if (fileType.includes('pdf')) {\n      prompt = userFriendlyPrompt + `\\n\\nThis is a PDF document.`;\n      \n      await runQuery('UPDATE documents', { id: docId, ai_status: 'analyzing' });\n      \n      const summary = await callAI(librarian, prompt);\n      const cleanedSummary = cleanLibrarianResponse(summary, fileName);\n      \n      await runQuery('UPDATE documents', { \n        id: docId, \n        ai_status: 'verified', \n        ai_summary: cleanedSummary\n      });\n      \n    } else {\n      prompt = userFriendlyPrompt;\n      \n      await runQuery('UPDATE documents', { id: docId, ai_status: 'analyzing' });\n      \n      const summary = await callAI(librarian, prompt);\n      const cleanedSummary = cleanLibrarianResponse(summary, fileName);\n      \n      await runQuery('UPDATE documents', { \n        id: docId, \n        ai_status: 'verified', \n        ai_summary: cleanedSummary\n      });\n    }\n    \n    await logAction(userId, 'librarian', `üìö Analyzed document: ${fileName}`, 'completed', true);\n    return { success: true };\n    \n  } catch (error: any) {\n    console.error('Librarian processing error:', error);\n    await runQuery('UPDATE documents', { id: docId, ai_status: `failed: ${error.message}` });\n    return { success: false, error: error.message };\n  }\n}\n\n/**\n * Clean up Librarian AI response - remove JSON, code blocks, technical jargon\n */\nfunction cleanLibrarianResponse(response: string, fileName: string): string {\n  let cleaned = response;\n  \n  // Remove JSON blocks\n  cleaned = cleaned.replace(/```json[\\s\\S]*?```/gi, '');\n  cleaned = cleaned.replace(/```[\\s\\S]*?```/gi, '');\n  \n  // Remove raw JSON objects\n  cleaned = cleaned.replace(/\\{[\\s\\S]*?\"document_type\"[\\s\\S]*?\\}/gi, '');\n  cleaned = cleaned.replace(/\\{[\\s\\S]*?\"type\"[\\s\\S]*?\\}/gi, '');\n  \n  // Clean up excessive whitespace\n  cleaned = cleaned.replace(/\\n\\s*\\n\\s*\\n/g, '\\n\\n');\n  cleaned = cleaned.trim();\n  \n  // If response is empty or still has code-like content, provide a friendly fallback\n  if (!cleaned || cleaned.length < 20 || cleaned.includes('\"document_type\"') || cleaned.includes('```')) {\n    const ext = fileName.split('.').pop()?.toLowerCase() || '';\n    const name = fileName.replace(/\\.[^.]+$/, '');\n    \n    if (ext === 'pdf') {\n      if (name.toLowerCase().includes('cv') || name.toLowerCase().includes('resume')) {\n        cleaned = `üìÑ CV/Resume: Your main CV document.\\n‚ú® Will be tailored for each job application.\\n‚úÖ Ready to use!`;\n      } else if (name.toLowerCase().includes('cert') || name.toLowerCase().includes('diploma') || name.toLowerCase().includes('belt')) {\n        cleaned = `üìú Certificate/Credential: \"${name}\" certification.\\n‚ú® Can be referenced to highlight your qualifications.\\n‚úÖ Saved and ready!`;\n      } else if (name.toLowerCase().includes('cover') || name.toLowerCase().includes('letter')) {\n        cleaned = `‚úâÔ∏è Cover Letter: Your cover letter template.\\n‚ú® Will be customized for applications.\\n‚úÖ Ready to use!`;\n      } else {\n        cleaned = `üìÑ Document: \"${name}\"\\n‚ú® Saved to your document library.\\n‚úÖ Ready for applications!`;\n      }\n    } else if (['jpg', 'jpeg', 'png', 'gif'].includes(ext)) {\n      cleaned = `üñºÔ∏è Image: \"${name}\" credential/certificate.\\n‚ú® Visual proof of your qualification.\\n‚úÖ Saved and verified!`;\n    } else {\n      cleaned = `üìÑ Document: \"${name}\"\\n‚ú® Added to your application materials.\\n‚úÖ Ready!`;\n    }\n  }\n  \n  return cleaned;\n}\n\n/**\n * Process all pending documents\n */\nexport async function processAllPendingDocuments(userId: number): Promise<void> {\n  try {\n    const docs = await getAllQuery('SELECT * FROM documents');\n    const pending = docs.filter((d: any) => !d.ai_status || d.ai_status === 'pending');\n    \n    for (const doc of pending) {\n      await processDocumentWithLibrarian(doc.id, userId);\n    }\n  } catch (error) {\n    console.error('Failed to process pending documents:', error);\n  }\n}","import { getDatabase, logAction, runQuery } from '../database';\nimport { getFormCoordinates, executeMouseAction } from '../scraper-service';\nimport puppeteer from 'puppeteer';\nimport path from 'path';\nimport { app } from 'electron';\n\nexport async function submitApplication(jobId: number, userId: number, observerModel: any, callAI: Function) {\n  console.log(`\\n========== SUBMITTING APPLICATION FOR JOB ${jobId} ==========`);\n  \n  try {\n    const db = getDatabase();\n    const job = db.job_listings.find((j: any) => j.id === jobId);\n    const userProfile = db.user_profile.find((p: any) => p.id === userId) || db.user_profile[0];\n    const tailoredDoc = db.documents.find((d: any) => d.job_id === jobId && d.document_type === 'cv');\n\n    if (!job || !job.application_url) {\n      throw new Error(\"Job or application URL not found\");\n    }\n\n    await logAction(userId, 'ai_mouse', `üñ±Ô∏è Starting automated submission for ${job.company_name}`, 'in_progress');\n\n    const browser = await puppeteer.launch({ \n      headless: false,\n      userDataDir: path.join(app.getPath('userData'), 'browser_data'),\n      args: ['--no-sandbox', '--start-maximized']\n    });\n\n    const page = await browser.newPage();\n    await page.setViewport({ width: 1280, height: 800 });\n    await page.goto(job.application_url, { waitUntil: 'networkidle2', timeout: 60000 });\n\n    // Step 1: Get coordinates via AI Observer\n    const coordinates = await getFormCoordinates(page, userId, observerModel, callAI);\n    console.log(\"Form coordinates identified:\", coordinates);\n\n    // Step 2: Fill form using AI Mouse\n    for (const coord of coordinates) {\n      let value = \"\";\n      if (coord.field === 'first_name') value = userProfile.name.split(' ')[0];\n      else if (coord.field === 'last_name') value = userProfile.name.split(' ').slice(1).join(' ');\n      else if (coord.field === 'email') value = userProfile.email || \"\";\n      else if (coord.field === 'phone') value = userProfile.phone || \"\";\n      \n      if (value) {\n        await executeMouseAction(page, { type: 'type', x: coord.x, y: coord.y, text: value });\n      } else if (coord.field.includes('upload') && tailoredDoc) {\n        // Save content to a temporary file for uploading\n        const fs = require('fs');\n        const tempPath = path.join(app.getPath('temp'), `tailored_cv_${jobId}.txt`);\n        fs.writeFileSync(tempPath, tailoredDoc.content);\n        await executeMouseAction(page, { type: 'upload', x: coord.x, y: coord.y, filePath: tempPath });\n      }\n    }\n\n    // Step 3: Final Review & Submit\n    const submitBtn = coordinates.find((c: any) => c.field === 'submit');\n    if (submitBtn) {\n      await logAction(userId, 'ai_auditor', 'üßê Final visual check before submission...', 'in_progress');\n      await executeMouseAction(page, { type: 'click', x: submitBtn.x, y: submitBtn.y });\n      await logAction(userId, 'ai_mouse', `‚úÖ Application submitted to ${job.company_name}`, 'completed', true);\n      await runQuery('UPDATE job_listings', { id: jobId, status: 'submitted' });\n    }\n\n    await new Promise(resolve => setTimeout(resolve, 5000));\n    await browser.close();\n    return { success: true };\n\n  } catch (error: any) {\n    console.error(\"Submission Error:\", error);\n    await logAction(userId, 'ai_mouse', `‚ùå Submission failed: ${error.message}`, 'failed', false);\n    return { success: false, error: error.message };\n  }\n}","import { ipcMain } from 'electron';\nimport { runQuery, getAllQuery, getDatabase } from '../database';\nimport * as aiService from '../ai-service';\nimport axios from 'axios';\n\nexport function registerAIHandlers(): string[] {\n  const channels = [\n    'hunter:start-search',\n    'hunter:cancel-search',\n    'ai:process-application',\n    'ai:generate-tailored-docs',\n    'ai:fetch-models',\n    'ai:test-model',\n    'ai:generate-interview-prep',\n    'ai:ask-custom-question',\n    'ai:ask-about-cv',\n    'ai:smart-apply',\n    'ai:continue-application',\n    'ai:cancel-application'\n  ];\n\n  // --- AI MODEL TEST ---\n  ipcMain.handle('ai:test-model', async (_, data) => {\n    try {\n      const { modelName, apiKey, apiEndpoint } = data;\n      \n      console.log('\\n===== AI MODEL TEST =====');\n      console.log('Model Name:', modelName);\n      console.log('API Key:', apiKey ? `${apiKey.substring(0, 20)}...` : 'MISSING');\n      console.log('Custom Endpoint:', apiEndpoint || 'none');\n      \n      if (!apiKey || apiKey.trim() === '') {\n        console.log('ERROR: No API key provided');\n        return { success: false, message: 'No API key provided' };\n      }\n      \n      const trimmedKey = apiKey.trim();\n      \n      // Determine endpoint and provider type based on key format\n      let endpoint = '';\n      let provider = 'openai';\n      \n      // Check for custom/local endpoint first\n      if (apiEndpoint && (apiEndpoint.includes('localhost') || apiEndpoint.includes('127.0.0.1'))) {\n        endpoint = apiEndpoint;\n        provider = 'local';\n      } \n      // Check API key patterns - ORDER MATTERS (more specific first)\n      else if (trimmedKey.startsWith('sk-or-')) {\n        endpoint = 'https://openrouter.ai/api/v1/chat/completions';\n        provider = 'openrouter';\n      } else if (trimmedKey.startsWith('sk-ant-')) {\n        endpoint = 'https://api.anthropic.com/v1/messages';\n        provider = 'anthropic';\n      } else if (trimmedKey.startsWith('tgp_v1_')) {\n        endpoint = 'https://api.together.xyz/v1/chat/completions';\n        provider = 'together';\n      } else if (trimmedKey.startsWith('AIza')) {\n        endpoint = 'https://generativelanguage.googleapis.com/v1beta/models';\n        provider = 'google';\n      } else if (trimmedKey.startsWith('sk-proj-') || trimmedKey.startsWith('sk-')) {\n        // OpenAI - both classic and project-based keys\n        endpoint = 'https://api.openai.com/v1/chat/completions';\n        provider = 'openai';\n      } else {\n        // Unknown format - try OpenAI first as it's most common\n        endpoint = 'https://api.openai.com/v1/chat/completions';\n        provider = 'openai';\n      }\n      \n      console.log('Detected Provider:', provider);\n      console.log('Using Endpoint:', endpoint);\n      \n      // Use a safe model name for testing\n      let testModelName = modelName;\n      if (provider === 'openai' && (!modelName || modelName === '')) {\n        testModelName = 'gpt-3.5-turbo';\n      }\n      \n      console.log('Test Model Name:', testModelName);\n      \n      // Simple test prompt\n      const testPrompt = 'Say OK';\n      \n      let response;\n      \n      if (provider === 'anthropic') {\n        console.log('Making Anthropic API call...');\n        response = await axios.post(endpoint, {\n          model: testModelName || 'claude-3-haiku-20240307',\n          max_tokens: 10,\n          messages: [{ role: 'user', content: testPrompt }]\n        }, {\n          headers: {\n            'x-api-key': trimmedKey,\n            'anthropic-version': '2023-06-01',\n            'Content-Type': 'application/json'\n          },\n          timeout: 30000\n        });\n      } else if (provider === 'google') {\n        console.log('Making Google AI call...');\n        const googleEndpoint = `https://generativelanguage.googleapis.com/v1beta/models/${testModelName || 'gemini-pro'}:generateContent?key=${trimmedKey}`;\n        response = await axios.post(googleEndpoint, {\n          contents: [{ parts: [{ text: testPrompt }] }]\n        }, {\n          headers: { 'Content-Type': 'application/json' },\n          timeout: 30000\n        });\n      } else if (provider === 'openrouter') {\n        console.log('Making OpenRouter API call...');\n        response = await axios.post(endpoint, {\n          model: testModelName || 'openai/gpt-3.5-turbo',\n          messages: [{ role: 'user', content: testPrompt }],\n          max_tokens: 10,\n          temperature: 0\n        }, {\n          headers: {\n            'Authorization': `Bearer ${trimmedKey}`,\n            'Content-Type': 'application/json',\n            'HTTP-Referer': 'https://job-automation-app.local',\n            'X-Title': 'Job Automation App'\n          },\n          timeout: 30000\n        });\n      } else {\n        // OpenAI and compatible APIs (Together, local, etc.)\n        console.log('Making OpenAI-compatible API call...');\n        console.log('Request body:', JSON.stringify({\n          model: testModelName || 'gpt-3.5-turbo',\n          messages: [{ role: 'user', content: testPrompt }],\n          max_tokens: 10\n        }));\n        \n        response = await axios.post(endpoint, {\n          model: testModelName || 'gpt-3.5-turbo',\n          messages: [{ role: 'user', content: testPrompt }],\n          max_tokens: 10,\n          temperature: 0\n        }, {\n          headers: {\n            'Authorization': `Bearer ${trimmedKey}`,\n            'Content-Type': 'application/json'\n          },\n          timeout: 30000\n        });\n      }\n      \n      console.log('Response status:', response.status);\n      console.log('Response data:', JSON.stringify(response.data).substring(0, 200));\n      \n      if (response.data) {\n        // Check for actual response content based on provider\n        let hasContent = false;\n        let responseText = '';\n        \n        if (provider === 'google') {\n          responseText = response.data.candidates?.[0]?.content?.parts?.[0]?.text || '';\n          hasContent = !!responseText;\n        } else if (provider === 'anthropic') {\n          responseText = response.data.content?.[0]?.text || '';\n          hasContent = !!responseText;\n        } else {\n          responseText = response.data.choices?.[0]?.message?.content || '';\n          hasContent = !!responseText;\n        }\n        \n        console.log('Response text:', responseText);\n        console.log('Has content:', hasContent);\n        console.log('===== TEST PASSED =====\\n');\n        \n        return { success: true, message: `‚úì Model responding correctly` };\n      } else {\n        console.log('===== TEST FAILED: No response data =====\\n');\n        return { success: false, message: 'No response from model' };\n      }\n      \n    } catch (e: any) {\n      console.log('\\n===== AI MODEL TEST ERROR =====');\n      console.log('Error type:', e.constructor.name);\n      console.log('Error message:', e.message);\n      console.log('Response status:', e.response?.status);\n      console.log('Response data:', JSON.stringify(e.response?.data || {}).substring(0, 500));\n      console.log('================================\\n');\n      \n      // Extract meaningful error message\n      let errorMsg = 'Unknown error';\n      \n      if (e.response?.data?.error?.message) {\n        errorMsg = e.response.data.error.message;\n      } else if (e.response?.data?.message) {\n        errorMsg = e.response.data.message;\n      } else if (e.response?.data?.error) {\n        errorMsg = typeof e.response.data.error === 'string' \n          ? e.response.data.error \n          : JSON.stringify(e.response.data.error);\n      } else if (e.response?.status === 401) {\n        errorMsg = 'Invalid API key - check that your key is correct and active';\n      } else if (e.response?.status === 403) {\n        errorMsg = 'Access forbidden - your API key may not have permission for this model';\n      } else if (e.response?.status === 404) {\n        errorMsg = 'Model not found - check the model name is correct';\n      } else if (e.response?.status === 429) {\n        errorMsg = 'Rate limited or quota exceeded - check your API plan';\n      } else if (e.response?.status === 500 || e.response?.status === 502 || e.response?.status === 503) {\n        errorMsg = 'API server error - try again later';\n      } else if (e.code === 'ECONNREFUSED') {\n        errorMsg = 'Connection refused - check endpoint URL';\n      } else if (e.code === 'ETIMEDOUT' || e.code === 'ECONNABORTED') {\n        errorMsg = 'Connection timeout - server not responding';\n      } else if (e.code === 'ENOTFOUND') {\n        errorMsg = 'Server not found - check your internet connection';\n      } else if (e.message) {\n        errorMsg = e.message;\n      }\n      \n      return { success: false, message: errorMsg };\n    }\n  });\n\n  // --- AI / HUNTER ---\n  ipcMain.handle('hunter:start-search', async (_, userId) => {\n    try {\n      const result = await aiService.startHunterSearch(userId);\n      return result;\n    } catch (e: any) {\n      console.error('Hunter search error:', e);\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('hunter:cancel-search', async () => {\n    try {\n      const HunterEngine = require('../features/Hunter-engine');\n      HunterEngine.cancelHunterSearch();\n      return { success: true };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('ai:process-application', async (_, jobId, userId) => {\n    try {\n      return await aiService.processApplication(jobId, userId);\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('ai:generate-tailored-docs', async (_, data) => {\n    try {\n      const { jobId, userId, docOptions } = data;\n      const db = getDatabase();\n      const job = db.job_listings?.find((j: any) => j.id === jobId);\n      \n      if (!job) {\n        return { success: false, error: 'Job not found' };\n      }\n      \n      const models = await getAllQuery('SELECT * FROM ai_models');\n      const thinker = models.find((m: any) => m.role === 'Thinker' && m.status === 'active');\n      const auditor = models.find((m: any) => m.role === 'Auditor' && m.status === 'active');\n      \n      if (!thinker) {\n        return { success: false, error: 'No Thinker AI model configured. Go to Settings > AI Models.' };\n      }\n      \n      const DocGenerator = require('../features/doc-generator');\n      await DocGenerator.generateTailoredDocs(\n        job, \n        userId, \n        thinker, \n        auditor || thinker, \n        docOptions || { cv: true, motivationLetter: true, coverLetter: true },\n        aiService.callAI\n      );\n      \n      return { success: true };\n    } catch (e: any) {\n      console.error('Generate docs error:', e);\n      return { success: false, error: e.message };\n    }\n  });\n\n  // --- AI FETCH MODELS ---\n  ipcMain.handle('ai:fetch-models', async (_, apiKey: string, role?: string) => {\n    try {\n      let provider = 'openrouter';\n      if (apiKey.startsWith('sk-') && apiKey.length > 50) {\n        provider = 'openai';\n      } else if (apiKey.startsWith('sk-ant-')) {\n        provider = 'anthropic';\n      }\n      \n      let models: string[] = [];\n      let recommendations: { Speed: any[], Cost: any[], Quality: any[] } = { Speed: [], Cost: [], Quality: [] };\n\n      if (provider === 'openai') {\n        const response = await axios.get('https://api.openai.com/v1/models', {\n          headers: { 'Authorization': `Bearer ${apiKey}` },\n          timeout: 10000\n        });\n        models = response.data.data\n          .filter((m: any) => m.id.includes('gpt') || m.id.includes('o1') || m.id.includes('o3'))\n          .map((m: any) => m.id)\n          .sort();\n        \n        if (role === 'Hunter' || role === 'Observer') {\n          recommendations = {\n            Speed: [{ id: 'gpt-4o-mini', desc: 'Fast & cheap' }],\n            Cost: [{ id: 'gpt-3.5-turbo', desc: 'Most affordable' }],\n            Quality: [{ id: 'gpt-4o', desc: 'Best quality' }]\n          };\n        } else if (role === 'Thinker' || role === 'HR AI') {\n          recommendations = {\n            Speed: [{ id: 'gpt-4o-mini', desc: 'Quick drafts' }],\n            Cost: [{ id: 'gpt-4o-mini', desc: 'Budget friendly' }],\n            Quality: [{ id: 'gpt-4o', desc: 'Best writing' }, { id: 'o1-preview', desc: 'Deep reasoning' }]\n          };\n        } else if (role === 'Auditor') {\n          recommendations = {\n            Speed: [{ id: 'gpt-4o-mini', desc: 'Quick checks' }],\n            Cost: [{ id: 'gpt-3.5-turbo', desc: 'Cost efficient' }],\n            Quality: [{ id: 'gpt-4o', desc: 'Thorough review' }]\n          };\n        }\n      } else if (provider === 'anthropic') {\n        models = ['claude-3-opus-20240229', 'claude-3-sonnet-20240229', 'claude-3-haiku-20240307', 'claude-3-5-sonnet-20241022'];\n        recommendations = {\n          Speed: [{ id: 'claude-3-haiku-20240307', desc: 'Fastest Claude' }],\n          Cost: [{ id: 'claude-3-haiku-20240307', desc: 'Most affordable' }],\n          Quality: [{ id: 'claude-3-5-sonnet-20241022', desc: 'Best quality' }, { id: 'claude-3-opus-20240229', desc: 'Most capable' }]\n        };\n      } else {\n        try {\n          const response = await axios.get('https://openrouter.ai/api/v1/models', {\n            headers: { 'Authorization': `Bearer ${apiKey}` },\n            timeout: 10000\n          });\n          models = response.data.data?.map((m: any) => m.id).slice(0, 50) || [];\n          \n          recommendations = {\n            Speed: [\n              { id: 'mistralai/mistral-7b-instruct', desc: 'Very fast' },\n              { id: 'meta-llama/llama-3-8b-instruct', desc: 'Quick & capable' }\n            ],\n            Cost: [\n              { id: 'mistralai/mistral-7b-instruct', desc: 'Free tier' },\n              { id: 'google/gemma-7b-it', desc: 'Very cheap' }\n            ],\n            Quality: [\n              { id: 'anthropic/claude-3-opus', desc: 'Top quality' },\n              { id: 'openai/gpt-4-turbo', desc: 'Excellent' },\n              { id: 'meta-llama/llama-3-70b-instruct', desc: 'Great open source' }\n            ]\n          };\n        } catch {\n          models = [\n            'openai/gpt-4-turbo', 'openai/gpt-4o', 'openai/gpt-4o-mini',\n            'anthropic/claude-3-opus', 'anthropic/claude-3-sonnet', 'anthropic/claude-3-haiku',\n            'meta-llama/llama-3-70b-instruct', 'meta-llama/llama-3-8b-instruct',\n            'mistralai/mixtral-8x7b-instruct', 'google/gemini-pro'\n          ];\n        }\n      }\n\n      return { success: true, data: models, recommendations };\n    } catch (e: any) {\n      console.error('Fetch models error:', e.message);\n      return { success: false, error: e.message, data: [], recommendations: { Speed: [], Cost: [], Quality: [] } };\n    }\n  });\n\n  // --- HR AI - CUSTOM QUESTION ---\n  ipcMain.handle('ai:ask-custom-question', async (_, data) => {\n    try {\n      const { question, jobUrl, userId } = data;\n      \n      const models = await getAllQuery('SELECT * FROM ai_models');\n      const hrAI = models.find((m: any) => m.role === 'HR AI' && m.status === 'active') ||\n                   models.find((m: any) => m.role === 'Thinker' && m.status === 'active');\n      \n      if (!hrAI) {\n        return { success: false, error: 'No HR AI model configured. Please add an AI model with role \"HR AI\" in Settings > AI Models.' };\n      }\n      \n      const profiles = await getAllQuery('SELECT * FROM user_profile');\n      const userProfile = profiles[0];\n      \n      const db = getDatabase();\n      const jobs = db.job_listings || [];\n      let job = jobs.find((j: any) => j.url === jobUrl);\n      \n      let jobContext = '';\n      if (job) {\n        jobContext = `\nJob Title: ${job.job_title || 'Unknown'}\nCompany: ${job.company_name || 'Unknown'}\nRequirements: ${job.required_skills || 'Not specified'}\nDescription: ${job.description?.substring(0, 500) || 'Not available'}`;\n      } else if (jobUrl) {\n        jobContext = `Job URL: ${jobUrl} (Details not yet analyzed)`;\n      }\n      \n      let userContext = '';\n      if (userProfile) {\n        userContext = `\nName: ${userProfile.name || 'Not provided'}\nTitle: ${userProfile.title || 'Not provided'}\nSkills: ${userProfile.skills || 'Not provided'}\nExperience: ${userProfile.summary || 'Not provided'}`;\n      }\n      \n      const prompt = `You are an expert HR interviewer and career coach. A job seeker has a question about interviewing.\n\n${jobContext ? `JOB CONTEXT:\\n${jobContext}` : ''}\n\n${userContext ? `CANDIDATE PROFILE:\\n${userContext}` : ''}\n\nUSER'S QUESTION: \"${question}\"\n\nProvide:\n1. A suggested answer (personalized if profile available)\n2. Tips for delivery\n\nRespond in this format:\nANSWER:\n[Your suggested answer here]\n\nTIPS:\n[Bullet points with tips]`;\n\n      const response = await aiService.callAI(hrAI, prompt);\n      \n      let answer = '';\n      let tips = '';\n      \n      if (response.includes('ANSWER:')) {\n        const parts = response.split('TIPS:');\n        answer = parts[0].replace('ANSWER:', '').trim();\n        tips = parts[1]?.trim() || '';\n      } else {\n        answer = response;\n      }\n      \n      return { success: true, answer, tips };\n    } catch (e: any) {\n      console.error('Custom question error:', e);\n      return { success: false, error: e.message };\n    }\n  });\n\n  // --- HR AI - INTERVIEW PREP ---\n  ipcMain.handle('ai:generate-interview-prep', async (_, data) => {\n    try {\n      const { jobUrl, userId, generateMore } = data;\n      \n      const models = await getAllQuery('SELECT * FROM ai_models');\n      const hrAI = models.find((m: any) => m.role === 'HR AI' && m.status === 'active') ||\n                   models.find((m: any) => m.role === 'Thinker' && m.status === 'active');\n      \n      if (!hrAI) {\n        return { success: false, error: 'No HR AI model configured. Please add an AI model with role \"HR AI\" in Settings > AI Models.' };\n      }\n      \n      const profiles = await getAllQuery('SELECT * FROM user_profile');\n      const userProfile = profiles[0];\n      \n      const db = getDatabase();\n      const jobs = db.job_listings || [];\n      let job = jobs.find((j: any) => j.url === jobUrl);\n      \n      let jobDescription = '';\n      let jobInfo = null;\n      let importantApps: string[] = [];\n      \n      if (job) {\n        jobDescription = `\nJob Title: ${job.job_title}\nCompany: ${job.company_name}\nLocation: ${job.location || 'Not specified'}\nRequired Skills: ${job.required_skills || 'Not specified'}\nExperience Level: ${job.experience_level || 'Not specified'}\nJob Type: ${job.job_type || 'Not specified'}\nDescription: ${job.description || 'Not available'}`;\n        \n        jobInfo = {\n          title: job.job_title,\n          company: job.company_name,\n          location: job.location\n        };\n        \n        if (job.required_skills) {\n          importantApps = job.required_skills.split(',').map((s: string) => s.trim()).filter(Boolean).slice(0, 8);\n        }\n      } else if (jobUrl) {\n        try {\n          const ScraperService = require('../scraper-service');\n          // Use getJobPageContent instead of non-existent scrapeJobPage\n          const pageData = await ScraperService.getJobPageContent(jobUrl, userId, aiService.callAI);\n          if (pageData && pageData.content && pageData.content.length > 100) {\n            // Ensure content is a clean string (no non-serializable data)\n            const cleanContent = String(pageData.content || '').substring(0, 3000);\n            jobDescription = `Job posting content from ${jobUrl}:\\n${cleanContent}`;\n            \n            // Try to extract basic info from the content\n            const titleMatch = cleanContent.match(/(?:job\\s*title|position)[:\\s]*([^\\n]+)/i);\n            const companyMatch = cleanContent.match(/(?:company|employer)[:\\s]*([^\\n]+)/i);\n            const locationMatch = cleanContent.match(/(?:location|located)[:\\s]*([^\\n]+)/i);\n            \n            // Try to parse JSON-LD data if available\n            let parsedTitle = titleMatch?.[1]?.trim();\n            let parsedCompany = companyMatch?.[1]?.trim();\n            let parsedLocation = locationMatch?.[1]?.trim();\n            \n            // If content looks like JSON (from JSON-LD extraction), try to parse it\n            const strategyUsed = String(pageData.strategyUsed || '');\n            if (strategyUsed.includes('JSON-LD') && cleanContent.startsWith('{')) {\n              try {\n                const jsonData = JSON.parse(cleanContent);\n                parsedTitle = jsonData.title || jsonData.jobTitle || jsonData.name || parsedTitle;\n                parsedCompany = jsonData.hiringOrganization?.name || jsonData.companyName || parsedCompany;\n                parsedLocation = jsonData.jobLocation?.address?.addressLocality || \n                                 jsonData.jobLocation?.name || \n                                 jsonData.location || parsedLocation;\n                \n                // Extract skills from JSON if available\n                if (jsonData.skills || jsonData.requiredSkills) {\n                  const skills = jsonData.skills || jsonData.requiredSkills;\n                  importantApps = (typeof skills === 'string' ? skills.split(',') : skills)\n                    .map((s: string) => String(s).trim())\n                    .filter(Boolean)\n                    .slice(0, 8);\n                }\n              } catch (parseError) {\n                console.log('Could not parse JSON-LD data:', parseError);\n              }\n            }\n            \n            // Ensure jobInfo contains only serializable primitives\n            jobInfo = {\n              title: String(parsedTitle || 'Position from URL'),\n              company: String(parsedCompany || 'Company'),\n              location: String(parsedLocation || 'See job posting')\n            };\n          }\n        } catch (e) {\n          console.error('Failed to scrape job URL:', e);\n          jobDescription = `Job URL: ${jobUrl} (Could not fetch details - please ensure the URL is accessible)`;\n        }\n      }\n      \n      let userContext = '';\n      if (userProfile) {\n        userContext = `\nCandidate Background:\n- Name: ${userProfile.name || 'Job Seeker'}\n- Current Title: ${userProfile.title || 'Professional'}\n- Skills: ${userProfile.skills || 'Various'}\n- Experience Summary: ${userProfile.summary || 'Experienced professional'}`;\n      }\n      \n      const prompt = `You are an expert HR interviewer preparing a candidate for a job interview.\n\n${jobDescription}\n\n${userContext}\n\nGenerate ${generateMore ? '5 MORE different' : '10'} interview questions across these categories:\n- get_to_know: Personal background and career goals\n- psychological: Behavioral and situational questions\n- aptitude: Problem-solving and analytical skills\n- culture: Values alignment and team dynamics\n- position_specific: Technical skills and role requirements\n\nFor each question provide:\n1. The category (one of: get_to_know, psychological, aptitude, culture, position_specific)\n2. The interview question\n3. A suggested answer tailored to this candidate and job\n4. Difficulty level (easy, medium, hard)\n5. Tips for answering\n\nRespond ONLY with a valid JSON array in this exact format:\n[\n  {\n    \"id\": \"q1\",\n    \"category\": \"get_to_know\",\n    \"question\": \"Tell me about yourself\",\n    \"suggestedAnswer\": \"...\",\n    \"difficulty\": \"easy\",\n    \"tips\": \"...\"\n  }\n]`;\n\n      const response = await aiService.callAI(hrAI, prompt);\n      \n      let questions = [];\n      try {\n        const jsonMatch = response.match(/\\[[\\s\\S]*\\]/);\n        if (jsonMatch) {\n          questions = JSON.parse(jsonMatch[0]);\n        }\n      } catch (e) {\n        console.error('Failed to parse interview questions:', e);\n        questions = [{\n          id: 'q1',\n          category: 'get_to_know',\n          question: 'Tell me about yourself and your background.',\n          suggestedAnswer: 'I am a professional with experience in...',\n          difficulty: 'easy',\n          tips: 'Keep your answer focused and relevant to the position.'\n        }];\n      }\n      \n      return { \n        success: true, \n        questions: questions.map((q: any) => ({\n          id: String(q.id || ''),\n          category: String(q.category || 'general'),\n          question: String(q.question || ''),\n          suggestedAnswer: String(q.suggestedAnswer || ''),\n          difficulty: String(q.difficulty || 'medium'),\n          tips: String(q.tips || '')\n        })),\n        jobInfo: jobInfo ? {\n          title: String(jobInfo.title || ''),\n          company: String(jobInfo.company || ''),\n          location: String(jobInfo.location || '')\n        } : null,\n        importantApps: importantApps.map((a: any) => String(a))\n      };\n    } catch (e: any) {\n      console.error('Interview prep error:', e);\n      return { success: false, error: String(e.message || 'Unknown error') };\n    }\n  });\n\n  // --- SMART APPLICATION ---\n  ipcMain.handle('ai:smart-apply', async (_, data) => {\n    try {\n      const SmartApplicant = require('../features/smart-applicant');\n      const models = await getAllQuery('SELECT * FROM ai_models');\n      const observer = models.find((m: any) => m.role === 'Observer' && m.status === 'active') ||\n                       models.find((m: any) => m.role === 'Hunter' && m.status === 'active');\n      \n      (global as any).callAI = aiService.callAI;\n      \n      return await SmartApplicant.submitApplication(data.jobId, data.userId, observer, aiService.callAI);\n    } catch (e: any) {\n      console.error('Smart apply error:', e);\n      return { success: false, status: 'failed', error: e.message };\n    }\n  });\n\n  ipcMain.handle('ai:continue-application', async (_, data) => {\n    try {\n      const SmartApplicant = require('../features/smart-applicant');\n      return await SmartApplicant.continueApplicationWithAnswers(data.jobId, data.userId, data.answers);\n    } catch (e: any) {\n      return { success: false, status: 'failed', error: e.message };\n    }\n  });\n\n  ipcMain.handle('ai:cancel-application', async (_, jobId) => {\n    try {\n      const SmartApplicant = require('../features/smart-applicant');\n      await SmartApplicant.cancelApplication(jobId);\n      return { success: true };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  // --- ASK ABOUT CV (HR AI grilling based on Job + CV) ---\n  ipcMain.handle('ai:ask-about-cv', async (_, data) => {\n    try {\n      const { jobUrl, userId, difficultyLevel } = data;\n      \n      const models = await getAllQuery('SELECT * FROM ai_models');\n      const hrAI = models.find((m: any) => m.role === 'HR AI' && m.status === 'active') ||\n                   models.find((m: any) => m.role === 'Thinker' && m.status === 'active');\n      \n      if (!hrAI) {\n        return { success: false, error: 'No HR AI model configured. Please add an AI model with role \"HR AI\" in Settings > AI Models.' };\n      }\n      \n      // Get user profile (CV data)\n      const profiles = await getAllQuery('SELECT * FROM user_profile');\n      const userProfile = profiles[0];\n      \n      if (!userProfile) {\n        return { success: false, error: 'No profile found. Please set up your LinkedIn Profile or Manual Profile in Settings first.' };\n      }\n      \n      // Get job info\n      const db = getDatabase();\n      const jobs = db.job_listings || [];\n      let job = jobs.find((j: any) => j.url === jobUrl);\n      \n      let jobContext = '';\n      if (job) {\n        jobContext = `\nJob Title: ${job.job_title || 'Unknown'}\nCompany: ${job.company_name || 'Unknown'}\nRequirements: ${job.required_skills || 'Not specified'}\nExperience Level: ${job.experience_level || 'Not specified'}\nDescription: ${job.description?.substring(0, 1500) || 'Not available'}`;\n      } else if (jobUrl) {\n        // Try to scrape job info\n        try {\n          const ScraperService = require('../scraper-service');\n          const pageData = await ScraperService.getJobPageContent(jobUrl, userId, aiService.callAI);\n          if (pageData?.content) {\n            jobContext = `Job posting from ${jobUrl}:\\n${pageData.content.substring(0, 2000)}`;\n          }\n        } catch (e) {\n          jobContext = `Job URL: ${jobUrl} (Could not fetch details)`;\n        }\n      }\n      \n      // Build CV context\n      let cvContext = `\nCandidate Name: ${userProfile.name || 'Not provided'}\nProfessional Title: ${userProfile.title || 'Not provided'}\nLocation: ${userProfile.location || 'Not provided'}\nSummary: ${userProfile.summary || 'Not provided'}`;\n      \n      // Parse experiences\n      try {\n        const experiences = userProfile.experiences ? JSON.parse(userProfile.experiences) : [];\n        if (experiences.length > 0) {\n          cvContext += '\\n\\nWork Experience:';\n          experiences.slice(0, 5).forEach((exp: any, i: number) => {\n            cvContext += `\\n${i + 1}. ${exp.title || 'Role'} at ${exp.company || 'Company'} (${exp.startDate || '?'} - ${exp.endDate || 'Present'}): ${exp.description?.substring(0, 200) || 'No description'}`;\n          });\n        }\n      } catch (e) {}\n      \n      // Parse skills\n      try {\n        const skills = userProfile.skills ? JSON.parse(userProfile.skills) : [];\n        if (skills.length > 0) {\n          cvContext += `\\n\\nSkills: ${skills.join(', ')}`;\n        }\n      } catch (e) {}\n      \n      // Parse education\n      try {\n        const educations = userProfile.educations ? JSON.parse(userProfile.educations) : [];\n        if (educations.length > 0) {\n          cvContext += '\\n\\nEducation:';\n          educations.slice(0, 3).forEach((edu: any, i: number) => {\n            cvContext += `\\n${i + 1}. ${edu.degree || 'Degree'} in ${edu.field || 'Field'} from ${edu.school || 'School'}`;\n          });\n        }\n      } catch (e) {}\n      \n      // Determine question style based on difficulty\n      let difficultyInstruction = '';\n      if (difficultyLevel <= 3) {\n        difficultyInstruction = 'Ask EASY questions - basic background, motivation, and simple experience verification. Be friendly and encouraging.';\n      } else if (difficultyLevel <= 6) {\n        difficultyInstruction = 'Ask MEDIUM difficulty questions - probe into specific experiences, ask for examples, test technical knowledge at a moderate level.';\n      } else if (difficultyLevel <= 8) {\n        difficultyInstruction = 'Ask HARD questions - challenge gaps in experience, ask tough behavioral questions, probe for weaknesses, test deep technical knowledge.';\n      } else {\n        difficultyInstruction = 'Ask EXTREME questions - be a tough interviewer, find inconsistencies, ask stress-test questions, challenge every claim, probe for failures and how they handled them.';\n      }\n      \n      const prompt = `You are an expert HR interviewer conducting a tough interview. Your job is to grill the candidate based on their CV and the job requirements.\n\n${difficultyInstruction}\n\nJOB REQUIREMENTS:\n${jobContext || 'No specific job context provided'}\n\nCANDIDATE'S CV:\n${cvContext}\n\nGenerate exactly 5 interview questions that:\n1. Probe the candidate's experience relative to this specific job\n2. Challenge potential gaps between their CV and job requirements\n3. Test their claimed skills with specific scenarios\n4. Include behavioral questions about their past experiences\n5. Match the difficulty level requested\n\nFor each question, also provide a suggested answer the candidate could give.\n\nRespond ONLY with a valid JSON array in this exact format:\n[\n  {\n    \"question\": \"Tell me about a time when...\",\n    \"answer\": \"A strong answer would be...\",\n    \"difficulty\": \"easy|medium|hard\"\n  }\n]`;\n\n      const response = await aiService.callAI(hrAI, prompt);\n      \n      let questions = [];\n      try {\n        const jsonMatch = response.match(/\\[[\\s\\S]*\\]/);\n        if (jsonMatch) {\n          questions = JSON.parse(jsonMatch[0]);\n        }\n      } catch (e) {\n        console.error('Failed to parse CV questions:', e);\n        questions = [{\n          question: 'Tell me about your most relevant experience for this role.',\n          answer: 'Focus on specific achievements and how they relate to the job requirements.',\n          difficulty: 'medium'\n        }];\n      }\n      \n      return { success: true, questions };\n    } catch (e: any) {\n      console.error('Ask about CV error:', e);\n      return { success: false, error: e.message };\n    }\n  });\n\n  return channels;\n}\n","import { ipcMain, shell } from 'electron';\nimport { runQuery, getAllQuery } from '../database';\nimport * as aiService from '../ai-service';\n\nexport function registerDocsHandlers(): string[] {\n  const channels = [\n    'docs:get-all', \n    'docs:save', \n    'docs:delete', \n    'docs:open-file', \n    'docs:convert-to-pdf', \n    'docs:convert-all-pdf',\n    'docs:reprocess'\n  ];\n\n  // --- DOCUMENTS ---\n  ipcMain.handle('docs:get-all', async () => {\n    try {\n      const data = await getAllQuery('SELECT * FROM documents');\n      return { success: true, data: data || [] };\n    } catch (e: any) {\n      return { success: false, error: e.message, data: [] };\n    }\n  });\n\n  ipcMain.handle('docs:save', async (_, data) => {\n    try {\n      const docData = {\n        ...data,\n        ai_status: 'pending',\n        created_at: new Date().toISOString()\n      };\n      const result = await runQuery('INSERT INTO documents', [docData]);\n      \n      // Trigger Librarian processing in background\n      if (result?.id) {\n        setTimeout(() => {\n          aiService.processDocumentWithLibrarian(result.id, data.userId || 1).catch(e => \n            console.error('Background document processing failed:', e)\n          );\n        }, 100);\n      }\n      \n      return { success: true, id: result.id };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('docs:reprocess', async (_, docId, userId) => {\n    try {\n      return await aiService.processDocumentWithLibrarian(docId, userId);\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('docs:delete', async (_, id) => {\n    try {\n      await runQuery('DELETE FROM documents', { id });\n      return { success: true };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('docs:open-file', async (_, filePath) => {\n    try {\n      await shell.openPath(filePath);\n      return { success: true };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  // --- PDF EXPORT ---\n  ipcMain.handle('docs:convert-to-pdf', async (_, data) => {\n    try {\n      const PdfExport = require('../features/pdf-export');\n      return await PdfExport.convertHtmlToPdf(data.htmlPath, data.userId);\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('docs:convert-all-pdf', async (_, data) => {\n    try {\n      const PdfExport = require('../features/pdf-export');\n      return await PdfExport.convertAllJobDocsToPdf(data.jobId, data.userId);\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  return channels;\n}\n","import { ipcMain } from 'electron';\nimport { runQuery, getAllQuery } from '../database';\n\nexport function registerWebsitesHandlers(): string[] {\n  const channels = ['websites:get-all', 'websites:add', 'websites:delete', 'websites:toggle-active'];\n\n  // --- WEBSITES ---\n  ipcMain.handle('websites:get-all', async () => {\n    try {\n      const data = await getAllQuery('SELECT * FROM job_websites');\n      return { success: true, data };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('websites:add', async (_, data) => {\n    try {\n      const result = await runQuery('INSERT INTO job_websites', [data]);\n      return { success: true, id: result.id };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('websites:delete', async (_, id) => {\n    try {\n      await runQuery('DELETE FROM job_websites', { id });\n      return { success: true };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('websites:toggle-active', async (_, data) => {\n    try {\n      await runQuery('UPDATE job_websites', { id: data.id, is_active: data.isActive });\n      return { success: true };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  return channels;\n}\n","import { ipcMain } from 'electron';\nimport { runQuery, getAllQuery, getDatabase } from '../database';\nimport fs from 'fs';\nimport path from 'path';\nlet app: any;\ntry { app = require('electron').app; } catch (e) { app = (global as any).electronApp; }\n\nexport function registerAIModelsHandlers(): string[] {\n  const channels = ['ai-models:get-all', 'ai-models:add', 'ai-models:update', 'ai-models:delete'];\n\n  // --- AI MODELS ---\n  ipcMain.handle('ai-models:get-all', async () => {\n    try {\n      const data = await getAllQuery('SELECT * FROM ai_models');\n      return { success: true, data };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('ai-models:add', async (_, data) => {\n    try {\n      // Convert camelCase to snake_case for database\n      const dbData = {\n        model_name: data.modelName,\n        api_key: data.apiKey,\n        role: data.role,\n        writing_style: data.writingStyle,\n        word_limit: data.wordLimit,\n        strictness: data.strictness,\n        functional_prompt: data.functionalPrompt,\n        cv_style_persona: data.cvStylePersona,\n        reference_cv_id: data.referenceCvId,\n        cv_style_code: data.cvStyleCode,\n        auditor_source: data.auditorSource,\n        thinker_source: data.thinkerSource,\n        motivation_letter_word_limit: data.motivationLetterWordLimit,\n        cover_letter_word_limit: data.coverLetterWordLimit,\n        status: 'active',\n        user_id: data.userId || 1\n      };\n      \n      const result = await runQuery('INSERT INTO ai_models', [dbData]);\n      \n      // Also save to file directly for persistence\n      saveDbToFile();\n      \n      return { success: true, id: result.id };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('ai-models:update', async (_, data) => {\n    try {\n      // Convert camelCase to snake_case for database\n      const dbData: any = { id: data.id };\n      \n      // Map all possible fields\n      if (data.modelName !== undefined) dbData.model_name = data.modelName;\n      if (data.model_name !== undefined) dbData.model_name = data.model_name;\n      if (data.apiKey !== undefined) dbData.api_key = data.apiKey;\n      if (data.api_key !== undefined) dbData.api_key = data.api_key;\n      if (data.role !== undefined) dbData.role = data.role;\n      if (data.writingStyle !== undefined) dbData.writing_style = data.writingStyle;\n      if (data.writing_style !== undefined) dbData.writing_style = data.writing_style;\n      if (data.wordLimit !== undefined) dbData.word_limit = data.wordLimit;\n      if (data.word_limit !== undefined) dbData.word_limit = data.word_limit;\n      if (data.strictness !== undefined) dbData.strictness = data.strictness;\n      if (data.functionalPrompt !== undefined) dbData.functional_prompt = data.functionalPrompt;\n      if (data.functional_prompt !== undefined) dbData.functional_prompt = data.functional_prompt;\n      if (data.cvStylePersona !== undefined) dbData.cv_style_persona = data.cvStylePersona;\n      if (data.cv_style_persona !== undefined) dbData.cv_style_persona = data.cv_style_persona;\n      if (data.referenceCvId !== undefined) dbData.reference_cv_id = data.referenceCvId;\n      if (data.reference_cv_id !== undefined) dbData.reference_cv_id = data.reference_cv_id;\n      if (data.cvStyleCode !== undefined) dbData.cv_style_code = data.cvStyleCode;\n      if (data.cv_style_code !== undefined) dbData.cv_style_code = data.cv_style_code;\n      if (data.auditorSource !== undefined) dbData.auditor_source = data.auditorSource;\n      if (data.auditor_source !== undefined) dbData.auditor_source = data.auditor_source;\n      if (data.thinkerSource !== undefined) dbData.thinker_source = data.thinkerSource;\n      if (data.thinker_source !== undefined) dbData.thinker_source = data.thinker_source;\n      if (data.motivationLetterWordLimit !== undefined) dbData.motivation_letter_word_limit = data.motivationLetterWordLimit;\n      if (data.motivation_letter_word_limit !== undefined) dbData.motivation_letter_word_limit = data.motivation_letter_word_limit;\n      if (data.coverLetterWordLimit !== undefined) dbData.cover_letter_word_limit = data.coverLetterWordLimit;\n      if (data.cover_letter_word_limit !== undefined) dbData.cover_letter_word_limit = data.cover_letter_word_limit;\n      if (data.status !== undefined) dbData.status = data.status;\n      if (data.last_test_status !== undefined) dbData.last_test_status = data.last_test_status;\n      if (data.last_test_message !== undefined) dbData.last_test_message = data.last_test_message;\n      if (data.last_tested !== undefined) dbData.last_tested = data.last_tested;\n      \n      await runQuery('UPDATE ai_models', [dbData]);\n      \n      // Save to file for persistence\n      saveDbToFile();\n      \n      return { success: true };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('ai-models:delete', async (_, id) => {\n    try {\n      await runQuery('DELETE FROM ai_models', { id });\n      saveDbToFile();\n      return { success: true };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  return channels;\n}\n\n// Helper to save database to file\nfunction saveDbToFile() {\n  try {\n    const db = getDatabase();\n    const dataDir = path.join(app.getPath('userData'), 'data');\n    if (!fs.existsSync(dataDir)) {\n      fs.mkdirSync(dataDir, { recursive: true });\n    }\n    fs.writeFileSync(path.join(dataDir, 'db.json'), JSON.stringify(db, null, 2));\n  } catch (e) {\n    console.error('Failed to save db to file:', e);\n  }\n}\n","import { ipcMain } from 'electron';\nimport { runQuery, getAllQuery, getDatabase } from '../database';\n\nexport function registerSystemHandlers(): string[] {\n  const channels = [\n    'logs:get-recent-actions',\n    'apps:get-all',\n    'scheduler:toggle',\n    'scheduler:get-status',\n    'hunter:get-status',\n    'qa:get-all',\n    'qa:update',\n    'qa:delete'\n  ];\n\n  // --- LOGS ---\n  ipcMain.handle('logs:get-recent-actions', async () => {\n    try {\n      const data = await getAllQuery('SELECT * FROM action_logs');\n      return { success: true, data };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  // --- APPLICATIONS ---\n  ipcMain.handle('apps:get-all', async () => {\n    try {\n      const data = await getAllQuery('SELECT * FROM applications');\n      return { success: true, data };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  // --- SCHEDULER CONTROL ---\n  ipcMain.handle('scheduler:toggle', async (_, data) => {\n    try {\n      // Support both { active: boolean } and direct boolean\n      const enabled = typeof data === 'object' ? data.active : data;\n      const { setSchedulerEnabled } = require('../features/scheduler');\n      setSchedulerEnabled(enabled);\n      await runQuery('UPDATE settings', { job_hunting_active: enabled ? 1 : 0 });\n      console.log(`Scheduler toggled: ${enabled ? 'ENABLED' : 'DISABLED'}`);\n      return { success: true, enabled };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('scheduler:get-status', async () => {\n    try {\n      const db = getDatabase();\n      const settings = db.settings[0];\n      return { \n        success: true, \n        enabled: settings?.job_hunting_active === 1 \n      };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  // Hunter (job scraper) status - for syncing UI state\n  ipcMain.handle('hunter:get-status', async () => {\n    try {\n      const HunterEngine = require('../features/Hunter-engine');\n      return { \n        success: true, \n        isSearching: HunterEngine.isSearching || false\n      };\n    } catch (e: any) {\n      return { success: false, error: e.message, isSearching: false };\n    }\n  });\n\n  // --- Q&A DATABASE ---\n  ipcMain.handle('qa:get-all', async () => {\n    try {\n      const SmartApplicant = require('../features/smart-applicant');\n      const data = await SmartApplicant.getAllQuestions();\n      return { success: true, data };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('qa:update', async (_, data) => {\n    try {\n      const SmartApplicant = require('../features/smart-applicant');\n      return await SmartApplicant.updateQuestionAnswer(data.questionId, data.answer);\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('qa:delete', async (_, questionId) => {\n    try {\n      const SmartApplicant = require('../features/smart-applicant');\n      return await SmartApplicant.deleteQuestion(questionId);\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  return channels;\n}\n","import { ipcMain, shell, BrowserWindow } from 'electron';\nimport * as EmailService from '../features/email-service';\nimport * as CompatibilityService from '../features/compatibility-service';\nimport * as SecretaryAuth from '../features/secretary-auth';\nimport Imap from 'imap';\nimport { simpleParser } from 'mailparser';\nimport { getAllQuery, runQuery } from '../database';\nimport { google } from 'googleapis';\n\nexport function registerServicesHandlers(): string[] {\n  const channels = [\n    // Email Service\n    'email:test-config', \n    'email:send', \n    'email:send-notification',\n    'email:test-inbox',\n    'email:fetch-inbox',\n    'email:oauth-start',\n    'email:oauth-callback',\n    'email:oauth-test',\n    // Compatibility Score\n    'compatibility:calculate', \n    'compatibility:calculate-all', \n    'compatibility:get-by-level',\n    // Secretary Authentication\n    'secretary:setup-pin', \n    'secretary:verify-pin', \n    'secretary:change-pin', \n    'secretary:reset-pin', \n    'secretary:is-pin-set', \n    'secretary:get-settings', \n    'secretary:update-permissions'\n  ];\n\n  // --- EMAIL SERVICE ---\n  ipcMain.handle('email:test-config', async (_, data) => {\n    try {\n      return await EmailService.testEmailConfig(data.userId, data.testEmail);\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('email:send', async (_, data) => {\n    try {\n      return await EmailService.sendEmail(data.options, data.userId);\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('email:send-notification', async (_, data) => {\n    try {\n      const result = await EmailService.sendNotification(data.userId, data.type, data.details);\n      return { success: result };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  // --- EMAIL INBOX TEST & FETCH ---\n  ipcMain.handle('email:test-inbox', async (_, data) => {\n    try {\n      const { email, password, provider } = data;\n      \n      if (!email || !password) {\n        return { success: false, error: 'Email and password are required' };\n      }\n      \n      // Determine IMAP settings based on provider\n      let imapConfig: any = {\n        user: email,\n        password: password,\n        tls: true,\n        tlsOptions: { rejectUnauthorized: false }\n      };\n      \n      if (provider === 'gmail' || email.includes('@gmail.com')) {\n        imapConfig.host = 'imap.gmail.com';\n        imapConfig.port = 993;\n      } else if (provider === 'outlook' || email.includes('@outlook') || email.includes('@hotmail') || email.includes('@live')) {\n        imapConfig.host = 'outlook.office365.com';\n        imapConfig.port = 993;\n      } else if (provider === 'yahoo' || email.includes('@yahoo')) {\n        imapConfig.host = 'imap.mail.yahoo.com';\n        imapConfig.port = 993;\n      } else if (provider === 'icloud' || email.includes('@icloud')) {\n        imapConfig.host = 'imap.mail.me.com';\n        imapConfig.port = 993;\n      } else {\n        // Default to Gmail settings\n        imapConfig.host = 'imap.gmail.com';\n        imapConfig.port = 993;\n      }\n      \n      console.log('Testing IMAP connection to:', imapConfig.host);\n      \n      return new Promise((resolve) => {\n        const imap = new Imap(imapConfig);\n        \n        imap.once('ready', () => {\n          console.log('IMAP connection successful');\n          imap.end();\n          resolve({ success: true, message: 'Connection successful! Inbox accessible.' });\n        });\n        \n        imap.once('error', (err: any) => {\n          console.error('IMAP connection error:', err.message);\n          let errorMsg = err.message;\n          \n          if (err.message.includes('Invalid credentials') || err.message.includes('AUTHENTICATIONFAILED')) {\n            errorMsg = 'Invalid credentials. For Gmail, use an App Password (not your regular password).';\n          } else if (err.message.includes('ECONNREFUSED')) {\n            errorMsg = 'Connection refused. Check your internet connection.';\n          }\n          \n          resolve({ success: false, error: errorMsg });\n        });\n        \n        imap.connect();\n        \n        // Timeout after 15 seconds\n        setTimeout(() => {\n          try { imap.end(); } catch (e) {}\n          resolve({ success: false, error: 'Connection timeout - server not responding' });\n        }, 15000);\n      });\n      \n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('email:fetch-inbox', async (_, data) => {\n    try {\n      const { email, password, provider, maxMessages } = data;\n      \n      if (!email || !password) {\n        return { success: false, error: 'Email and password are required', messages: [] };\n      }\n      \n      // Determine IMAP settings\n      let imapConfig: any = {\n        user: email,\n        password: password,\n        tls: true,\n        tlsOptions: { rejectUnauthorized: false }\n      };\n      \n      if (provider === 'gmail' || email.includes('@gmail.com')) {\n        imapConfig.host = 'imap.gmail.com';\n        imapConfig.port = 993;\n      } else if (provider === 'outlook' || email.includes('@outlook') || email.includes('@hotmail') || email.includes('@live')) {\n        imapConfig.host = 'outlook.office365.com';\n        imapConfig.port = 993;\n      } else if (provider === 'yahoo' || email.includes('@yahoo')) {\n        imapConfig.host = 'imap.mail.yahoo.com';\n        imapConfig.port = 993;\n      } else if (provider === 'icloud' || email.includes('@icloud')) {\n        imapConfig.host = 'imap.mail.me.com';\n        imapConfig.port = 993;\n      } else {\n        imapConfig.host = 'imap.gmail.com';\n        imapConfig.port = 993;\n      }\n      \n      console.log('Fetching emails from:', imapConfig.host);\n      \n      return new Promise((resolve) => {\n        const imap = new Imap(imapConfig);\n        const messages: any[] = [];\n        const limit = maxMessages || 5;\n        \n        imap.once('ready', () => {\n          imap.openBox('INBOX', true, (err: any, box: any) => {\n            if (err) {\n              imap.end();\n              resolve({ success: false, error: 'Failed to open inbox: ' + err.message, messages: [] });\n              return;\n            }\n            \n            const totalMessages = box.messages.total;\n            if (totalMessages === 0) {\n              imap.end();\n              resolve({ success: true, messages: [], totalCount: 0 });\n              return;\n            }\n            \n            // Fetch last N messages\n            const fetchFrom = Math.max(1, totalMessages - limit + 1);\n            const fetchRange = `${fetchFrom}:${totalMessages}`;\n            \n            const fetch = imap.seq.fetch(fetchRange, {\n              bodies: ['HEADER.FIELDS (FROM TO SUBJECT DATE)', 'TEXT'],\n              struct: true\n            });\n            \n            fetch.on('message', (msg: any, seqno: number) => {\n              const messageData: any = { seqno };\n              \n              msg.on('body', (stream: any, info: any) => {\n                let buffer = '';\n                stream.on('data', (chunk: any) => buffer += chunk.toString('utf8'));\n                stream.on('end', () => {\n                  if (info.which.includes('HEADER')) {\n                    const parsed = Imap.parseHeader(buffer);\n                    messageData.from = parsed.from?.[0] || 'Unknown';\n                    messageData.to = parsed.to?.[0] || '';\n                    messageData.subject = parsed.subject?.[0] || '(No Subject)';\n                    messageData.date = parsed.date?.[0] || '';\n                  } else {\n                    messageData.preview = buffer.substring(0, 200).replace(/\\r?\\n/g, ' ').trim();\n                  }\n                });\n              });\n              \n              msg.once('end', () => {\n                messages.push(messageData);\n              });\n            });\n            \n            fetch.once('error', (err: any) => {\n              console.error('Fetch error:', err);\n            });\n            \n            fetch.once('end', () => {\n              imap.end();\n              // Sort by most recent first\n              messages.sort((a, b) => b.seqno - a.seqno);\n              resolve({ \n                success: true, \n                messages: messages.slice(0, limit),\n                totalCount: totalMessages \n              });\n            });\n          });\n        });\n        \n        imap.once('error', (err: any) => {\n          console.error('IMAP error:', err.message);\n          resolve({ success: false, error: err.message, messages: [] });\n        });\n        \n        imap.connect();\n        \n        // Timeout after 30 seconds\n        setTimeout(() => {\n          try { imap.end(); } catch (e) {}\n          if (messages.length === 0) {\n            resolve({ success: false, error: 'Connection timeout', messages: [] });\n          }\n        }, 30000);\n      });\n      \n    } catch (e: any) {\n      return { success: false, error: e.message, messages: [] };\n    }\n  });\n\n  // --- GOOGLE OAUTH HANDLERS ---\n  \n  // Store OAuth clients temporarily\n  const oauthClients: Map<string, any> = new Map();\n  \n  // Loopback redirect URI for desktop OAuth (Google approved method)\n  const LOOPBACK_REDIRECT_URI = 'http://127.0.0.1';\n  let authServerInstance: any = null;\n  \n  // Start OAuth flow - opens browser for consent using loopback method\n  ipcMain.handle('email:oauth-start', async (_, data) => {\n    try {\n      const { clientId, clientSecret, email } = data;\n      \n      if (!clientId || !clientSecret) {\n        return { success: false, error: 'Client ID and Client Secret are required' };\n      }\n      \n      console.log('Starting OAuth flow for:', email);\n      \n      // Find an available port and start a local server to receive the callback\n      const http = require('http');\n      const url = require('url');\n      \n      // Try ports in sequence\n      const findAvailablePort = (): Promise<number> => {\n        return new Promise((resolve, reject) => {\n          const server = http.createServer();\n          server.listen(0, '127.0.0.1', () => {\n            const port = server.address().port;\n            server.close(() => resolve(port));\n          });\n          server.on('error', reject);\n        });\n      };\n      \n      const port = await findAvailablePort();\n      const redirectUri = `${LOOPBACK_REDIRECT_URI}:${port}`;\n      \n      console.log('Using redirect URI:', redirectUri);\n      \n      // Create OAuth2 client with loopback redirect\n      const oauth2Client = new google.auth.OAuth2(\n        clientId,\n        clientSecret,\n        redirectUri\n      );\n      \n      // Store client for later use\n      oauthClients.set(email || 'default', { client: oauth2Client, redirectUri });\n      \n      // Create promise to wait for the callback\n      const authCodePromise = new Promise<string>((resolve, reject) => {\n        const timeoutId = setTimeout(() => {\n          if (authServerInstance) {\n            authServerInstance.close();\n            authServerInstance = null;\n          }\n          reject(new Error('OAuth timeout - no response received within 5 minutes'));\n        }, 300000); // 5 minute timeout\n        \n        authServerInstance = http.createServer(async (req: any, res: any) => {\n          try {\n            const queryParams = url.parse(req.url, true).query;\n            \n            if (queryParams.code) {\n              clearTimeout(timeoutId);\n              \n              // Send success page\n              res.writeHead(200, { 'Content-Type': 'text/html' });\n              res.end(`\n                <!DOCTYPE html>\n                <html>\n                <head>\n                  <title>Authorization Successful</title>\n                  <style>\n                    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; \n                           display: flex; justify-content: center; align-items: center; height: 100vh; \n                           margin: 0; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }\n                    .container { background: white; padding: 40px; border-radius: 16px; text-align: center; \n                                 box-shadow: 0 20px 60px rgba(0,0,0,0.3); max-width: 400px; }\n                    h1 { color: #4CAF50; margin-bottom: 10px; }\n                    p { color: #666; }\n                  </style>\n                </head>\n                <body>\n                  <div class=\"container\">\n                    <h1>‚úì Authorization Successful!</h1>\n                    <p>You can close this window and return to the app.</p>\n                    <p style=\"font-size: 12px; color: #888; margin-top: 20px;\">This window will close automatically...</p>\n                  </div>\n                  <script>setTimeout(() => window.close(), 3000);</script>\n                </body>\n                </html>\n              `);\n              \n              // Close server and resolve\n              authServerInstance.close();\n              authServerInstance = null;\n              resolve(queryParams.code as string);\n              \n            } else if (queryParams.error) {\n              clearTimeout(timeoutId);\n              res.writeHead(400, { 'Content-Type': 'text/html' });\n              res.end(`\n                <!DOCTYPE html>\n                <html>\n                <head><title>Authorization Failed</title></head>\n                <body style=\"font-family: sans-serif; text-align: center; padding: 50px;\">\n                  <h1 style=\"color: #f44336;\">Authorization Failed</h1>\n                  <p>Error: ${queryParams.error}</p>\n                  <p>Please close this window and try again.</p>\n                </body>\n                </html>\n              `);\n              authServerInstance.close();\n              authServerInstance = null;\n              reject(new Error(queryParams.error as string));\n            }\n          } catch (err) {\n            console.error('Error handling OAuth callback:', err);\n          }\n        });\n        \n        authServerInstance.listen(port, '127.0.0.1', () => {\n          console.log(`OAuth callback server listening on port ${port}`);\n        });\n      });\n      \n      // Generate authorization URL\n      const authUrl = oauth2Client.generateAuthUrl({\n        access_type: 'offline',\n        scope: [\n          'https://www.googleapis.com/auth/gmail.readonly',\n          'https://www.googleapis.com/auth/gmail.send',\n          'https://mail.google.com/'\n        ],\n        prompt: 'consent'\n      });\n      \n      console.log('OAuth URL generated:', authUrl);\n      \n      // Open browser with auth URL\n      await shell.openExternal(authUrl);\n      \n      // Wait for the authorization code\n      try {\n        const code = await authCodePromise;\n        \n        // Exchange code for tokens\n        const { tokens } = await oauth2Client.getToken(code);\n        oauth2Client.setCredentials(tokens);\n        \n        console.log('OAuth tokens received:', {\n          access_token: tokens.access_token ? 'present' : 'missing',\n          refresh_token: tokens.refresh_token ? 'present' : 'missing',\n          expiry_date: tokens.expiry_date\n        });\n        \n        // Store tokens in database\n        const db = require('../database').getDatabase();\n        if (db.settings.length === 0) {\n          db.settings.push({ id: 1 });\n        }\n        db.settings[0].oauth_access_token = tokens.access_token;\n        db.settings[0].oauth_refresh_token = tokens.refresh_token;\n        db.settings[0].oauth_expiry = tokens.expiry_date;\n        db.settings[0].email_connected = 1;\n        db.settings[0].oauth_client_id = clientId;\n        db.settings[0].oauth_client_secret = clientSecret;\n        \n        // Save to disk\n        const fs = require('fs');\n        const path = require('path');\n        const { app } = require('electron');\n        const dataDir = path.join(app.getPath('userData'), 'data');\n        fs.writeFileSync(path.join(dataDir, 'db.json'), JSON.stringify(db, null, 2));\n        \n        return { \n          success: true, \n          message: 'OAuth connected successfully! Your email is now linked.',\n          hasRefreshToken: !!tokens.refresh_token\n        };\n        \n      } catch (authError: any) {\n        console.error('OAuth flow error:', authError);\n        return { success: false, error: authError.message };\n      }\n      \n    } catch (e: any) {\n      console.error('OAuth start error:', e);\n      if (authServerInstance) {\n        authServerInstance.close();\n        authServerInstance = null;\n      }\n      return { success: false, error: e.message };\n    }\n  });\n  \n  // Handle OAuth callback with authorization code (kept for manual code entry fallback)\n  ipcMain.handle('email:oauth-callback', async (_, data) => {\n    try {\n      const { clientId, clientSecret, code, email } = data;\n      \n      if (!code) {\n        return { success: false, error: 'Authorization code is required' };\n      }\n      \n      console.log('Processing OAuth callback for:', email);\n      \n      // Get or create OAuth2 client\n      let oauthData = oauthClients.get(email || 'default');\n      let oauth2Client;\n      let redirectUri = 'http://127.0.0.1';\n      \n      if (oauthData) {\n        oauth2Client = oauthData.client;\n        redirectUri = oauthData.redirectUri || redirectUri;\n      } else {\n        oauth2Client = new google.auth.OAuth2(\n          clientId,\n          clientSecret,\n          redirectUri\n        );\n      }\n      \n      // Exchange code for tokens\n      const { tokens } = await oauth2Client.getToken(code);\n      oauth2Client.setCredentials(tokens);\n      \n      console.log('OAuth tokens received:', {\n        access_token: tokens.access_token ? 'present' : 'missing',\n        refresh_token: tokens.refresh_token ? 'present' : 'missing',\n        expiry_date: tokens.expiry_date\n      });\n      \n      // Store tokens in database\n      const db = require('../database').getDatabase();\n      if (db.settings.length === 0) {\n        db.settings.push({ id: 1 });\n      }\n      db.settings[0].oauth_access_token = tokens.access_token;\n      db.settings[0].oauth_refresh_token = tokens.refresh_token;\n      db.settings[0].oauth_expiry = tokens.expiry_date;\n      db.settings[0].email_connected = 1;\n      db.settings[0].oauth_client_id = clientId;\n      db.settings[0].oauth_client_secret = clientSecret;\n      \n      // Save to disk\n      const fs = require('fs');\n      const path = require('path');\n      const { app } = require('electron');\n      const dataDir = path.join(app.getPath('userData'), 'data');\n      fs.writeFileSync(path.join(dataDir, 'db.json'), JSON.stringify(db, null, 2));\n      \n      return { \n        success: true, \n        message: 'OAuth connected successfully! Your email is now linked.',\n        hasRefreshToken: !!tokens.refresh_token\n      };\n      \n    } catch (e: any) {\n      console.error('OAuth callback error:', e);\n      \n      let errorMsg = e.message;\n      if (e.message.includes('invalid_grant')) {\n        errorMsg = 'Invalid or expired authorization code. Please try again.';\n      } else if (e.message.includes('redirect_uri_mismatch')) {\n        errorMsg = 'OAuth configuration error. Please ensure you have added \"http://127.0.0.1\" as an authorized redirect URI in your Google Cloud Console. Go to: APIs & Services > Credentials > OAuth 2.0 Client IDs > Your Client > Authorized redirect URIs.';\n      }\n      \n      return { success: false, error: errorMsg };\n    }\n  });\n  \n  // Test OAuth connection by fetching emails\n  ipcMain.handle('email:oauth-test', async (_, data) => {\n    try {\n      let { clientId, clientSecret, email } = data || {};\n      \n      // Get stored tokens and credentials from database\n      const db = require('../database').getDatabase();\n      const settingsRow = db.settings?.[0] || {};\n      \n      if (!settingsRow.oauth_access_token) {\n        return { success: false, error: 'No OAuth tokens found. Please connect first.' };\n      }\n      \n      // Use stored credentials if not provided\n      clientId = clientId || settingsRow.oauth_client_id;\n      clientSecret = clientSecret || settingsRow.oauth_client_secret;\n      \n      if (!clientId || !clientSecret) {\n        return { success: false, error: 'OAuth credentials not found. Please reconnect.' };\n      }\n      \n      console.log('Testing OAuth connection...');\n      \n      // Create OAuth2 client with stored tokens\n      const oauth2Client = new google.auth.OAuth2(\n        clientId,\n        clientSecret,\n        'http://127.0.0.1'\n      );\n      \n      oauth2Client.setCredentials({\n        access_token: settingsRow.oauth_access_token,\n        refresh_token: settingsRow.oauth_refresh_token,\n        expiry_date: settingsRow.oauth_expiry\n      });\n      \n      // Handle token refresh if expired\n      oauth2Client.on('tokens', (tokens: any) => {\n        console.log('New tokens received during test');\n        if (tokens.access_token) {\n          db.settings[0].oauth_access_token = tokens.access_token;\n        }\n        if (tokens.refresh_token) {\n          db.settings[0].oauth_refresh_token = tokens.refresh_token;\n        }\n        if (tokens.expiry_date) {\n          db.settings[0].oauth_expiry = tokens.expiry_date;\n        }\n        // Save updated tokens\n        const fs = require('fs');\n        const path = require('path');\n        const { app } = require('electron');\n        const dataDir = path.join(app.getPath('userData'), 'data');\n        fs.writeFileSync(path.join(dataDir, 'db.json'), JSON.stringify(db, null, 2));\n      });\n      \n      // Test by fetching user profile\n      const gmail = google.gmail({ version: 'v1', auth: oauth2Client });\n      const profile = await gmail.users.getProfile({ userId: 'me' });\n      \n      console.log('Gmail profile:', profile.data);\n      \n      // Fetch latest messages\n      const messageList = await gmail.users.messages.list({\n        userId: 'me',\n        maxResults: 5,\n        labelIds: ['INBOX']\n      });\n      \n      const messages: any[] = [];\n      \n      if (messageList.data.messages) {\n        for (const msg of messageList.data.messages.slice(0, 5)) {\n          const fullMsg = await gmail.users.messages.get({\n            userId: 'me',\n            id: msg.id!,\n            format: 'metadata',\n            metadataHeaders: ['From', 'Subject', 'Date']\n          });\n          \n          const headers = fullMsg.data.payload?.headers || [];\n          messages.push({\n            from: headers.find(h => h.name === 'From')?.value || 'Unknown',\n            subject: headers.find(h => h.name === 'Subject')?.value || '(No Subject)',\n            date: headers.find(h => h.name === 'Date')?.value || '',\n            snippet: fullMsg.data.snippet\n          });\n        }\n      }\n      \n      return { \n        success: true, \n        email: profile.data.emailAddress,\n        totalMessages: profile.data.messagesTotal,\n        messages: messages\n      };\n      \n    } catch (e: any) {\n      console.error('OAuth test error:', e);\n      \n      let errorMsg = e.message;\n      if (e.message.includes('invalid_grant') || e.message.includes('Token has been expired') || e.message.includes('Invalid Credentials')) {\n        errorMsg = 'OAuth token expired or invalid. Please reconnect your email.';\n      }\n      \n      return { success: false, error: errorMsg };\n    }\n  });\n\n  // --- COMPATIBILITY SCORE ---\n  ipcMain.handle('compatibility:calculate', async (_, data) => {\n    try {\n      const result = await CompatibilityService.calculateCompatibility(data.userId, data.jobId);\n      return { success: true, ...result };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('compatibility:calculate-all', async (_, data) => {\n    try {\n      await CompatibilityService.calculateAllCompatibility(data.userId);\n      return { success: true };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('compatibility:get-by-level', async (_, data) => {\n    try {\n      const jobs = await CompatibilityService.getJobsByCompatibility(data.userId, data.minLevel);\n      return { success: true, data: jobs };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  // --- SECRETARY AUTHENTICATION ---\n  ipcMain.handle('secretary:setup-pin', async (_, data) => {\n    try {\n      return await SecretaryAuth.setupSecretaryPin(data.userId, data.pin);\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('secretary:verify-pin', async (_, data) => {\n    try {\n      return await SecretaryAuth.verifySecretaryPin(data.userId, data.pin);\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('secretary:change-pin', async (_, data) => {\n    try {\n      return await SecretaryAuth.changeSecretaryPin(data.userId, data.currentPin, data.newPin);\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('secretary:reset-pin', async (_, data) => {\n    try {\n      return await SecretaryAuth.resetSecretaryPin(data.userId);\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('secretary:is-pin-set', async (_, data) => {\n    try {\n      const isSet = await SecretaryAuth.isSecretaryPinSet(data.userId);\n      return { success: true, isSet };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('secretary:get-settings', async (_, data) => {\n    try {\n      const settings = await SecretaryAuth.getSecretaryAccessSettings(data.userId);\n      return { success: true, ...settings };\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  ipcMain.handle('secretary:update-permissions', async (_, data) => {\n    try {\n      return await SecretaryAuth.updateSecretaryPermissions(data.userId, data.permissions);\n    } catch (e: any) {\n      return { success: false, error: e.message };\n    }\n  });\n\n  return channels;\n}\n","import nodemailer from 'nodemailer';\nimport { getAllQuery, logAction, runQuery } from '../database';\n\ninterface EmailConfig {\n  smtp_host: string;\n  smtp_port: number;\n  smtp_secure: boolean;\n  email_user: string;\n  email_password: string;\n  from_name?: string;\n}\n\ninterface SendEmailOptions {\n  to: string;\n  subject: string;\n  text?: string;\n  html?: string;\n}\n\n/**\n * Create SMTP transporter from config\n */\nfunction createTransporter(config: EmailConfig) {\n  return nodemailer.createTransport({\n    host: config.smtp_host,\n    port: config.smtp_port,\n    secure: config.smtp_secure, // true for 465, false for other ports\n    auth: {\n      user: config.email_user,\n      pass: config.email_password,\n    },\n    tls: {\n      rejectUnauthorized: false // Allow self-signed certs\n    }\n  });\n}\n\n/**\n * Get email configuration from database\n */\nexport async function getEmailConfig(): Promise<EmailConfig | null> {\n  const configs = await getAllQuery('SELECT * FROM email_config');\n  const config = configs[0];\n  \n  if (!config || !config.email_user || !config.email_password) {\n    return null;\n  }\n  \n  return {\n    smtp_host: config.smtp_host || 'smtp.gmail.com',\n    smtp_port: config.smtp_port || 587,\n    smtp_secure: config.smtp_secure || false,\n    email_user: config.email_user,\n    email_password: config.email_password,\n    from_name: config.from_name || 'Job Application Bot'\n  };\n}\n\n/**\n * Send email using SMTP\n */\nexport async function sendEmail(options: SendEmailOptions, userId?: number): Promise<{ success: boolean; error?: string; messageId?: string }> {\n  try {\n    const config = await getEmailConfig();\n    \n    if (!config) {\n      return { success: false, error: 'Email configuration not found. Please configure SMTP settings.' };\n    }\n    \n    const transporter = createTransporter(config);\n    \n    // Verify connection\n    await transporter.verify();\n    \n    const mailOptions = {\n      from: `\"${config.from_name}\" <${config.email_user}>`,\n      to: options.to,\n      subject: options.subject,\n      text: options.text,\n      html: options.html\n    };\n    \n    const info = await transporter.sendMail(mailOptions);\n    \n    if (userId) {\n      await logAction(userId, 'email_service', `‚úâÔ∏è Email sent to ${options.to}: ${options.subject}`, 'completed', true);\n    }\n    \n    console.log('Email sent:', info.messageId);\n    return { success: true, messageId: info.messageId };\n    \n  } catch (error: any) {\n    console.error('Email send error:', error);\n    \n    if (userId) {\n      await logAction(userId, 'email_service', `‚ùå Failed to send email: ${error.message}`, 'failed', false);\n    }\n    \n    return { success: false, error: error.message };\n  }\n}\n\n/**\n * Send notification email to user's personal email\n */\nexport async function sendNotification(userId: number, type: 'response' | 'follow_up' | 'verification', details: any): Promise<boolean> {\n  try {\n    // Get secretary settings\n    const settings = await getAllQuery('SELECT * FROM settings');\n    const userSettings = settings[0];\n    \n    if (!userSettings?.secretary_settings) {\n      console.log('Secretary settings not configured');\n      return false;\n    }\n    \n    const secretarySettings = typeof userSettings.secretary_settings === 'string' \n      ? JSON.parse(userSettings.secretary_settings) \n      : userSettings.secretary_settings;\n    \n    // Check if notifications are enabled\n    if (!secretarySettings.enabled) return false;\n    \n    const notifyEmail = secretarySettings.notifyUserEmail;\n    if (!notifyEmail) return false;\n    \n    // Check specific notification type\n    if (type === 'response' && !secretarySettings.notifyOnResponse) return false;\n    if (type === 'follow_up' && !secretarySettings.notifyOnFollowUp) return false;\n    if (type === 'verification' && !secretarySettings.notifyOnVerification) return false;\n    \n    // Build email content based on type\n    let subject = '';\n    let html = '';\n    \n    switch (type) {\n      case 'response':\n        subject = `üì¨ Company Response: ${details.company || 'Unknown'}`;\n        html = `\n          <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n            <h2 style=\"color: #4CAF50;\">New Response Received</h2>\n            <p>You've received a response from <strong>${details.company}</strong> regarding your application for <strong>${details.position}</strong>.</p>\n            <div style=\"background: #f5f5f5; padding: 15px; border-radius: 8px; margin: 20px 0;\">\n              <p style=\"margin: 0;\"><strong>Subject:</strong> ${details.subject}</p>\n              <p style=\"margin: 10px 0 0;\"><strong>Preview:</strong> ${details.snippet}</p>\n            </div>\n            <p>Log in to your Job Application tool to view the full message.</p>\n          </div>\n        `;\n        break;\n        \n      case 'follow_up':\n        subject = `üì§ Follow-up Sent: ${details.company || 'Unknown'}`;\n        html = `\n          <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n            <h2 style=\"color: #2196F3;\">Follow-up Email Sent</h2>\n            <p>A follow-up email has been automatically sent to <strong>${details.company}</strong> for the <strong>${details.position}</strong> position.</p>\n            <p style=\"color: #666;\">This follow-up was sent ${details.daysAfter || 2} days after your initial application.</p>\n          </div>\n        `;\n        break;\n        \n      case 'verification':\n        subject = `‚ö†Ô∏è Action Required: Verification Needed`;\n        html = `\n          <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;\">\n            <h2 style=\"color: #FF9800;\">Verification Required</h2>\n            <p>Your application to <strong>${details.company}</strong> requires manual verification.</p>\n            <p><strong>Reason:</strong> ${details.reason || 'CAPTCHA or security check detected'}</p>\n            <p>Please log in to complete the application manually.</p>\n          </div>\n        `;\n        break;\n    }\n    \n    const result = await sendEmail({ to: notifyEmail, subject, html }, userId);\n    return result.success;\n    \n  } catch (error) {\n    console.error('Notification error:', error);\n    return false;\n  }\n}\n\n/**\n * Send follow-up email for application\n */\nexport async function sendFollowUpEmail(userId: number, application: any): Promise<boolean> {\n  try {\n    const config = await getEmailConfig();\n    if (!config) return false;\n    \n    // Get user profile for signature\n    const profiles = await getAllQuery('SELECT * FROM user_profile');\n    const profile = profiles[0];\n    \n    const userName = profile?.name || 'Applicant';\n    const userTitle = profile?.title || 'Professional';\n    \n    const subject = `Following Up: ${application.position} Application - ${userName}`;\n    \n    const html = `\n      <div style=\"font-family: Arial, sans-serif; max-width: 600px;\">\n        <p>Dear Hiring Team,</p>\n        \n        <p>I hope this message finds you well. I wanted to follow up on my application for the <strong>${application.position}</strong> position that I submitted on ${new Date(application.applied_date).toLocaleDateString()}.</p>\n        \n        <p>I remain very enthusiastic about the opportunity to contribute to ${application.company} and would welcome the chance to discuss how my skills and experience align with your team's needs.</p>\n        \n        <p>Please let me know if there's any additional information I can provide. I look forward to hearing from you.</p>\n        \n        <p>Best regards,<br/>\n        <strong>${userName}</strong><br/>\n        ${userTitle}</p>\n      </div>\n    `;\n    \n    // This would need the company's email - for now just log the action\n    await logAction(userId, 'email_service', `üì§ Follow-up prepared for ${application.company} - ${application.position}`, 'completed', true);\n    \n    // In a real implementation, you'd need the company's HR email\n    // const result = await sendEmail({ to: application.company_email, subject, html }, userId);\n    // return result.success;\n    \n    return true;\n  } catch (error) {\n    console.error('Follow-up email error:', error);\n    return false;\n  }\n}\n\n/**\n * Send thank you confirmation email\n */\nexport async function sendThanksConfirmation(userId: number, company: string, position: string, recipientEmail?: string): Promise<boolean> {\n  try {\n    if (!recipientEmail) {\n      await logAction(userId, 'email_service', `üìù Thanks confirmation prepared for ${company} (no email available)`, 'completed', true);\n      return true;\n    }\n    \n    const profiles = await getAllQuery('SELECT * FROM user_profile');\n    const profile = profiles[0];\n    const userName = profile?.name || 'Applicant';\n    \n    const subject = `Thank You - ${position} Application Confirmation`;\n    \n    const html = `\n      <div style=\"font-family: Arial, sans-serif; max-width: 600px;\">\n        <p>Dear Hiring Team,</p>\n        \n        <p>Thank you for confirming receipt of my application for the <strong>${position}</strong> position at ${company}.</p>\n        \n        <p>I appreciate you taking the time to review my application and look forward to the opportunity to discuss my qualifications further.</p>\n        \n        <p>Best regards,<br/>\n        <strong>${userName}</strong></p>\n      </div>\n    `;\n    \n    const result = await sendEmail({ to: recipientEmail, subject, html }, userId);\n    return result.success;\n    \n  } catch (error) {\n    console.error('Thanks confirmation error:', error);\n    return false;\n  }\n}\n\n/**\n * Test email configuration\n */\nexport async function testEmailConfig(userId: number, testEmail: string): Promise<{ success: boolean; error?: string }> {\n  try {\n    const config = await getEmailConfig();\n    \n    if (!config) {\n      return { success: false, error: 'Email configuration not found' };\n    }\n    \n    const result = await sendEmail({\n      to: testEmail,\n      subject: '‚úÖ Job Application Tool - Email Test Successful',\n      html: `\n        <div style=\"font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto; padding: 20px;\">\n          <h2 style=\"color: #4CAF50;\">Email Configuration Test</h2>\n          <p>Congratulations! Your email settings are configured correctly.</p>\n          <p>You will now receive notifications about:</p>\n          <ul>\n            <li>Company responses to your applications</li>\n            <li>Follow-up emails sent automatically</li>\n            <li>Verification requests requiring your attention</li>\n          </ul>\n          <p style=\"color: #666; font-size: 12px; margin-top: 20px;\">\n            This is an automated test email from your Job Application Automation tool.\n          </p>\n        </div>\n      `\n    }, userId);\n    \n    return result;\n    \n  } catch (error: any) {\n    return { success: false, error: error.message };\n  }\n}\n","import { getAllQuery, runQuery, getDatabase } from '../database';\nimport * as crypto from 'crypto';\n\ninterface SecretarySession {\n  sessionId: string;\n  createdAt: Date;\n  expiresAt: Date;\n  userId: number;\n}\n\n// In-memory session store (in production, use Redis or similar)\nconst sessions: Map<string, SecretarySession> = new Map();\n\n// Session duration: 8 hours\nconst SESSION_DURATION_MS = 8 * 60 * 60 * 1000;\n\n/**\n * Hash PIN using SHA-256\n */\nfunction hashPin(pin: string): string {\n  return crypto.createHash('sha256').update(pin).digest('hex');\n}\n\n/**\n * Generate secure session ID\n */\nfunction generateSessionId(): string {\n  return crypto.randomBytes(32).toString('hex');\n}\n\n/**\n * Set up Secretary PIN (first time setup)\n */\nexport async function setupSecretaryPin(userId: number, pin: string): Promise<{ success: boolean; error?: string }> {\n  try {\n    // Validate PIN format (4-8 digits)\n    if (!/^\\d{4,8}$/.test(pin)) {\n      return { success: false, error: 'PIN must be 4-8 digits' };\n    }\n    \n    const hashedPin = hashPin(pin);\n    \n    // Check if settings exist\n    const settings = await getAllQuery('SELECT * FROM settings');\n    \n    if (settings.length > 0) {\n      await runQuery('UPDATE settings', {\n        id: settings[0].id,\n        secretary_pin: hashedPin,\n        secretary_pin_set: 1\n      });\n    } else {\n      await runQuery('INSERT INTO settings', {\n        user_id: userId,\n        secretary_pin: hashedPin,\n        secretary_pin_set: 1\n      });\n    }\n    \n    return { success: true };\n    \n  } catch (error: any) {\n    return { success: false, error: error.message };\n  }\n}\n\n/**\n * Verify Secretary PIN and create session\n */\nexport async function verifySecretaryPin(userId: number, pin: string): Promise<{ success: boolean; sessionId?: string; error?: string }> {\n  try {\n    const settings = await getAllQuery('SELECT * FROM settings');\n    const userSettings = settings.find((s: any) => s.user_id === userId) || settings[0];\n    \n    if (!userSettings?.secretary_pin) {\n      return { success: false, error: 'Secretary PIN not set. Please set up PIN first.' };\n    }\n    \n    const hashedPin = hashPin(pin);\n    \n    if (hashedPin !== userSettings.secretary_pin) {\n      return { success: false, error: 'Invalid PIN' };\n    }\n    \n    // Create session\n    const sessionId = generateSessionId();\n    const now = new Date();\n    \n    sessions.set(sessionId, {\n      sessionId,\n      createdAt: now,\n      expiresAt: new Date(now.getTime() + SESSION_DURATION_MS),\n      userId\n    });\n    \n    return { success: true, sessionId };\n    \n  } catch (error: any) {\n    return { success: false, error: error.message };\n  }\n}\n\n/**\n * Validate session\n */\nexport function validateSession(sessionId: string): { valid: boolean; userId?: number } {\n  const session = sessions.get(sessionId);\n  \n  if (!session) {\n    return { valid: false };\n  }\n  \n  if (new Date() > session.expiresAt) {\n    sessions.delete(sessionId);\n    return { valid: false };\n  }\n  \n  return { valid: true, userId: session.userId };\n}\n\n/**\n * Invalidate session (logout)\n */\nexport function invalidateSession(sessionId: string): void {\n  sessions.delete(sessionId);\n}\n\n/**\n * Change Secretary PIN\n */\nexport async function changeSecretaryPin(userId: number, currentPin: string, newPin: string): Promise<{ success: boolean; error?: string }> {\n  try {\n    // Verify current PIN first\n    const verifyResult = await verifySecretaryPin(userId, currentPin);\n    \n    if (!verifyResult.success) {\n      return { success: false, error: 'Current PIN is incorrect' };\n    }\n    \n    // Invalidate the session created during verification\n    if (verifyResult.sessionId) {\n      invalidateSession(verifyResult.sessionId);\n    }\n    \n    // Set new PIN\n    return await setupSecretaryPin(userId, newPin);\n    \n  } catch (error: any) {\n    return { success: false, error: error.message };\n  }\n}\n\n/**\n * Check if Secretary PIN is set\n */\nexport async function isSecretaryPinSet(userId: number): Promise<boolean> {\n  try {\n    const settings = await getAllQuery('SELECT * FROM settings');\n    const userSettings = settings.find((s: any) => s.user_id === userId) || settings[0];\n    \n    return !!(userSettings?.secretary_pin && userSettings?.secretary_pin_set === 1);\n  } catch {\n    return false;\n  }\n}\n\n/**\n * Reset Secretary PIN (requires main user authentication - for recovery)\n */\nexport async function resetSecretaryPin(userId: number): Promise<{ success: boolean; error?: string }> {\n  try {\n    const settings = await getAllQuery('SELECT * FROM settings');\n    \n    if (settings.length > 0) {\n      await runQuery('UPDATE settings', {\n        id: settings[0].id,\n        secretary_pin: null,\n        secretary_pin_set: 0\n      });\n    }\n    \n    // Clear all sessions\n    sessions.clear();\n    \n    return { success: true };\n    \n  } catch (error: any) {\n    return { success: false, error: error.message };\n  }\n}\n\n/**\n * Get Secretary access settings\n */\nexport async function getSecretaryAccessSettings(userId: number): Promise<any> {\n  try {\n    const settings = await getAllQuery('SELECT * FROM settings');\n    const userSettings = settings.find((s: any) => s.user_id === userId) || settings[0];\n    \n    return {\n      pinSet: !!(userSettings?.secretary_pin_set),\n      secretaryEnabled: userSettings?.secretary_enabled === 1,\n      allowedActions: userSettings?.secretary_allowed_actions || ['view_applications', 'send_followups'],\n      lastAccess: userSettings?.secretary_last_access || null\n    };\n  } catch {\n    return {\n      pinSet: false,\n      secretaryEnabled: false,\n      allowedActions: [],\n      lastAccess: null\n    };\n  }\n}\n\n/**\n * Update Secretary access permissions\n */\nexport async function updateSecretaryPermissions(userId: number, permissions: {\n  enabled?: boolean;\n  allowedActions?: string[];\n}): Promise<{ success: boolean; error?: string }> {\n  try {\n    const settings = await getAllQuery('SELECT * FROM settings');\n    \n    const updateData: any = { id: settings[0]?.id || 1 };\n    \n    if (permissions.enabled !== undefined) {\n      updateData.secretary_enabled = permissions.enabled ? 1 : 0;\n    }\n    \n    if (permissions.allowedActions) {\n      updateData.secretary_allowed_actions = JSON.stringify(permissions.allowedActions);\n    }\n    \n    if (settings.length > 0) {\n      await runQuery('UPDATE settings', updateData);\n    } else {\n      await runQuery('INSERT INTO settings', {\n        user_id: userId,\n        ...updateData\n      });\n    }\n    \n    return { success: true };\n    \n  } catch (error: any) {\n    return { success: false, error: error.message };\n  }\n}\n\n/**\n * Log Secretary access\n */\nexport async function logSecretaryAccess(userId: number, action: string): Promise<void> {\n  try {\n    const settings = await getAllQuery('SELECT * FROM settings');\n    \n    if (settings.length > 0) {\n      await runQuery('UPDATE settings', {\n        id: settings[0].id,\n        secretary_last_access: new Date().toISOString(),\n        secretary_last_action: action\n      });\n    }\n  } catch (error) {\n    console.error('Failed to log secretary access:', error);\n  }\n}\n"],"mappings":"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","names":["fs","path","pages","puppeteer","currentUrl","import_path","import_fs","app","path","fs","getUserDataDir","puppeteer","callAI","import_puppeteer","import_path","app","path","isSearching","callAI","callAI","fs","path","app","Imap","err","startHunterSearch","callAI","submitApplication","callAI","_a","puppeteer","getUserDataDir","path","import_puppeteer","import_path","fs","app","puppeteer","getDocsDir","import_puppeteer","fs","path","app","import_electron","import_path","import_electron","import_electron","import_electron","app","import_electron","import_electron","import_puppeteer","import_path","import_electron","callAI","puppeteer","path","fs","axios","startHunterSearch","analyzeJobUrl","analyzeJobUrl","import_electron","import_axios","axios","startHunterSearch","_a","import_electron","import_electron","import_electron","import_fs","import_path","app","dbData","path","fs","import_electron","setSchedulerEnabled","import_electron","nodemailer","import_imap","Imap","err","port","fs","path","app","path","isDev"]}